# 书签分享功能测试指南

## 测试概述

本文档提供了书签分享功能的完整测试指南，包括端到端测试、浏览器兼容性测试、性能测试和用户体验验证。

---

## 1. 端到端测试

### 1.1 PC → PC 分享流程

**测试目标：** 验证完整的分享和导入流程

**测试步骤：**

1. **生成分享链接**
   - [ ] 打开 Chrome 扩展管理页面（快捷键：Alt+B）
   - [ ] 选择 3-5 个书签
   - [ ] 点击右侧工具栏的"分享"按钮
   - [ ] 验证弹窗正确显示选中的书签数量
   - [ ] 等待海报生成完成
   - [ ] 验证海报预览正确显示书签列表和二维码
   - [ ] 点击"生成链接"按钮
   - [ ] 验证成功提示："分享链接已复制到剪贴板"

2. **访问分享落地页**
   - [ ] 在新标签页中粘贴分享链接
   - [ ] 验证页面正确加载
   - [ ] 验证书签列表正确显示（标题、URL、Favicon）
   - [ ] 验证书签数量与分享时一致
   - [ ] 验证时间戳显示正确（"X 分钟前"）

3. **导入书签**
   - [ ] 验证扩展检测成功（显示导入界面）
   - [ ] 验证默认选中"书签栏"文件夹
   - [ ] 验证所有书签默认被选中
   - [ ] 取消选择 1-2 个书签
   - [ ] 点击"导入选中"按钮
   - [ ] 验证进度指示器正确显示
   - [ ] 验证成功提示显示正确的导入数量
   - [ ] 打开书签管理器，验证书签已成功导入到指定文件夹

**预期结果：**
- ✅ 所有步骤顺利完成
- ✅ 导入的书签与原始书签一致
- ✅ 没有错误提示

### 1.2 PC → 移动端分享流程

**测试目标：** 验证移动端只读展示和分享功能

**测试步骤：**

1. **生成分享链接**（同 1.1）

2. **在移动设备上访问**
   - [ ] 在手机浏览器中打开分享链接
   - [ ] 验证移动端检测成功
   - [ ] 验证显示"请在电脑上打开"提示
   - [ ] 验证书签列表以只读模式显示（无复选框）
   - [ ] 点击书签，验证在新标签页打开

3. **测试移动端分享**
   - [ ] 点击"复制链接"按钮
   - [ ] 验证成功提示
   - [ ] 点击"分享给朋友"按钮
   - [ ] 验证系统分享面板打开（支持的设备）
   - [ ] 或验证降级到复制链接（不支持的设备）

**预期结果：**
- ✅ 移动端正确识别
- ✅ 只读模式正常工作
- ✅ 分享功能正常

### 1.3 边界情况测试

**测试场景：**

1. **最大书签数量（20 个）**
   - [ ] 选择 20 个书签
   - [ ] 验证可以成功生成分享链接
   - [ ] 验证海报正确显示所有书签
   - [ ] 验证导入成功

2. **超过最大数量（21+ 个）**
   - [ ] 选择 21 个书签
   - [ ] 验证显示错误提示："分享数据过大，请减少书签数量"
   - [ ] 验证无法生成链接

3. **空书签列表**
   - [ ] 不选择任何书签
   - [ ] 验证"分享"按钮被禁用
   - [ ] 或验证显示提示："请至少选择一个书签"

4. **特殊字符书签**
   - [ ] 选择包含特殊字符的书签（emoji、中文、符号）
   - [ ] 验证编码/解码正确
   - [ ] 验证海报正确显示

5. **长标题/URL**
   - [ ] 选择标题或 URL 很长的书签
   - [ ] 验证海报中文本正确截断（显示 "..."）
   - [ ] 验证落地页正确显示完整内容

6. **无效分享链接**
   - [ ] 访问不完整的分享链接
   - [ ] 验证显示错误提示："分享链接无效或已损坏"
   - [ ] 验证显示重试按钮

7. **扩展未安装**
   - [ ] 在未安装扩展的浏览器中访问分享链接
   - [ ] 验证显示"安装扩展"提示
   - [ ] 验证"立即安装"按钮链接正确

**预期结果：**
- ✅ 所有边界情况都有合适的处理
- ✅ 错误提示清晰友好

---

## 2. 浏览器兼容性测试

### 2.1 Chrome 最新版本

**测试环境：** Chrome 131+ (2025 年最新版本)

**测试内容：**
- [ ] 扩展安装和加载
- [ ] 分享弹窗显示
- [ ] 海报生成
- [ ] 剪贴板 API
- [ ] 图片下载
- [ ] 分享落地页
- [ ] 书签导入

**预期结果：** ✅ 所有功能正常

### 2.2 Chrome 旧版本

**测试环境：** Chrome 129-130

**测试内容：**（同 2.1）

**预期结果：** ✅ 所有功能正常

### 2.3 移动端 Chrome

**测试环境：** Android Chrome / iOS Safari

**测试内容：**
- [ ] 分享链接访问
- [ ] 移动端检测
- [ ] 只读书签列表
- [ ] 复制链接
- [ ] 系统分享 API
- [ ] 响应式布局

**预期结果：** ✅ 移动端功能正常

### 2.4 API 兼容性检查

**Clipboard API：**
- [ ] 检查 `navigator.clipboard` 是否存在
- [ ] 测试 `writeText()` 方法
- [ ] 测试 `write()` 方法（图片复制）
- [ ] 验证降级方案（不支持时显示提示）

**Canvas API：**
- [ ] 检查 `document.createElement('canvas')` 是否支持
- [ ] 测试 `getContext('2d')` 方法
- [ ] 测试 `toDataURL()` 方法
- [ ] 测试 `toBlob()` 方法

**Web Share API：**
- [ ] 检查 `navigator.share` 是否存在
- [ ] 测试分享功能
- [ ] 验证降级方案（复制链接）

---

## 3. 性能测试

### 3.1 海报生成性能

**测试场景：**

| 书签数量 | 预期时间 | 实际时间 | 通过 |
|---------|---------|---------|------|
| 5 个 | < 1 秒 | _____ | ☐ |
| 10 个 | < 2 秒 | _____ | ☐ |
| 15 个 | < 3 秒 | _____ | ☐ |
| 20 个 | < 4 秒 | _____ | ☐ |

**测试方法：**
```javascript
// 在浏览器控制台中运行
console.time('poster-generation')
// 点击"生成链接"按钮
// 等待海报生成完成
console.timeEnd('poster-generation')
```

**优化建议：**
- ✅ 已实现离屏 Canvas 复用
- ✅ 已实现 Favicon LRU 缓存
- ✅ 已实现 requestAnimationFrame 优化
- ✅ 已实现防抖（300ms）

### 3.2 导入性能

**测试场景：**

| 书签数量 | 预期时间 | 实际时间 | 通过 |
|---------|---------|---------|------|
| 5 个 | < 2 秒 | _____ | ☐ |
| 10 个 | < 4 秒 | _____ | ☐ |
| 15 个 | < 6 秒 | _____ | ☐ |
| 20 个 | < 8 秒 | _____ | ☐ |

**测试方法：**
```javascript
// 在浏览器控制台中运行
console.time('import-bookmarks')
// 点击"导入选中"按钮
// 等待导入完成
console.timeEnd('import-bookmarks')
```

**优化建议：**
- ✅ 已实现分批导入（每批 10 个）
- ✅ 已实现 setTimeout(0) 让出主线程
- ✅ 已实现进度回调

### 3.3 数据压缩率

**测试场景：**

| 书签数量 | 原始大小 | 压缩后大小 | 压缩率 | 通过 |
|---------|---------|-----------|-------|------|
| 5 个 | _____ | _____ | _____ | ☐ |
| 10 个 | _____ | _____ | _____ | ☐ |
| 15 个 | _____ | _____ | _____ | ☐ |
| 20 个 | _____ | _____ | _____ | ☐ |

**测试方法：**
- 查看浏览器控制台日志
- 搜索 "数据编码成功"
- 记录 originalSize、compressedSize、compressionRatio

**预期结果：**
- 压缩率应在 60-80% 之间
- 压缩后大小应 < 2000 字符

### 3.4 内存使用

**测试方法：**
1. 打开 Chrome DevTools → Performance
2. 点击"Record"开始录制
3. 执行分享操作（生成海报、导入书签）
4. 停止录制
5. 查看内存使用情况

**预期结果：**
- 无明显内存泄漏
- 操作完成后内存恢复正常

---

## 4. 用户体验验证

### 4.1 加载状态

**测试内容：**
- [ ] 海报生成时显示加载指示器
- [ ] 加载指示器有动画效果
- [ ] 加载文案清晰："正在生成海报..."
- [ ] 导入时显示进度条
- [ ] 进度条实时更新
- [ ] 进度文案清晰："导入中... (5/10)"

**预期结果：** ✅ 用户始终知道系统在做什么

### 4.2 错误提示

**测试场景：**

| 错误类型 | 提示文案 | 是否友好 |
|---------|---------|---------|
| 数据过大 | "分享数据过大（XXX 字符），请减少书签数量（当前 XX 个）" | ☐ |
| 数据无效 | "分享链接无效或已损坏，请检查链接是否完整" | ☐ |
| 剪贴板不支持 | "浏览器不支持剪贴板功能，请手动复制" | ☐ |
| Canvas 不支持 | "浏览器不支持 Canvas，无法生成海报" | ☐ |
| 导入失败 | "导入完成：成功 X 个，失败 Y 个" | ☐ |

**预期结果：** ✅ 所有错误提示都清晰友好

### 4.3 交互反馈

**测试内容：**
- [ ] 按钮 hover 效果
- [ ] 按钮点击反馈
- [ ] 主题切换动画
- [ ] 书签选择高亮
- [ ] 成功提示动画
- [ ] 错误提示动画

**预期结果：** ✅ 交互流畅自然

### 4.4 可访问性

**测试内容：**
- [ ] 使用 Tab 键导航所有交互元素
- [ ] 使用 ESC 键关闭弹窗
- [ ] 使用屏幕阅读器测试（NVDA/JAWS/VoiceOver）
- [ ] 验证所有 ARIA 属性正确
- [ ] 验证焦点管理正确

**预期结果：** ✅ 符合 WCAG 2.1 AA 标准

### 4.5 响应式设计

**测试内容：**
- [ ] 桌面端（1920x1080）
- [ ] 笔记本（1366x768）
- [ ] 平板（768x1024）
- [ ] 手机（375x667）

**预期结果：** ✅ 所有设备上布局正常

---

## 5. 回归测试清单

在修改代码后，运行以下测试确保没有破坏现有功能：

### 5.1 核心功能
- [ ] 书签分享（选中书签）
- [ ] 文件夹分享（递归收集）
- [ ] 海报生成（深色/浅色主题）
- [ ] 复制图片
- [ ] 下载图片
- [ ] 生成分享链接
- [ ] 分享落地页加载
- [ ] 扩展检测
- [ ] 书签导入

### 5.2 代码质量
```bash
# 前端
cd frontend
bun run typecheck  # 类型检查
bun run lint       # 代码规范
bun run stylelint  # 样式检查

# 官网
cd website
bun run typecheck  # 类型检查
```

### 5.3 架构合规性
- [ ] 遵循单向数据流
- [ ] 遵循 DDD 分层架构
- [ ] 使用 IndexedDB 作为唯一数据源
- [ ] 禁止前端直接调用 Chrome API
- [ ] 使用 Zod 校验外部数据

---

## 6. 测试报告模板

### 测试信息
- **测试日期：** ___________
- **测试人员：** ___________
- **测试环境：** Chrome ___ / Windows/Mac/Linux
- **扩展版本：** ___________

### 测试结果

| 测试类别 | 通过 | 失败 | 跳过 | 备注 |
|---------|------|------|------|------|
| 端到端测试 | ☐ | ☐ | ☐ | |
| 浏览器兼容性 | ☐ | ☐ | ☐ | |
| 性能测试 | ☐ | ☐ | ☐ | |
| 用户体验 | ☐ | ☐ | ☐ | |

### 发现的问题

| 问题编号 | 严重程度 | 问题描述 | 重现步骤 | 状态 |
|---------|---------|---------|---------|------|
| 1 | 高/中/低 | | | 待修复/已修复 |
| 2 | 高/中/低 | | | 待修复/已修复 |

### 总体评价

- **功能完整性：** ☐ 优秀 ☐ 良好 ☐ 一般 ☐ 需改进
- **性能表现：** ☐ 优秀 ☐ 良好 ☐ 一般 ☐ 需改进
- **用户体验：** ☐ 优秀 ☐ 良好 ☐ 一般 ☐ 需改进
- **代码质量：** ☐ 优秀 ☐ 良好 ☐ 一般 ☐ 需改进

### 建议

___________________________________________
___________________________________________
___________________________________________

---

## 7. 自动化测试建议

虽然当前项目没有实现自动化测试，但以下是未来可以考虑的方向：

### 7.1 单元测试
- 使用 Vitest 测试 ShareService
- 使用 Vitest 测试 PosterService
- 使用 Vitest 测试 ImportService

### 7.2 集成测试
- 使用 Playwright 测试完整的分享流程
- 使用 Playwright 测试导入流程

### 7.3 视觉回归测试
- 使用 Percy 或 Chromatic 测试海报生成
- 使用 Percy 或 Chromatic 测试 UI 组件

---

**最后更新：** 2025-01-13  
**版本：** 1.0.0
