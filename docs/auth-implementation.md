# è®¤è¯ç³»ç»Ÿå®æ–½æ–‡æ¡£

## ğŸ“‹ å®æ–½æ¦‚è¿°

å·²å®Œæˆ **å…±äº«é€»è¾‘å±‚ï¼ŒUI ç‹¬ç«‹å®ç°** çš„è®¤è¯ç³»ç»Ÿæ¶æ„ã€‚

### âœ… å®Œæˆçš„å·¥ä½œ

#### 1. å…±äº«è®¤è¯æ ¸å¿ƒåŒ… (`packages/auth-core`)

**ç›®å½•ç»“æ„ï¼š**

```
packages/auth-core/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ types.ts              # TypeScript ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ validators.ts         # è¡¨å•éªŒè¯é€»è¾‘
â”‚   â”œâ”€â”€ error-codes.ts        # é”™è¯¯ç æ˜ å°„
â”‚   â”œâ”€â”€ auth-service.ts       # æ ¸å¿ƒè®¤è¯æœåŠ¡ç±»
â”‚   â””â”€â”€ index.ts              # ä¸»å¯¼å‡ºæ–‡ä»¶
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ README.md
```

**æ ¸å¿ƒåŠŸèƒ½ï¼š**

- âœ… `AuthService` ç±»ï¼šå°è£…æ‰€æœ‰ Supabase Auth äº¤äº’
- âœ… éªŒè¯å™¨ï¼šé‚®ç®±ã€å¯†ç éªŒè¯é€»è¾‘
- âœ… é”™è¯¯å¤„ç†ï¼šç»Ÿä¸€çš„é”™è¯¯ç æ˜ å°„
- âœ… ç±»å‹å®šä¹‰ï¼šå®Œæ•´çš„ TypeScript ç±»å‹æ”¯æŒ

#### 2. Website è®¤è¯é¡µé¢

**æ–°å¢é¡µé¢ï¼š**

- `/login` - ç™»å½•é¡µé¢
- `/register` - æ³¨å†Œé¡µé¢
- `/reset-password` - å¯†ç é‡ç½®é¡µé¢
- `/auth/callback` - OAuth å›è°ƒå¤„ç†é¡µé¢

**é¡µé¢ç‰¹ç‚¹ï¼š**

- ğŸ¨ æ·±è‰²ä¸»é¢˜ï¼Œç¬¦åˆå®˜ç½‘è®¾è®¡é£æ ¼
- ğŸ“± å“åº”å¼è®¾è®¡ï¼Œç§»åŠ¨ç«¯å‹å¥½
- âœ¨ ä¼˜é›…çš„åŠ¨ç”»æ•ˆæœ
- ğŸ” å®Œæ•´çš„è¡¨å•éªŒè¯
- ğŸš€ OAuth ç™»å½•æ”¯æŒï¼ˆGoogleï¼‰

#### 3. å¯¼èˆªæ›´æ–°

å·²åœ¨å®˜ç½‘ header æ·»åŠ ï¼š

- ç™»å½•æŒ‰é’®
- æ³¨å†ŒæŒ‰é’®

### ğŸ”„ å…±äº«å†…å®¹

| å†…å®¹                  | å…±äº«æ–¹å¼         | Extension           | Website     |
| --------------------- | ---------------- | ------------------- | ----------- |
| **Supabase Auth API** | `AuthService` ç±» | âœ… å°†è¿ç§»           | âœ… å·²ä½¿ç”¨   |
| **è¡¨å•éªŒè¯**          | `validators.ts`  | âœ… å°†è¿ç§»           | âœ… å·²ä½¿ç”¨   |
| **é”™è¯¯å¤„ç†**          | `error-codes.ts` | âœ… å°†è¿ç§»           | âœ… å·²ä½¿ç”¨   |
| **ç±»å‹å®šä¹‰**          | `types.ts`       | âœ… å°†è¿ç§»           | âœ… å·²ä½¿ç”¨   |
| **UI å®ç°**           | ç‹¬ç«‹             | Chrome Extension UI | Nuxt Web UI |

### ğŸ¯ æ¶æ„ä¼˜åŠ¿

#### âœ… ä»£ç å¤ç”¨

- æ ¸å¿ƒé€»è¾‘ï¼ˆAPIã€éªŒè¯ï¼‰ä»…ç»´æŠ¤ä¸€ä»½
- Bug ä¿®å¤ä¸€æ¬¡ï¼Œå…¨éƒ¨ç”Ÿæ•ˆ
- é¿å…é‡å¤ä»£ç 

#### âœ… çµæ´»æ€§

- UI å®Œå…¨ç‹¬ç«‹ï¼Œé€‚é…å„è‡ªåœºæ™¯
- Extensionï¼šå†…åµŒå¼ã€Chrome API é›†æˆ
- Websiteï¼šSSR ä¼˜åŒ–ã€SEO å‹å¥½

#### âœ… å¯ç»´æŠ¤æ€§

- é€»è¾‘é›†ä¸­åœ¨ `auth-core` åŒ…
- æ¸…æ™°çš„èŒè´£åˆ†ç¦»
- æ˜“äºæµ‹è¯•å’Œæ‰©å±•

#### âœ… ç‹¬ç«‹éƒ¨ç½²

- Extension å’Œ Website æ›´æ–°äº’ä¸å½±å“
- é™ä½è€¦åˆåº¦
- æé«˜å‘å¸ƒçµæ´»æ€§

## ğŸ“¦ å®‰è£…æ­¥éª¤

### 1. å®‰è£…ä¾èµ–

```bash
# æ¸…ç†å¹¶é‡æ–°å®‰è£…æ‰€æœ‰ä¾èµ–
bun run install:all
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

Website éœ€è¦é…ç½® Supabase ç¯å¢ƒå˜é‡ï¼š

```bash
# website/.env
VITE_SUPABASE_URL=your-supabase-url
VITE_SUPABASE_ANON_KEY=your-supabase-anon-key
```

### 3. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
# å¯åŠ¨ Website
cd website
bun run dev
```

### 4. è®¿é—®é¡µé¢

- ç™»å½•ï¼šhttp://localhost:3000/login
- æ³¨å†Œï¼šhttp://localhost:3000/register
- å¯†ç é‡ç½®ï¼šhttp://localhost:3000/reset-password

## ğŸ”„ ä¸‹ä¸€æ­¥ï¼ˆå¯é€‰ï¼‰

### Extension è¿ç§»åˆ°å…±äº«åŒ…

å¯ä»¥é€æ­¥å°† `frontend/src/composables/useSupabaseAuth.ts` é‡æ„ä¸ºä½¿ç”¨ `@acuity-bookmarks/auth-core`ï¼š

**æ­¥éª¤ï¼š**

1. å®‰è£…ä¾èµ–

```bash
cd frontend
bun add @acuity-bookmarks/auth-core
```

2. é‡æ„ composable

```typescript
// frontend/src/composables/useSupabaseAuth.ts
import { AuthService } from '@acuity-bookmarks/auth-core'
import { supabase } from '@/infrastructure/supabase/client'

const authService = new AuthService(supabase)

export function useSupabaseAuth() {
  // ä½¿ç”¨ authService.signIn(), authService.signUp() ç­‰
  // ä¿ç•™ Extension ç‰¹å®šçš„é€»è¾‘ï¼ˆChrome APIã€OAuth å¼¹çª—ç­‰ï¼‰
}
```

3. ä¿æŒ UI ä¸å˜

- `Auth.vue` ç»„ä»¶ä¿æŒä¸å˜
- ä»…é‡æ„åº•å±‚é€»è¾‘

**æ³¨æ„ï¼š** Extension çš„ OAuth æµç¨‹ä½¿ç”¨ `chrome.identity.launchWebAuthFlow`ï¼Œè¿™éƒ¨åˆ†é€»è¾‘åº”ä¿ç•™åœ¨ Extension ä¸­ï¼Œä¸æ”¾å…¥å…±äº«åŒ…ã€‚

## ğŸ“ ä»£ç è§„èŒƒ

### ç±»å‹å®‰å…¨

- æ‰€æœ‰å‡½æ•°éƒ½æœ‰å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰
- é¿å…ä½¿ç”¨ `any` ç±»å‹ï¼ˆé™¤é”™è¯¯å¤„ç†ï¼‰

### é”™è¯¯å¤„ç†

- ç»Ÿä¸€ä½¿ç”¨ `getErrorMessage()` è·å–å‹å¥½æç¤º
- æ•è·å¹¶æ­£ç¡®å¤„ç†æ‰€æœ‰å¼‚å¸¸

### éªŒè¯é€»è¾‘

- å‰ç«¯éªŒè¯ä½¿ç”¨å…±äº«éªŒè¯å™¨
- ä¿æŒä¸åç«¯éªŒè¯ä¸€è‡´

## ğŸ‰ å®ŒæˆçŠ¶æ€

- âœ… å…±äº«è®¤è¯æ ¸å¿ƒåŒ…åˆ›å»ºå®Œæˆ
- âœ… Website ç™»å½•é¡µé¢å®ç°å®Œæˆ
- âœ… Website æ³¨å†Œé¡µé¢å®ç°å®Œæˆ
- âœ… Website å¯†ç é‡ç½®é¡µé¢å®ç°å®Œæˆ
- âœ… OAuth å›è°ƒå¤„ç†å®ç°å®Œæˆ
- âœ… å¯¼èˆªæ ç™»å½•/æ³¨å†Œé“¾æ¥æ·»åŠ å®Œæˆ
- âœ… TypeScript ç±»å‹å®šä¹‰å®Œæ•´
- â¸ï¸ Extension è¿ç§»ï¼ˆå¯é€‰ï¼Œä¸å½±å“ç°æœ‰åŠŸèƒ½ï¼‰

## ğŸ”’ å®‰å…¨æ€§ä¿è¯

- âœ… ä¸å½±å“ç°æœ‰ Extension Auth é¡µé¢
- âœ… Extension å’Œ Website å®Œå…¨ç‹¬ç«‹
- âœ… å…±äº«åŒ…ä»…åŒ…å«çº¯é€»è¾‘ï¼Œæ— å‰¯ä½œç”¨
- âœ… æ‰€æœ‰å¯†ç ä¼ è¾“ä½¿ç”¨ HTTPS
- âœ… Supabase Auth æä¾›å®‰å…¨ä¿éšœ

---

**å®æ–½å®Œæˆï¼** ç°åœ¨å®˜ç½‘å·²å…·å¤‡å®Œæ•´çš„è®¤è¯åŠŸèƒ½ï¼Œä¸”ä¸ Extension å…±äº«æ ¸å¿ƒé€»è¾‘ã€‚ğŸš€
