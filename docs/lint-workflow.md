# 代码检查与修复工作流

## 🎯 设计理念

**检查即修复** - 不再区分检查和修复命令，一个命令完成所有工作。

---

## 📝 命令说明

### 根目录（推荐）

```bash
# 检查并自动修复所有项目
bun run lint
```

**执行流程：**

1. ✨ **Prettier 格式化** - 统一代码格式
2. 🔍 **ESLint 检查和修复** - 修复所有可自动修复的问题
3. 💅 **Stylelint 检查和修复** - 修复样式问题（Frontend）
4. 📊 **显示详细结果** - 哪些成功，哪些失败

**输出示例：**

```
🔍 开始代码检查和修复流程

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
步骤 1/3: Prettier 格式化
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
▶ 运行: bunx prettier --write ...
✓ 格式化完成

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
步骤 2/3: ESLint 检查和修复
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
▶ 运行: bunx turbo run lint
✅ ESLint: 所有问题已修复

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
步骤 3/3: Stylelint 检查和修复
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
▶ 运行: bun run stylelint
✅ Stylelint: 所有问题已修复

════════════════════════════════════════════════════════════
📊 修复结果汇总
════════════════════════════════════════════════════════════
✅ Prettier 格式化: 成功
✅ ESLint 检查修复: 成功
✅ Stylelint 检查修复: 成功
════════════════════════════════════════════════════════════

🎉 所有代码检查和修复完成！
```

---

### 单个项目

如果需要只检查某个项目：

```bash
# Frontend
cd frontend
bun run lint        # ESLint 检查和修复
bun run stylelint   # Stylelint 检查和修复

# Backend
cd backend
bun run lint        # ESLint 检查和修复

# Website
cd website
bun run typecheck   # 类型检查（Nuxt 内置）
```

---

## ✅ 优势

### 1. **自动化**

- 发现问题 → 立即修复
- 无需手动运行两次命令
- 减少人为错误

### 2. **清晰的反馈**

- 分步显示执行过程
- 总结修复结果
- 明确指出失败项

### 3. **简化流程**

- 提交前：`bun run lint`
- CI/CD：`bun run lint` + `bun run typecheck`
- 无需记忆多个命令

### 4. **统一标准**

- 所有项目使用相同流程
- Prettier → ESLint → Stylelint
- 保证代码风格一致

---

## 🔧 技术细节

### 为什么 lint 自动修复？

**可自动修复的问题：**

- 代码格式（缩进、空格、换行）
- 简单的代码问题（未使用的 import、分号等）
- 样式问题（属性顺序、单位等）

**无法自动修复的问题：**

- 类型错误（需要手动修改代码逻辑）
- 复杂的逻辑错误
- 安全问题

所以 `lint` 命令自动修复所有**可修复**的问题，**无法修复**的会报错并退出。

### 为什么 typecheck 单独？

TypeScript 类型检查**无法自动修复**，需要开发者手动修改代码，所以保持为独立命令：

```bash
bun run typecheck   # 仅检查，不修复
```

---

## 📋 提交前检查清单

```bash
# 1. 代码检查和修复（必须）
bun run lint

# 2. 类型检查（必须）
bun run typecheck

# 3. 如果都通过，提交代码
git add .
git commit -m "feat: xxx"
```

如果配置了 husky，`lint-staged` 会在提交时自动运行这些检查。

---

## 🎉 总结

**旧方式（繁琐）：**

```bash
bun run format       # 格式化
bun run lint         # 检查
bun run lint:fix     # 修复（现已删除）
bun run stylelint    # 检查样式
bun run stylelint:fix # 修复样式（现已删除）
# 需要运行 5 个命令！
```

**新方式（一键）：**

```bash
bun run lint         # ← 一个命令搞定！
# 自动执行：格式化 → 检查 → 修复 → 报告
```

简单、高效、清晰！🚀
