#!/usr/bin/env sh

# ç»Ÿä¸€åœ¨ä»“åº“æ ¹ç›®å½•è¿è¡Œï¼Œè¦†ç›– frontend ä¸ backend çš„æºç å˜æ›´
CHANGED_FILES=$(git diff --cached --name-only | grep -E "\.(js|ts|vue|css|md|json)$" | grep -vE "(^|/)node_modules/|(^|/)dist/|(^|/)\.husky/" || true)

if [ -z "$CHANGED_FILES" ]; then
    exit 0
fi

echo "ï¿½ pre-commit: è¿è¡Œ Prettier å’Œ ESLintï¼ˆroot ç»Ÿä¸€é…ç½®ï¼‰..."

# 1) Prettier å…¨é‡æ ¼å¼åŒ–å˜æ›´æ–‡ä»¶ï¼ˆå« js/ts/vue/css/md/jsonï¼‰
echo "$CHANGED_FILES" | xargs -I {} bunx prettier --write "{}"

# 2) ESLint ä»…æ£€æŸ¥ JS/TS/Vueï¼Œå¹¶è‡ªåŠ¨ä¿®å¤
LINT_FILES=$(echo "$CHANGED_FILES" | grep -E "\.(js|ts|vue)$" || true)
if [ -n "$LINT_FILES" ]; then
    echo "$LINT_FILES" | xargs -I {} bunx eslint "{}" --fix --no-warn-ignored
fi

# 3) é‡æ–°åŠ å…¥æš‚å­˜åŒº
echo "$CHANGED_FILES" | xargs git add

#!/bin/sh
echo "ğŸ” pre-commit: è¿è¡Œ Prettier å’Œ ESLintï¼ˆroot ç»Ÿä¸€é…ç½®ï¼‰..."

# Get list of staged files to process
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM)

if [ -n "$STAGED_FILES" ]; then
  # Format staged files with Prettier
  echo $STAGED_FILES | xargs bunx prettier --write --ignore-unknown || exit 1
  echo "âœ… Prettier formatting complete"
  
  # Run ESLint on staged JS/TS/Vue files
  JS_FILES=$(echo $STAGED_FILES | tr ' ' '\n' | grep -E '\.(js|ts|vue)$' | tr '\n' ' ')
  if [ -n "$JS_FILES" ]; then
    echo "ğŸ” Running ESLint on staged files..."
    echo $JS_FILES | xargs bunx eslint --cache --fix || exit 1
    echo "âœ… ESLint checks complete"
  fi
  
  # Re-add any fixed files to staging area
  echo $STAGED_FILES | xargs git add
else
  echo "âš ï¸  No staged files to process"
fi