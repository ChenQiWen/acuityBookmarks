name: Main CI/CD Pipeline

on:
  pull_request:
    types: [opened, reopened]
  issues:
    types: [opened]
  issue_comment:
    types: [created]
  schedule:
    - cron: '0 5 * * *'

jobs:
  pr-review:
    if: github.event_name == 'pull_request'
    permissions:
      contents: 'read'
      id-token: 'write'
      issues: 'write'
      pull-requests: 'write'
      statuses: 'write'
    # 路径已更新为您新的仓库
    uses: ChenQiWen/gemini-cli-action/.github/workflows/gemini-pr-review.yml@main
    with:
      pr_number: ${{ github.event.pull_request.number }}
    secrets: inherit

  issue-auto-triage:
    if: github.event_name == 'issues'
    permissions:
      contents: 'read'
      id-token: 'write'
      issues: 'write'
      statuses: 'write'
    # 路径已更新为您新的仓库
    uses: ChenQiWen/gemini-cli-action/.github/workflows/gemini-issue-automated-triage.yml@main
    with:
      issue_number: ${{ github.event.issue.number }}
      issue_title: ${{ github.event.issue.title }}
      issue_body: ${{ github.event.issue.body }}
    secrets: inherit

  issue-scheduled-triage:
    if: github.event_name == 'schedule'
    permissions:
      contents: 'read'
      id-token: 'write'
      issues: 'write'
      statuses: 'write'
    # 路径已更新为您新的仓库
    uses: ChenQiWen/gemini-cli-action/.github/workflows/gemini-issue-scheduled-triage.yml@main
    secrets: inherit

  abc-handler:
    if: >-
      github.event_name == 'issue_comment' &&
      contains(github.event.comment.body, '@abc')
    permissions:
      contents: 'write'
      id-token: 'write'
      pull-requests: 'write'
      issues: 'write'
    # 路径已更新为您新的仓库
    uses: ChenQiWen/gemini-cli-action/.github/workflows/gemini-cli.yml@main
    with:
      user_request: ${{ github.event.comment.body }}
      issue_number: ${{ github.event.issue.number }}
      is_pr: ${{ github.event.issue.pull_request != null }}
    secrets: inherit
