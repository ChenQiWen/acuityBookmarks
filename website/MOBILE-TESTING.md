# 移动端分享功能测试指南

## 功能概述

移动端分享落地页提供只读的书签展示，用户可以：

1. 查看分享的书签列表
2. 点击书签在新标签页打开
3. 复制分享链接
4. 使用系统分享 API 分享给朋友
5. 看到"请在电脑上打开"的提示

## 移动端检测逻辑

系统通过以下三个条件判断是否为移动设备：

1. **User Agent 检测** - 检查是否包含移动设备关键词
   - `android`, `iphone`, `ipad`, `ipod`, `mobile`, `webos`

2. **屏幕宽度检测** - 检查屏幕宽度是否小于 768px

3. **触摸支持检测** - 检查是否支持触摸屏

满足以下任一条件即判定为移动设备：

- User Agent 包含移动设备关键词
- 屏幕宽度 < 768px 且支持触摸

## 测试环境

### 方法 1：使用真实移动设备

1. 在移动设备上打开分享链接
2. 测试所有移动端功能

### 方法 2：使用 Chrome DevTools 模拟

1. 打开 Chrome DevTools（F12）
2. 点击"Toggle device toolbar"（Ctrl+Shift+M）
3. 选择移动设备型号（如 iPhone 12 Pro）
4. 刷新页面

### 方法 3：调整浏览器窗口

1. 将浏览器窗口宽度调整到 < 768px
2. 刷新页面
3. 确保触摸事件可用

## 测试用例

### 测试 1：移动端检测

**步骤：**

1. 在移动设备或模拟器中打开分享链接
2. 观察页面显示

**预期结果：**

- ✅ 显示"请在电脑上打开"提示
- ✅ 显示"复制链接"和"分享给朋友"按钮
- ✅ 不显示"安装扩展"提示
- ✅ 不显示文件夹选择和导入按钮
- ✅ 书签列表不显示复选框
- ✅ 点击书签项不会切换选中状态

### 测试 2：查看书签列表

**步骤：**

1. 在移动端打开分享链接
2. 滚动查看书签列表

**预期结果：**

- ✅ 书签列表正确显示
- ✅ 显示书签标题、URL、描述
- ✅ 显示 favicon 图标
- ✅ 列表可以流畅滚动
- ✅ 响应式布局正确

### 测试 3：点击书签打开 URL

**步骤：**

1. 在移动端打开分享链接
2. 点击任意书签的 URL 链接

**预期结果：**

- ✅ 在新标签页打开书签 URL
- ✅ 不影响当前分享页面
- ✅ 可以返回分享页面

### 测试 4：复制分享链接

**步骤：**

1. 在移动端打开分享链接
2. 点击"复制链接"按钮

**预期结果：**

- ✅ 显示"✅ 链接已复制到剪贴板"提示
- ✅ 链接已复制到剪贴板
- ✅ 可以粘贴到其他应用

**错误处理：**

- ❌ 如果复制失败，显示"❌ 复制失败，请手动复制链接"

### 测试 5：使用系统分享 API

**步骤：**

1. 在移动端打开分享链接
2. 点击"分享给朋友"按钮

**预期结果（支持 Web Share API）：**

- ✅ 打开系统分享面板
- ✅ 显示分享标题和描述
- ✅ 可以选择分享到不同应用（微信、QQ、邮件等）
- ✅ 分享成功后无提示
- ✅ 用户取消分享不显示错误

**预期结果（不支持 Web Share API）：**

- ✅ 降级到复制链接功能
- ✅ 显示"✅ 链接已复制到剪贴板"提示

### 测试 6：长按书签显示浏览器菜单

**步骤：**

1. 在移动端打开分享链接
2. 长按任意书签的 URL 链接

**预期结果：**

- ✅ 显示浏览器原生菜单
- ✅ 可以选择"在新标签页打开"
- ✅ 可以选择"复制链接"
- ✅ 可以选择"分享"

### 测试 7：移动端错误处理

**步骤 1：空数据**

1. 访问 `/share`（不带 data 参数）

**预期结果：**

- ✅ 显示"没有找到分享内容"
- ✅ 显示"请检查分享链接是否完整"

**步骤 2：无效数据**

1. 访问 `/share?data=invalid`

**预期结果：**

- ✅ 显示"无法加载分享内容"
- ✅ 显示错误消息
- ✅ 显示"重试"按钮

**步骤 3：网络错误**

1. 在移动端打开分享链接
2. 断开网络连接
3. 点击"重试"按钮

**预期结果：**

- ✅ 显示加载失败提示
- ✅ 可以重试加载

### 测试 8：响应式布局

**步骤：**

1. 在不同屏幕尺寸下打开分享链接
   - iPhone SE (375px)
   - iPhone 12 Pro (390px)
   - iPad (768px)
   - iPad Pro (1024px)

**预期结果：**

- ✅ 所有元素正确显示
- ✅ 文字大小适中
- ✅ 按钮大小合适（易于点击）
- ✅ 间距合理
- ✅ 不出现横向滚动条

### 测试 9：性能测试

**步骤：**

1. 在移动端打开包含 20 个书签的分享链接
2. 观察加载时间和滚动性能

**预期结果：**

- ✅ 页面加载时间 < 3 秒
- ✅ 滚动流畅，无卡顿
- ✅ 图标加载不阻塞页面
- ✅ 内存占用合理

### 测试 10：浏览器兼容性

**测试浏览器：**

- iOS Safari
- Android Chrome
- Android Firefox
- 微信内置浏览器
- QQ 内置浏览器

**预期结果：**

- ✅ 所有浏览器都能正确显示
- ✅ 移动端检测正确
- ✅ 分享功能正常（或降级到复制链接）
- ✅ 样式一致

## 移动端 vs 桌面端对比

| 功能       | 桌面端 | 移动端 |
| ---------- | ------ | ------ |
| 扩展检测   | ✅     | ❌     |
| 安装引导   | ✅     | ❌     |
| 书签选择   | ✅     | ❌     |
| 文件夹选择 | ✅     | ❌     |
| 导入书签   | ✅     | ❌     |
| 查看书签   | ✅     | ✅     |
| 点击打开   | ✅     | ✅     |
| 复制链接   | ❌     | ✅     |
| 系统分享   | ❌     | ✅     |
| 移动端提示 | ❌     | ✅     |

## 已知限制

1. **Web Share API 支持**
   - iOS Safari 12.2+
   - Android Chrome 61+
   - 不支持的浏览器会降级到复制链接

2. **剪贴板 API 支持**
   - 需要 HTTPS 或 localhost
   - 某些浏览器可能需要用户授权

3. **移动端检测**
   - 平板设备可能被识别为桌面端（取决于屏幕宽度）
   - 可以通过调整窗口宽度触发移动端模式

## 问题排查

### 问题 1：移动端检测失败

**症状：** 在移动设备上显示桌面端 UI

**排查步骤：**

1. 检查 User Agent
   ```javascript
   console.log(navigator.userAgent)
   ```
2. 检查屏幕宽度
   ```javascript
   console.log(window.innerWidth)
   ```
3. 检查触摸支持
   ```javascript
   console.log('ontouchstart' in window)
   console.log(navigator.maxTouchPoints)
   ```

### 问题 2：分享功能不工作

**症状：** 点击"分享给朋友"按钮没有反应

**排查步骤：**

1. 检查是否支持 Web Share API
   ```javascript
   console.log('share' in navigator)
   ```
2. 检查是否在 HTTPS 环境
3. 查看浏览器控制台错误

### 问题 3：复制链接失败

**症状：** 点击"复制链接"按钮显示失败

**排查步骤：**

1. 检查是否支持 Clipboard API
   ```javascript
   console.log('clipboard' in navigator)
   ```
2. 确认在 HTTPS 或 localhost 环境
3. 检查浏览器权限设置

## 测试清单

- [ ] 测试 1：移动端检测
- [ ] 测试 2：查看书签列表
- [ ] 测试 3：点击书签打开 URL
- [ ] 测试 4：复制分享链接
- [ ] 测试 5：使用系统分享 API
- [ ] 测试 6：长按书签显示浏览器菜单
- [ ] 测试 7：移动端错误处理
- [ ] 测试 8：响应式布局
- [ ] 测试 9：性能测试
- [ ] 测试 10：浏览器兼容性

---

**最后更新**: 2025-01-13  
**版本**: 1.0.0
