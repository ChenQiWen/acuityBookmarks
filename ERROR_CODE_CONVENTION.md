# é”™è¯¯ç è§„èŒƒæ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£å®šä¹‰äº†å‰åç«¯ç»Ÿä¸€çš„é”™è¯¯ç è§„èŒƒï¼Œç¡®ä¿æ‰€æœ‰é”™è¯¯éƒ½æœ‰ç”¨æˆ·å‹å¥½çš„æ–‡æ¡ˆã€‚

## ğŸ¯ è®¾è®¡åŸåˆ™

1. **ç»Ÿä¸€é”™è¯¯ç **ï¼šåç«¯è¿”å›æ ‡å‡†é”™è¯¯ç ï¼ˆ`code` å­—æ®µï¼‰ï¼Œå‰ç«¯æ ¹æ®é”™è¯¯ç æ˜ å°„æ˜¾ç¤ºæ–‡æ¡ˆ
2. **ç”¨æˆ·å‹å¥½**ï¼šæ‰€æœ‰é”™è¯¯æ–‡æ¡ˆéƒ½åº”è¯¥æ˜¯ç”¨æˆ·å¯ä»¥ç†è§£çš„ï¼Œé¿å…æŠ€æœ¯æœ¯è¯­
3. **å‰åç«¯è§£è€¦**ï¼šå‰ç«¯è´Ÿè´£é”™è¯¯æ–‡æ¡ˆçš„æœ¬åœ°åŒ–ï¼Œåç«¯åªè´Ÿè´£è¿”å›é”™è¯¯ç 
4. **æ˜“äºæ‰©å±•**ï¼šæ–°å¢é”™è¯¯ç åªéœ€è¦åœ¨å‰ç«¯æ˜ å°„è¡¨ä¸­æ·»åŠ å³å¯

## ğŸ”§ é”™è¯¯å“åº”æ ¼å¼

### Supabase é”™è¯¯æ ¼å¼

```json
{
  "code": "email_address_invalid",
  "message": "Email address \"xxx@qq.com\" is invalid"
}
```

### åç«¯è‡ªå®šä¹‰é”™è¯¯æ ¼å¼

```json
{
  "success": false,
  "error": "email_already_registered",
  "message": "è¯¥é‚®ç®±å·²è¢«æ³¨å†Œ" // å¯é€‰ï¼Œå‰ç«¯ä¼˜å…ˆä½¿ç”¨é”™è¯¯ç æ˜ å°„
}
```

## ğŸ“ é”™è¯¯ç åˆ†ç±»

### 1. Supabase è®¤è¯é”™è¯¯ç 

| é”™è¯¯ç                      | ç”¨æˆ·å‹å¥½æ–‡æ¡ˆ                                                 | è¯´æ˜         |
| -------------------------- | ------------------------------------------------------------ | ------------ |
| `email_address_invalid`    | é‚®ç®±æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·æ£€æŸ¥åé‡è¯•                                 | é‚®ç®±æ ¼å¼é”™è¯¯ |
| `email_already_registered` | è¯¥é‚®ç®±å·²è¢«æ³¨å†Œï¼Œè¯·ç›´æ¥ç™»å½•æˆ–ä½¿ç”¨å…¶ä»–é‚®ç®±                     | é‚®ç®±å·²æ³¨å†Œ   |
| `email_not_confirmed`      | è¯·å…ˆéªŒè¯é‚®ç®±ã€‚è¯·æ£€æŸ¥æ‚¨çš„é‚®ç®±å¹¶ç‚¹å‡»éªŒè¯é“¾æ¥å®Œæˆæ³¨å†Œåæ‰èƒ½ç™»å½• | é‚®ç®±æœªéªŒè¯   |
| `weak_password`            | å¯†ç ä¸ç¬¦åˆå®‰å…¨è¦æ±‚ï¼Œå¿…é¡»è‡³å°‘10ä½ï¼ŒåŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç¬¦å· | å¯†ç å¼ºåº¦ä¸è¶³ |
| `invalid_credentials`      | é‚®ç®±æˆ–å¯†ç é”™è¯¯ï¼Œè¯·æ£€æŸ¥åé‡è¯•ã€‚å¦‚æœåˆšæ³¨å†Œï¼Œè¯·å…ˆéªŒè¯é‚®ç®±       | ç™»å½•å‡­è¯é”™è¯¯ |
| `too_many_requests`        | è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•                                     | è¯·æ±‚é¢‘ç‡é™åˆ¶ |

### 2. åç«¯è‡ªå®šä¹‰é”™è¯¯ç 

| é”™è¯¯ç                       | ç”¨æˆ·å‹å¥½æ–‡æ¡ˆ                                                 | è¯´æ˜         |
| --------------------------- | ------------------------------------------------------------ | ------------ |
| `email_already_registered`  | è¯¥é‚®ç®±å·²è¢«æ³¨å†Œï¼Œè¯·ç›´æ¥ç™»å½•æˆ–ä½¿ç”¨å…¶ä»–é‚®ç®±                     | é‚®ç®±å·²æ³¨å†Œ   |
| `invalid_email`             | é‚®ç®±æ ¼å¼ä¸æ­£ç¡®                                               | é‚®ç®±æ ¼å¼é”™è¯¯ |
| `weak_password`             | å¯†ç ä¸ç¬¦åˆå®‰å…¨è¦æ±‚ï¼Œå¿…é¡»è‡³å°‘10ä½ï¼ŒåŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç¬¦å· | å¯†ç å¼ºåº¦ä¸è¶³ |
| `invalid email or password` | é‚®ç®±æˆ–å¯†ç é”™è¯¯                                               | ç™»å½•å‡­è¯é”™è¯¯ |
| `unauthorized`              | æœªæˆæƒï¼Œè¯·å…ˆç™»å½•                                             | æœªæˆæƒè®¿é—®   |
| `forbidden`                 | æ²¡æœ‰æƒé™è®¿é—®è¯¥èµ„æº                                           | æƒé™ä¸è¶³     |

## ğŸ”¨ å®ç°

### å‰ç«¯å®ç°

**æ–‡ä»¶ä½ç½®**ï¼š`frontend/src/infrastructure/http/error-codes.ts`

```typescript
import {
  getErrorMessage,
  extractErrorCode
} from '@/infrastructure/http/error-codes'

// ä½¿ç”¨ç¤ºä¾‹
try {
  await supabase.auth.signUp({ email, password })
} catch (error) {
  const errorCode = extractErrorCode(error)
  const friendlyMessage = getErrorMessage(errorCode, 'æ³¨å†Œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•')
  // æ˜¾ç¤º friendlyMessage ç»™ç”¨æˆ·
}
```

### åç«¯å®ç°

**çº¦å®š**ï¼šåç«¯è¿”å›çš„é”™è¯¯å“åº”å¿…é¡»åŒ…å« `code` æˆ– `error` å­—æ®µ

```javascript
// âœ… æ­£ç¡®ï¼šè¿”å›æ ‡å‡†é”™è¯¯ç 
return errorJson({ error: 'email_already_registered' }, 400)

// âŒ é”™è¯¯ï¼šç›´æ¥è¿”å›é”™è¯¯æ¶ˆæ¯
return errorJson({ error: 'è¯¥é‚®ç®±å·²è¢«æ³¨å†Œ' }, 400)
```

## ğŸš€ æ–°å¢é”™è¯¯ç æµç¨‹

1. **ç¡®å®šé”™è¯¯ç åç§°**ï¼šä½¿ç”¨å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿ï¼Œå¦‚ `email_address_invalid`
2. **åœ¨åç«¯è¿”å›é”™è¯¯ç **ï¼šç¡®ä¿é”™è¯¯å“åº”åŒ…å« `code` æˆ– `error` å­—æ®µ
3. **åœ¨å‰ç«¯æ˜ å°„è¡¨ä¸­æ·»åŠ **ï¼šåœ¨ `error-codes.ts` ä¸­æ·»åŠ æ˜ å°„å…³ç³»
4. **æµ‹è¯•éªŒè¯**ï¼šç¡®ä¿é”™è¯¯ç èƒ½æ­£ç¡®æ˜ å°„åˆ°ç”¨æˆ·å‹å¥½çš„æ–‡æ¡ˆ

## ğŸ“š å‚è€ƒ

- Supabase é”™è¯¯ç æ–‡æ¡£ï¼šhttps://supabase.com/docs/reference/javascript/auth-error-codes
- å‰ç«¯é”™è¯¯ç æ˜ å°„ï¼š`frontend/src/infrastructure/http/error-codes.ts`
- å‰ç«¯ä½¿ç”¨ç¤ºä¾‹ï¼š`frontend/src/composables/useSupabaseAuth.ts`
