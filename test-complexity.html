<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤æ‚åº¦è®¡ç®—æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .result {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            border-left: 4px solid #007bff;
        }
        .strategy-minor { border-left-color: #28a745; }
        .strategy-incremental { border-left-color: #ffc107; }
        .strategy-full-rebuild { border-left-color: #dc3545; }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
        .stat-item {
            background: #e9ecef;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
        }
        .stat-label {
            font-size: 12px;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <h1>ğŸ“Š ä¹¦ç­¾ä¿®æ”¹å¤æ‚åº¦è®¡ç®—æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>æµ‹è¯•è¯´æ˜</h2>
        <p>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯•ä¹¦ç­¾ä¿®æ”¹å¤æ‚åº¦è®¡ç®—å‡½æ•°çš„å„ç§åœºæ™¯ã€‚</p>
        <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®æ¥æµ‹è¯•ä¸åŒçš„ä¿®æ”¹åœºæ™¯ï¼š</p>
        <button onclick="testMinorChanges()">æµ‹è¯•è½»å¾®å˜åŒ–</button>
        <button onclick="testIncrementalChanges()">æµ‹è¯•ä¸­ç­‰å˜åŒ–</button>
        <button onclick="testMajorChanges()">æµ‹è¯•é‡å¤§å˜åŒ–</button>
        <button onclick="testComplexChanges()">æµ‹è¯•å¤æ‚å˜åŒ–</button>
    </div>

    <div id="results"></div>

    <script>
        // æ¨¡æ‹Ÿä¹¦ç­¾æ•°æ®
        const sampleOriginalTree = [
            {
                id: "1",
                title: "ä¹¦ç­¾æ ",
                children: [
                    {
                        id: "11",
                        title: "å·¥ä½œ",
                        children: [
                            { id: "111", title: "GitHub", url: "https://github.com" },
                            { id: "112", title: "Stack Overflow", url: "https://stackoverflow.com" }
                        ]
                    },
                    {
                        id: "12",
                        title: "å­¦ä¹ ",
                        children: [
                            { id: "121", title: "MDN", url: "https://developer.mozilla.org" },
                            { id: "122", title: "Vue.js", url: "https://vuejs.org" }
                        ]
                    },
                    { id: "13", title: "Google", url: "https://google.com" }
                ]
            },
            {
                id: "2",
                title: "å…¶ä»–ä¹¦ç­¾",
                children: [
                    { id: "21", title: "YouTube", url: "https://youtube.com" },
                    { id: "22", title: "Netflix", url: "https://netflix.com" }
                ]
            }
        ];

        // å¤åˆ¶å¤æ‚åº¦è®¡ç®—å‡½æ•°ï¼ˆç®€åŒ–ç‰ˆæœ¬ç”¨äºæµ‹è¯•ï¼‰
        function generateBookmarkId(node) {
            if (!node || !node.url) return "";
            const identifier = `${node.id || "no-id"}|${node.url}|${node.title || ""}`;
            let hash = 0;
            for (let i = 0; i < identifier.length; i++) {
                const char = identifier.charCodeAt(i);
                hash = (hash << 5) - hash + char;
                hash = hash & hash;
            }
            return Math.abs(hash).toString(36).substring(0, 16);
        }

        function calculateBasicStats(originalTree, proposedTree) {
            const stats = {
                originalCount: 0, proposedCount: 0,
                originalFolders: 0, proposedFolders: 0,
                originalBookmarks: 0, proposedBookmarks: 0
            };
            
            const countNodes = (nodes, isOriginal = true) => {
                for (const node of nodes || []) {
                    if (isOriginal) {
                        stats.originalCount++;
                        if (node.url) stats.originalBookmarks++;
                        else stats.originalFolders++;
                    } else {
                        stats.proposedCount++;
                        if (node.url) stats.proposedBookmarks++;
                        else stats.proposedFolders++;
                    }
                    if (node.children) countNodes(node.children, isOriginal);
                }
            };
            
            countNodes(originalTree, true);
            countNodes(proposedTree, false);
            return stats;
        }

        function calculateModificationComplexity(originalTree, proposedTree) {
            const analysis = {
                stats: { originalCount: 0, proposedCount: 0, originalFolders: 0, proposedFolders: 0, originalBookmarks: 0, proposedBookmarks: 0 },
                changes: { bookmarksMatched: 0, bookmarksUnmatched: 0, bookmarksMoved: 0, bookmarksRenamed: 0, foldersToCreate: 0, foldersToDelete: 0, structuralChanges: 0 },
                complexity: { dataChangePercentage: 0, structuralChangePercentage: 0, operationCount: 0, riskLevel: 'low', timeEstimate: 0 },
                recommendation: { strategy: 'full-rebuild', reason: '', confidence: 0 }
            };

            try {
                analysis.stats = calculateBasicStats(originalTree, proposedTree);
                
                // ç®€åŒ–çš„å˜åŒ–åˆ†æ
                const totalOriginal = analysis.stats.originalCount;
                const totalProposed = analysis.stats.proposedCount;
                const sizeDifference = Math.abs(totalOriginal - totalProposed);
                
                analysis.changes.bookmarksMatched = Math.min(analysis.stats.originalBookmarks, analysis.stats.proposedBookmarks);
                analysis.changes.bookmarksUnmatched = sizeDifference;
                analysis.changes.foldersToCreate = Math.max(0, analysis.stats.proposedFolders - analysis.stats.originalFolders);
                analysis.changes.foldersToDelete = Math.max(0, analysis.stats.originalFolders - analysis.stats.proposedFolders);
                
                // å¤æ‚åº¦è®¡ç®—
                const totalChanges = analysis.changes.bookmarksUnmatched + analysis.changes.foldersToCreate + analysis.changes.foldersToDelete;
                analysis.complexity.dataChangePercentage = totalOriginal > 0 ? (totalChanges / totalOriginal) * 100 : 0;
                analysis.complexity.operationCount = totalChanges;
                
                if (analysis.complexity.dataChangePercentage > 50) {
                    analysis.complexity.riskLevel = 'high';
                } else if (analysis.complexity.dataChangePercentage > 20) {
                    analysis.complexity.riskLevel = 'medium';
                }
                
                analysis.complexity.timeEstimate = Math.ceil(analysis.complexity.operationCount * 0.1);
                
                // ç­–ç•¥æ¨è
                if (analysis.complexity.dataChangePercentage <= 5 && analysis.complexity.operationCount <= 10) {
                    analysis.recommendation.strategy = 'minor-update';
                    analysis.recommendation.reason = 'å˜åŒ–å¾ˆå°ï¼Œé€‚åˆå¿«é€Ÿæ›´æ–°';
                    analysis.recommendation.confidence = 0.9;
                } else if (analysis.complexity.dataChangePercentage <= 30 && analysis.complexity.riskLevel !== 'high') {
                    analysis.recommendation.strategy = 'incremental';
                    analysis.recommendation.reason = 'ä¸­ç­‰ç¨‹åº¦å˜åŒ–ï¼Œå¢é‡æ›´æ–°æ›´é«˜æ•ˆ';
                    analysis.recommendation.confidence = 0.8;
                } else {
                    analysis.recommendation.strategy = 'full-rebuild';
                    analysis.recommendation.reason = 'å˜åŒ–è¾ƒå¤§ï¼Œå…¨é‡é‡å»ºé¿å…å¤æ‚æ€§';
                    analysis.recommendation.confidence = 0.85;
                }
                
            } catch (error) {
                analysis.recommendation = {
                    strategy: 'full-rebuild',
                    reason: 'å¤æ‚åº¦è®¡ç®—å¤±è´¥ï¼Œä½¿ç”¨å®‰å…¨çš„å…¨é‡é‡å»ºç­–ç•¥',
                    confidence: 1.0
                };
            }
            
            return analysis;
        }

        function displayResult(title, analysis) {
            const resultsDiv = document.getElementById('results');
            const strategyClass = `strategy-${analysis.recommendation.strategy.replace('_', '-')}`;
            
            const html = `
                <div class="test-section">
                    <h3>${title}</h3>
                    <div class="result ${strategyClass}">
                        <h4>ğŸ“‹ æ¨èç­–ç•¥: ${analysis.recommendation.strategy.toUpperCase()}</h4>
                        <p><strong>åŸå› :</strong> ${analysis.recommendation.reason}</p>
                        <p><strong>ç½®ä¿¡åº¦:</strong> ${Math.round(analysis.recommendation.confidence * 100)}%</p>
                    </div>
                    
                    <div class="stats">
                        <div class="stat-item">
                            <div class="stat-value">${analysis.complexity.dataChangePercentage.toFixed(1)}%</div>
                            <div class="stat-label">æ•°æ®å˜åŒ–ç™¾åˆ†æ¯”</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${analysis.complexity.operationCount}</div>
                            <div class="stat-label">é¢„ä¼°æ“ä½œæ•°é‡</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${analysis.complexity.riskLevel.toUpperCase()}</div>
                            <div class="stat-label">é£é™©ç­‰çº§</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${analysis.complexity.timeEstimate}s</div>
                            <div class="stat-label">é¢„ä¼°è€—æ—¶</div>
                        </div>
                    </div>
                    
                    <details>
                        <summary>è¯¦ç»†åˆ†ææ•°æ®</summary>
                        <pre>${JSON.stringify(analysis, null, 2)}</pre>
                    </details>
                </div>
            `;
            
            resultsDiv.innerHTML += html;
        }

        function testMinorChanges() {
            document.getElementById('results').innerHTML = '';
            
            // è½»å¾®å˜åŒ–ï¼šåªé‡å‘½åä¸€ä¸ªä¹¦ç­¾
            const proposedTree = JSON.parse(JSON.stringify(sampleOriginalTree));
            proposedTree[0].children[0].children[0].title = "GitHub (Updated)";
            
            const analysis = calculateModificationComplexity(sampleOriginalTree, proposedTree);
            displayResult("ğŸŸ¢ è½»å¾®å˜åŒ–æµ‹è¯• - é‡å‘½åä¸€ä¸ªä¹¦ç­¾", analysis);
        }

        function testIncrementalChanges() {
            document.getElementById('results').innerHTML = '';
            
            // ä¸­ç­‰å˜åŒ–ï¼šæ·»åŠ æ–°æ–‡ä»¶å¤¹å’Œå‡ ä¸ªä¹¦ç­¾
            const proposedTree = JSON.parse(JSON.stringify(sampleOriginalTree));
            proposedTree[0].children.push({
                id: "14",
                title: "æ–°é—»",
                children: [
                    { id: "141", title: "BBC", url: "https://bbc.com" },
                    { id: "142", title: "CNN", url: "https://cnn.com" }
                ]
            });
            
            const analysis = calculateModificationComplexity(sampleOriginalTree, proposedTree);
            displayResult("ğŸŸ¡ ä¸­ç­‰å˜åŒ–æµ‹è¯• - æ·»åŠ æ–°æ–‡ä»¶å¤¹å’Œä¹¦ç­¾", analysis);
        }

        function testMajorChanges() {
            document.getElementById('results').innerHTML = '';
            
            // é‡å¤§å˜åŒ–ï¼šå®Œå…¨é‡æ–°ç»„ç»‡ç»“æ„
            const proposedTree = [
                {
                    id: "1",
                    title: "ä¹¦ç­¾æ ",
                    children: [
                        {
                            id: "new1",
                            title: "å¼€å‘å·¥å…·",
                            children: [
                                { id: "111", title: "GitHub", url: "https://github.com" },
                                { id: "121", title: "MDN", url: "https://developer.mozilla.org" },
                                { id: "new2", title: "CodePen", url: "https://codepen.io" }
                            ]
                        },
                        {
                            id: "new3",
                            title: "å¨±ä¹",
                            children: [
                                { id: "21", title: "YouTube", url: "https://youtube.com" },
                                { id: "22", title: "Netflix", url: "https://netflix.com" }
                            ]
                        }
                    ]
                },
                {
                    id: "2",
                    title: "å…¶ä»–ä¹¦ç­¾",
                    children: []
                }
            ];
            
            const analysis = calculateModificationComplexity(sampleOriginalTree, proposedTree);
            displayResult("ğŸ”´ é‡å¤§å˜åŒ–æµ‹è¯• - å®Œå…¨é‡æ–°ç»„ç»‡ç»“æ„", analysis);
        }

        function testComplexChanges() {
            document.getElementById('results').innerHTML = '';
            
            // å¤æ‚å˜åŒ–ï¼šå¤§é‡æ–°å¢å’Œåˆ é™¤
            const proposedTree = [
                {
                    id: "1",
                    title: "ä¹¦ç­¾æ ",
                    children: Array.from({length: 20}, (_, i) => ({
                        id: `new${i}`,
                        title: `æ–°æ–‡ä»¶å¤¹${i}`,
                        children: Array.from({length: 5}, (_, j) => ({
                            id: `new${i}_${j}`,
                            title: `æ–°ä¹¦ç­¾${i}_${j}`,
                            url: `https://example${i}_${j}.com`
                        }))
                    }))
                },
                {
                    id: "2",
                    title: "å…¶ä»–ä¹¦ç­¾",
                    children: []
                }
            ];
            
            const analysis = calculateModificationComplexity(sampleOriginalTree, proposedTree);
            displayResult("ğŸš¨ å¤æ‚å˜åŒ–æµ‹è¯• - å¤§é‡æ–°å¢å†…å®¹", analysis);
        }

        // é¡µé¢åŠ è½½æ—¶è¿è¡Œä¸€ä¸ªç¤ºä¾‹
        window.onload = function() {
            testMinorChanges();
        };
    </script>
</body>
</html>
