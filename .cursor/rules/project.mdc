---
alwaysApply: true
---

# AcuityBookmarks é¡¹ç›®è§„åˆ™

ç”¨ä¸­æ–‡å›å¤

## ğŸ“š å¿…è¯»æ–‡æ¡£
**åœ¨å¼€å§‹ä»»ä½•å¼€å‘å·¥ä½œå‰ï¼Œå¿…é¡»å…ˆé˜…è¯»ä»¥ä¸‹æ–‡æ¡£ï¼š**
- **äº§å“æ–‡æ¡£ï¼ˆæœ€é‡è¦ï¼‰**ï¼š`æ–‡æ¡£/äº§å“æ–‡æ¡£/AcuityBookmarks-äº§å“æ–‡æ¡£-v3.0.md` - åŒ…å«å®Œæ•´çš„æŠ€æœ¯æ¶æ„ã€æ•°æ®æµè®¾è®¡ã€å­˜å‚¨æ–¹æ¡ˆã€å¼€å‘è§„èŒƒ
- å•å‘æ•°æ®æµè¯´æ˜ï¼š`å•å‘æ•°æ®æµæ¶æ„è¯´æ˜.md`
- å‰ç«¯æ¶æ„ï¼š`frontend/ARCHITECTURE.md`ï¼ˆå¦‚å­˜åœ¨ï¼‰

## ğŸš¨ æ ¸å¿ƒæ¶æ„åŸåˆ™ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰

### 1. å•å‘æ•°æ®æµï¼ˆç¦æ­¢è¿åï¼‰
```
Chrome API â†’ Background Script â†’ IndexedDB â†’ Pinia Store â†’ Vue Components
     â†‘                                                           â†“
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ chrome.runtime.sendMessage â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é“å¾‹ï¼š**
- âœ… **IndexedDB æ˜¯å”¯ä¸€æ•°æ®æº**ï¼šæ‰€æœ‰ UI ç»„ä»¶å¿…é¡»ä» IndexedDB è¯»å–æ•°æ®
- âœ… **Background Script æ˜¯å”¯ä¸€ç›‘å¬è€…**ï¼šåªæœ‰ `background/bookmarks.ts` å¯ä»¥ç›‘å¬ `chrome.bookmarks.on*` äº‹ä»¶
- âœ… **å‰ç«¯ç¦æ­¢ç›´æ¥è®¿é—® Chrome API**ï¼šæ‰€æœ‰ CRUD æ“ä½œå¿…é¡»é€šè¿‡ `chrome.runtime.sendMessage` å‘é€åˆ° Background Script
- âŒ **ç¦æ­¢å‰ç«¯ç›´æ¥è°ƒç”¨ `chrome.bookmarks.*`**ï¼šè¿™ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´

### 2. DDD åˆ†å±‚æ¶æ„ï¼ˆä¸¥æ ¼æ‰§è¡Œï¼‰
```
presentation/     # UI ç»„ä»¶ï¼ˆVueï¼‰- åªèƒ½è°ƒç”¨ application å±‚
    â†•
application/      # åº”ç”¨æœåŠ¡ - åè°ƒä¸šåŠ¡æµç¨‹
    â†•
core/             # é¢†åŸŸæ¨¡å‹ - çº¯ä¸šåŠ¡é€»è¾‘ï¼ˆä¸ä¾èµ–æ¡†æ¶ï¼‰
    â†•
infrastructure/   # åŸºç¡€è®¾æ–½ - IndexedDBã€Chrome API å°è£…
```

**ç¦æ­¢è·¨å±‚ç›´æ¥å¼•ç”¨ï¼š**
- âŒ `presentation/` ä¸èƒ½ç›´æ¥è®¿é—® `infrastructure/`
- âŒ `core/` ä¸èƒ½ä¾èµ– `infrastructure/`
- âœ… å¿…é¡»é€šè¿‡ `application/` åè°ƒ

### 3. IndexedDB ç®¡ç†å™¨ï¼ˆå”¯ä¸€å…¥å£ï¼‰
**æ­£ç¡®è·¯å¾„**ï¼š`frontend/src/infrastructure/indexeddb/manager.ts`
- âœ… æ‰€æœ‰ IndexedDB æ“ä½œå¿…é¡»é€šè¿‡ `indexedDBManager` å®ä¾‹
- âœ… æ‰€æœ‰æ•°æ®å¿…é¡»é€šè¿‡ Zod Schema æ ¡éªŒï¼ˆ`validation/records.ts`ï¼‰
- âŒ ç¦æ­¢ç›´æ¥ä½¿ç”¨ `indexedDB.open()` æˆ–åŸç”Ÿ IndexedDB API

## ğŸ’¾ å­˜å‚¨æ–¹æ¡ˆèŒè´£åˆ’åˆ†ï¼ˆå¿…é¡»éµå®ˆï¼‰

| å­˜å‚¨ç±»å‹ | ç”Ÿå‘½å‘¨æœŸ | ä½¿ç”¨åœºæ™¯ | è®¿é—®æ–¹å¼ |
|---------|---------|---------|---------|
| **IndexedDB** | æ°¸ä¹… | ä¹¦ç­¾æ•°æ®ï¼ˆ2ä¸‡+ï¼‰ã€çˆ¬å–å…ƒæ•°æ®ã€æœç´¢å†å² | `indexedDBManager.*` |
| **chrome.storage.local** | æ°¸ä¹… | ç”¨æˆ·åå¥½ã€æ‰©å±•é…ç½®ã€æŒä¹…åŒ–è®¾ç½® | `modernStorage.setLocal/getLocal` |
| **chrome.storage.session** | ä¼šè¯çº§ | ä¸´æ—¶æ•°æ®ã€UI çŠ¶æ€ã€æœªä¿å­˜è¡¨å•ã€åŒæ­¥çŠ¶æ€ | `modernStorage.setSession/getSession` |
| **Pinia Store** | é¡µé¢çº§ | é«˜é¢‘ UI çŠ¶æ€ã€è®¡ç®—å±æ€§ã€ä¸´æ—¶ç¼“å­˜ | `useXxxStore()` |

**å­˜å‚¨é€‰æ‹©å†³ç­–æ ‘ï¼š**
1. æ•°æ®é‡ > 1000 æ¡ï¼Ÿâ†’ IndexedDB
2. éœ€è¦æµè§ˆå™¨å…³é—­åä¿ç•™ï¼Ÿâ†’ chrome.storage.local
3. éœ€è¦è·¨é¡µé¢å…±äº«ä½†ä¼šè¯ç»“æŸæ¸…é™¤ï¼Ÿâ†’ chrome.storage.session
4. ä»…å½“å‰é¡µé¢ä½¿ç”¨ä¸”åˆ·æ–°åå¯é‡å»ºï¼Ÿâ†’ Pinia Store

## ğŸ› ï¸ ç°ä»£æŠ€æœ¯æ ˆä½¿ç”¨è§„èŒƒ

### Immerï¼ˆä¸å¯å˜çŠ¶æ€æ›´æ–°ï¼‰
**æ–‡ä»¶ä½ç½®**ï¼š`infrastructure/state/immer-helpers.ts`
```typescript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨ Immer æ›´æ–°å¤æ‚çŠ¶æ€
updateMap(nodes, draft => {
  draft.set('123', { ...draft.get('123'), title: 'æ–°æ ‡é¢˜' })
})

// âŒ é”™è¯¯ï¼šæ‰‹åŠ¨åˆ›å»ºæ–°å¯¹è±¡
const newNodes = new Map(nodes.value)
newNodes.set('123', { ...newNodes.get('123'), title: 'æ–°æ ‡é¢˜' })
nodes.value = newNodes
```

### TanStack Queryï¼ˆå¼‚æ­¥çŠ¶æ€ç®¡ç†ï¼‰
**ä½¿ç”¨åœºæ™¯**ï¼šéœ€è¦ç¼“å­˜ã€è‡ªåŠ¨é‡è¯•ã€ä¹è§‚æ›´æ–°çš„å¼‚æ­¥æ•°æ®
```typescript
// âœ… é€‚åˆï¼šå•ä¸ªä¹¦ç­¾è¯¦æƒ…æŸ¥è¯¢
const { data } = useBookmarkQuery(bookmarkId)

// âŒ ä¸é€‚åˆï¼šå…¨å±€çŠ¶æ€ï¼ˆä½¿ç”¨ Piniaï¼‰ã€å¤§æ‰¹é‡æ•°æ®ï¼ˆç›´æ¥ç”¨ IndexedDBï¼‰
```

### mittï¼ˆäº‹ä»¶æ€»çº¿ï¼‰
**æ–‡ä»¶ä½ç½®**ï¼š`infrastructure/events/event-bus.ts`
```typescript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨ç±»å‹å®‰å…¨çš„äº‹ä»¶
emitEvent('bookmark:created', { id: '123', bookmark: {...} })
onEvent('data:synced', (data) => { /* å¤„ç† */ })

// âŒ é”™è¯¯ï¼šä½¿ç”¨ window.dispatchEvent
window.dispatchEvent(new CustomEvent('...'))
```

### VueUseï¼ˆå®ç”¨å·¥å…·ï¼‰
**ä¼˜å…ˆä½¿ç”¨ VueUse æ›¿ä»£åŸç”Ÿ APIï¼š**
- `useEventListener` æ›¿ä»£ `addEventListener`ï¼ˆè‡ªåŠ¨æ¸…ç†ï¼‰
- `useDebounceFn` æ›¿ä»£æ‰‹åŠ¨é˜²æŠ–
- `useTimeoutFn` æ›¿ä»£ `setTimeout`ï¼ˆè‡ªåŠ¨æ¸…ç†ï¼‰

## ğŸ“ TypeScript è§„èŒƒï¼ˆé›¶å®¹å¿ï¼‰

### ç»å¯¹ç¦æ­¢
```typescript
// âŒ æ°¸ä¹…ç¦æ­¢ä½¿ç”¨ any
const data: any = await fetch(...)

// âŒ ç¦æ­¢ä½¿ç”¨ as any å¼ºåˆ¶ç±»å‹è½¬æ¢
const result = data as any

// âŒ ç¦æ­¢ä½¿ç”¨ unknown ç„¶åä¸æ ¡éªŒ
const value: unknown = ...
doSomething(value) // æ²¡æœ‰ç±»å‹å®ˆå«
```

### å¿…é¡»ä½¿ç”¨
```typescript
// âœ… ä½¿ç”¨ Zod æ ¡éªŒå¤–éƒ¨æ•°æ®
const data = await fetch(...)
const validated = BookmarkRecordSchema.parse(data)

// âœ… ä½¿ç”¨ç±»å‹å®ˆå«
function isBookmark(node: unknown): node is BookmarkNode {
  return typeof node === 'object' && node !== null && 'id' in node
}

// âœ… ä½¿ç”¨æ³›å‹
function updateItem<T extends { id: string }>(item: T): T {
  // ...
}
```

### JSDoc æ³¨é‡Šï¼ˆå¼ºåˆ¶è¦æ±‚ï¼‰
```typescript
/**
 * ä» IndexedDB åŠ è½½æ‰€æœ‰ä¹¦ç­¾
 * 
 * @returns ä¹¦ç­¾èŠ‚ç‚¹æ•°ç»„
 * @throws {Error} å¦‚æœæ•°æ®åº“æœªåˆå§‹åŒ–
 * 
 * @example
 * ```typescript
 * const bookmarks = await loadAllBookmarks()
 * ```
 */
async function loadAllBookmarks(): Promise<BookmarkNode[]> {
  // ...
}
```

## ğŸ¨ Vue ç»„ä»¶è§„èŒƒ

### ç»„ä»¶ç»“æ„
```vue
<script setup lang="ts">
import { defineOptions } from 'vue'

// 1. å®šä¹‰ç»„ä»¶åï¼ˆå¿…é¡»ï¼‰
defineOptions({
  name: 'SimpleBookmarkTree'
})

// 2. Props å®šä¹‰ï¼ˆä½¿ç”¨ TypeScriptï¼‰
interface Props {
  nodes: BookmarkNode[]
  searchQuery?: string
}
const props = withDefaults(defineProps<Props>(), {
  searchQuery: ''
})

// 3. Emits å®šä¹‰
interface Emits {
  (e: 'node-click', node: BookmarkNode): void
}
const emit = defineEmits<Emits>()

// 4. ç»„ä»¶é€»è¾‘
</script>
```

### ç¦æ­¢æ“ä½œ
- âŒ ç»„ä»¶å†…ç›´æ¥è°ƒç”¨ `chrome.bookmarks.*`
- âŒ ç»„ä»¶å†…ç›´æ¥è°ƒç”¨ `indexedDB.open()`
- âŒ ä½¿ç”¨å†…è” `style`ï¼ˆé™¤éåŠ¨æ€è®¡ç®—ï¼‰
- âŒ ç¡¬ç¼–ç æ–‡æ¡ˆï¼ˆå¿…é¡»ä½¿ç”¨ `_locales/` å¤šè¯­è¨€ï¼‰

## ğŸ”§ å…³é”®æ–‡ä»¶è·¯å¾„é€ŸæŸ¥

### æ•°æ®æµç›¸å…³
- ä¹¦ç­¾ç›‘å¬ï¼š`frontend/src/background/bookmarks.ts`
- æ¶ˆæ¯å¤„ç†ï¼š`frontend/src/background/messaging.ts`
- IndexedDB ç®¡ç†å™¨ï¼š`frontend/src/infrastructure/indexeddb/manager.ts`
- ä¹¦ç­¾åŒæ­¥æœåŠ¡ï¼š`frontend/src/services/bookmark-sync-service.ts`

### çŠ¶æ€ç®¡ç†
- ä¹¦ç­¾ Storeï¼š`frontend/src/stores/bookmarkStore.ts`
- ç®¡ç†é¡µ Storeï¼š`frontend/src/stores/bookmark/bookmark-management-store.ts`
- UI Storeï¼š`frontend/src/stores/ui/dialog-store.ts`

### åŸºç¡€è®¾æ–½
- å­˜å‚¨æŠ½è±¡ï¼š`frontend/src/infrastructure/storage/modern-storage.ts`
- äº‹ä»¶æ€»çº¿ï¼š`frontend/src/infrastructure/events/event-bus.ts`
- Immer å·¥å…·ï¼š`frontend/src/infrastructure/state/immer-helpers.ts`
- Query é…ç½®ï¼š`frontend/src/infrastructure/query/query-client.ts`

### UI ç»„ä»¶
- ç®¡ç†é¡µé¢ï¼š`frontend/src/pages/management/Management.vue`
- ä¹¦ç­¾æ ‘ï¼š`frontend/src/components/composite/SimpleBookmarkTree/`
- åŸºç¡€ç»„ä»¶ï¼š`frontend/src/components/base/`

## âš¡ æ€§èƒ½è¦æ±‚

**ç›®æ ‡**ï¼šæ”¯æŒ **2 ä¸‡ä¹¦ç­¾**çš„æµç•…æ“ä½œ

### ä¼˜åŒ–ç­–ç•¥
- âœ… è™šæ‹Ÿæ»šåŠ¨ï¼šä½¿ç”¨ `@tanstack/vue-virtual`ï¼ˆå¿…é¡»ï¼‰
- âœ… æ‰¹é‡æ“ä½œï¼šIndexedDB å†™å…¥åˆ†æ‰¹ï¼ˆé»˜è®¤ 2000/æ‰¹ï¼‰
- âœ… ç¼“å­˜æ ‘ç»“æ„ï¼š`bookmarkStore` ç¼“å­˜ `cachedTree`
- âœ… é€’å½’æ‰å¹³åŒ–ï¼šä½¿ç”¨ `flattenTreeToMap` å°†æ ‘è½¬ Mapï¼ˆO(1) æŸ¥æ‰¾ï¼‰
- âŒ ç¦æ­¢å…¨æ ‘é€’å½’éå†ï¼ˆæ€§èƒ½æ€æ‰‹ï¼‰

### æ€§èƒ½æŒ‡æ ‡
- åˆæ¬¡åŠ è½½ï¼š< 2s
- æ ‘ç»“æ„è®¡ç®—ï¼š< 50ms
- èŠ‚ç‚¹æŸ¥æ‰¾ï¼šO(1)
- æœç´¢å“åº”ï¼š< 100ms

## ğŸ”„ Pinia Store è§„èŒƒ

### Store ç»“æ„
```typescript
export const useBookmarkStore = defineStore('bookmarks', () => {
  // 1. Stateï¼ˆä½¿ç”¨ refï¼‰
  const nodes = ref<Map<string, BookmarkNode>>(new Map())
  
  // 2. Gettersï¼ˆä½¿ç”¨ computedï¼‰
  const bookmarkTree = computed(() => buildTree(nodes.value))
  
  // 3. Actionsï¼ˆæ™®é€šå‡½æ•°ï¼‰
  async function loadFromIndexedDB() {
    const records = await indexedDBManager.getAllBookmarks()
    // ä½¿ç”¨ Immer æ›´æ–°
    updateMap(nodes, draft => {
      records.forEach(r => draft.set(r.id, r))
    })
  }
  
  // 4. Returnï¼ˆæ˜ç¡®å¯¼å‡º APIï¼‰
  return {
    // State
    nodes: readonly(nodes),
    // Getters
    bookmarkTree,
    // Actions
    loadFromIndexedDB
  }
})
```

### ç¦æ­¢æ“ä½œ
- âŒ åœ¨ Store ä¸­ç›´æ¥è°ƒç”¨ Chrome API
- âŒ åœ¨ Store ä¸­ç›´æ¥æ“ä½œ IndexedDBï¼ˆåº”é€šè¿‡ `indexedDBManager`ï¼‰
- âŒ è·¨ Store ç›´æ¥ä¿®æ”¹çŠ¶æ€ï¼ˆåº”é€šè¿‡ Actionsï¼‰

## ğŸ›¡ï¸ é”™è¯¯å¤„ç†è§„èŒƒ

### å¿…é¡»æ•è·çš„åœºæ™¯
```typescript
// âœ… æ­£ç¡®ï¼šæ•è·å¹¶æä¾›é™çº§æ–¹æ¡ˆ
try {
  await indexedDBManager.updateBookmark(bookmark)
} catch (error) {
  logger.error('æ›´æ–°ä¹¦ç­¾å¤±è´¥', { bookmarkId: bookmark.id, error })
  // æ˜¾ç¤ºç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
  showToast('ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•', 'error')
  // æä¾›é™çº§æ–¹æ¡ˆï¼ˆå¦‚æ¢å¤æ—§å€¼ï¼‰
  revertChanges(bookmark)
}

// âŒ é”™è¯¯ï¼šé™é»˜å¤±è´¥
try {
  await indexedDBManager.updateBookmark(bookmark)
} catch (error) {
  // ä»€ä¹ˆéƒ½ä¸åš
}
```

## ğŸ§ª æµ‹è¯•è§„èŒƒ

### æµ‹è¯•å·¥å…·
- å•å…ƒæµ‹è¯•ï¼šVitest
- ç»„ä»¶æµ‹è¯•ï¼š@testing-library/vue
- E2E æµ‹è¯•ï¼šPuppeteer

### æµ‹è¯•è¾…åŠ©å‡½æ•°
**æ–‡ä»¶ä½ç½®**ï¼š`frontend/src/test-utils/index.ts`
```typescript
import { renderWithProviders } from '@/test-utils'

const { getByText } = renderWithProviders(MyComponent, {
  props: { title: 'Test' }
})
```

## ğŸ”§ å·¥å…·é“¾

### å‘½ä»¤é€ŸæŸ¥
```bash
# ç±»å‹æ£€æŸ¥ï¼ˆå¿…é¡»ï¼‰
bun run typecheck:force

# ä»£ç è´¨é‡ï¼ˆå¿…é¡»ï¼‰
bun run lint:fix:enhanced
bun run stylelint:fix:enhanced
bun run format

# æ„å»º
bun run build:hot              # çƒ­æ„å»ºï¼ˆæ¨èï¼‰
bun run build:frontend         # å¼€å‘æ„å»º

# æµ‹è¯•
bun run test                   # å•å…ƒæµ‹è¯•
bun run e2e:management         # E2E æµ‹è¯•
```

### æäº¤å‰æ£€æŸ¥æ¸…å•
- [ ] æ‰§è¡Œ `bun run typecheck:force`ï¼ˆé›¶é”™è¯¯ï¼‰
- [ ] æ‰§è¡Œ `bun run lint:fix:enhanced`ï¼ˆé›¶è­¦å‘Šï¼‰
- [ ] æ‰§è¡Œ `bun run format`ï¼ˆä»£ç æ ¼å¼åŒ–ï¼‰
- [ ] æ·»åŠ å……åˆ†çš„ä¸­æ–‡ JSDoc æ³¨é‡Š
- [ ] æ›´æ–°ç›¸å…³æµ‹è¯•ç”¨ä¾‹
- [ ] å¦‚æ¶‰åŠæ¶æ„/ä¸šåŠ¡å˜æ›´ï¼ŒåŒæ­¥æ›´æ–°äº§å“æ–‡æ¡£ v3.0

## ğŸ“„ æ–‡æ¡£åŒæ­¥ä¸ç»´æŠ¤

### æ¶æ„/ä¸šåŠ¡å˜æ›´å¿…é¡»åŒæ­¥æ–‡æ¡£
**å½“ä»¥ä¸‹æƒ…å†µå‘ç”Ÿæ—¶ï¼Œå¿…é¡»ç«‹å³æ›´æ–°äº§å“æ–‡æ¡£ï¼š**
- âœ… æŠ€æœ¯æ ˆå˜æ›´ï¼ˆæ–°å¢/ç§»é™¤ä¾èµ–ï¼‰
- âœ… DDD åˆ†å±‚è°ƒæ•´ï¼ˆæ–°å¢/ä¿®æ”¹å±‚çº§ï¼‰
- âœ… æ•°æ®æµå˜æ›´ï¼ˆCRUD æµç¨‹ã€äº‹ä»¶ç³»ç»Ÿï¼‰
- âœ… å­˜å‚¨æ–¹æ¡ˆå˜æ›´ï¼ˆIndexedDB è¡¨ç»“æ„ã€chrome.storage ä½¿ç”¨ï¼‰
- âœ… æ ¸å¿ƒåŠŸèƒ½å®ç°å˜æ›´ï¼ˆæœç´¢ã€åŒæ­¥ã€å¥åº·æ‰«æï¼‰
- âœ… API æ¥å£å˜æ›´ï¼ˆBackground Script æ¶ˆæ¯ç±»å‹ï¼‰

### æ–‡æ¡£æ›´æ–°èŒƒå›´
**äº§å“æ–‡æ¡£ä½ç½®**ï¼š`æ–‡æ¡£/äº§å“æ–‡æ¡£/AcuityBookmarks-äº§å“æ–‡æ¡£-v3.0.md`

**å¿…é¡»æ›´æ–°çš„ç« èŠ‚ï¼š**
- ç¬¬äºŒéƒ¨åˆ†ï¼šæŠ€æœ¯æ¶æ„ï¼ˆæŠ€æœ¯æ ˆã€DDD åˆ†å±‚ã€å•å‘æ•°æ®æµï¼‰
- ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ ¸å¿ƒåŠŸèƒ½ï¼ˆåŠŸèƒ½å®ç°ã€API è°ƒç”¨ï¼‰
- ç¬¬äº”éƒ¨åˆ†ï¼šæ•°æ®æµè®¾è®¡ï¼ˆCRUD æµç¨‹ã€äº‹ä»¶ç³»ç»Ÿï¼‰
- ç¬¬å…­éƒ¨åˆ†ï¼šå­˜å‚¨æ–¹æ¡ˆï¼ˆIndexedDB è¡¨ç»“æ„ã€chrome.storage ä½¿ç”¨ï¼‰
- ç¬¬ä¸ƒéƒ¨åˆ†ï¼šå…³é”®å®ç°ç»†èŠ‚ï¼ˆæ–°æŠ€æœ¯é›†æˆã€æ€§èƒ½ä¼˜åŒ–ï¼‰
- é™„å½• Bï¼šå…³é”®æ–‡ä»¶è·¯å¾„é€ŸæŸ¥è¡¨ï¼ˆå¦‚æœ‰æ–°å¢æ–‡ä»¶ï¼‰

### æ–‡æ¡£è´¨é‡è¦æ±‚
- âœ… ä¿æŒä¸åŸæ–‡æ¡£ç›¸åŒçš„è¯¦ç»†ç¨‹åº¦
- âœ… åŒ…å«ä»£ç ç¤ºä¾‹å’Œä½¿ç”¨è¯´æ˜
- âœ… æ›´æ–°ç‰ˆæœ¬å·å’Œæœ€åæ›´æ–°æ—¥æœŸ
- âœ… ç¡®ä¿ AI Agent èƒ½å‡†ç¡®ç†è§£å˜æ›´

## âš ï¸ å¸¸è§é”™è¯¯ä¸é˜²èŒƒ

### 1. æ•°æ®æµé”™è¯¯
```typescript
// âŒ é”™è¯¯ï¼šå‰ç«¯ç›´æ¥è°ƒç”¨ Chrome API
await chrome.bookmarks.create({ title: 'æ–°ä¹¦ç­¾' })

// âœ… æ­£ç¡®ï¼šé€šè¿‡ Background Script
await chrome.runtime.sendMessage({
  type: 'CREATE_BOOKMARK',
  title: 'æ–°ä¹¦ç­¾'
})
```

### 2. çŠ¶æ€æ›´æ–°é”™è¯¯
```typescript
// âŒ é”™è¯¯ï¼šç›´æ¥ä¿®æ”¹ Mapï¼ˆVue æ— æ³•æ£€æµ‹ï¼‰
nodes.value.set('123', newNode)

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ Immer
updateMap(nodes, draft => {
  draft.set('123', newNode)
})
```

### 3. IndexedDB è·¯å¾„é”™è¯¯
```typescript
// âŒ é”™è¯¯ï¼šä½¿ç”¨æ—§è·¯å¾„
import { indexedDBManager } from '@/utils-legacy/indexeddb-manager'

// âœ… æ­£ç¡®ï¼šä½¿ç”¨æ–°è·¯å¾„
import { indexedDBManager } from '@/infrastructure/indexeddb/manager'
```

### 4. ç¼ºå°‘ Zod æ ¡éªŒ
```typescript
// âŒ é”™è¯¯ï¼šç›´æ¥ä½¿ç”¨å¤–éƒ¨æ•°æ®
const bookmarks = await indexedDBManager.getAllBookmarks()
useBookmarks(bookmarks)

// âœ… æ­£ç¡®ï¼šå…ˆæ ¡éªŒ
const bookmarks = await indexedDBManager.getAllBookmarks()
const validated = BookmarkRecordArraySchema.parse(bookmarks)
useBookmarks(validated)
```

## ğŸ¯ å¼€å‘æµç¨‹

### æ–°åŠŸèƒ½å¼€å‘æµç¨‹
1. **é˜…è¯»äº§å“æ–‡æ¡£ v3.0**ï¼šç†è§£æ¶æ„å’Œçº¦æŸ
2. **ç¡®è®¤æ•°æ®æµ**ï¼šç¡®ä¿ç¬¦åˆå•å‘æ•°æ®æµ
3. **ç¡®è®¤å­˜å‚¨æ–¹æ¡ˆ**ï¼šé€‰æ‹©åˆé€‚çš„å­˜å‚¨å±‚çº§
4. **ç¼–å†™ TypeScript ç±»å‹**ï¼šç¦æ­¢ä½¿ç”¨ `any`
5. **æ·»åŠ  Zod Schema**ï¼šæ ¡éªŒå¤–éƒ¨æ•°æ®
6. **ç¼–å†™ JSDoc æ³¨é‡Š**ï¼šç¡®ä¿å¯è¯»æ€§
7. **è¿è¡Œç±»å‹æ£€æŸ¥**ï¼š`bun run typecheck:force`
8. **è¿è¡Œä»£ç è´¨é‡æ£€æŸ¥**ï¼š`bun run lint:fix:enhanced`
9. **ç¼–å†™æµ‹è¯•ç”¨ä¾‹**ï¼šç¡®ä¿åŠŸèƒ½æ­£ç¡®
10. **æ›´æ–°äº§å“æ–‡æ¡£**ï¼šå¦‚æ¶‰åŠæ¶æ„/ä¸šåŠ¡å˜æ›´

### Bug ä¿®å¤æµç¨‹
1. **å®šä½é—®é¢˜**ï¼šä½¿ç”¨ Chrome DevTools è°ƒè¯•
2. **åˆ†ææ ¹å› **ï¼šæ£€æŸ¥æ˜¯å¦è¿åæ¶æ„åŸåˆ™
3. **ä¿®å¤ä»£ç **ï¼šéµå¾ªä¸Šè¿°è§„èŒƒ
4. **æ·»åŠ æµ‹è¯•**ï¼šé˜²æ­¢å›å½’
5. **æ›´æ–°æ–‡æ¡£**ï¼šå¦‚æ¶‰åŠæµç¨‹å˜æ›´

## ğŸ’¡ è®¾è®¡å†³ç­–å‚è€ƒ

### ä½•æ—¶ä½¿ç”¨ Background Scriptï¼Ÿ
- âœ… ç›‘å¬ Chrome API äº‹ä»¶ï¼ˆ`chrome.bookmarks.on*`ï¼‰
- âœ… æ‰§è¡Œ Chrome API CRUD æ“ä½œ
- âœ… å®šæ—¶ä»»åŠ¡ï¼ˆ`chrome.alarms`ï¼‰
- âœ… è·¨é¡µé¢çŠ¶æ€åŒæ­¥

### ä½•æ—¶ä½¿ç”¨ Application Serviceï¼Ÿ
- âœ… åè°ƒå¤šä¸ªé¢†åŸŸæœåŠ¡
- âœ… ç¼–æ’å¤æ‚ä¸šåŠ¡æµç¨‹
- âœ… å¤„ç†è·¨å±‚é€šä¿¡

### ä½•æ—¶ä½¿ç”¨ Pinia Storeï¼Ÿ
- âœ… ç®¡ç†é¡µé¢çº§å…±äº«çŠ¶æ€
- âœ… æä¾›å“åº”å¼è®¡ç®—å±æ€§
- âœ… ç¼“å­˜é¢‘ç¹è®¿é—®çš„æ•°æ®

### ä½•æ—¶ä½¿ç”¨ Composablesï¼Ÿ
- âœ… å¯å¤ç”¨çš„ UI é€»è¾‘
- âœ… å°è£… Vue ç”Ÿå‘½å‘¨æœŸ
- âœ… æä¾›å“åº”å¼å·¥å…·å‡½æ•°

## ğŸ“Œ ç‰¹åˆ«æ³¨æ„äº‹é¡¹

1. **Chrome Extension é™åˆ¶**
   - Service Worker å¯èƒ½è¢«æš‚åœï¼Œä¸èƒ½ä¾èµ–å…¨å±€å˜é‡
   - ä½¿ç”¨ `chrome.storage.session` å­˜å‚¨ä¸´æ—¶çŠ¶æ€
   - å¤§æ•°æ®å¤„ç†ä½¿ç”¨ Web Worker

2. **æ€§èƒ½å…³é”®ç‚¹**
   - è™šæ‹Ÿæ»šåŠ¨å¿…é¡»ä½¿ç”¨ `@tanstack/vue-virtual`
   - é¿å…æ·±åº¦é€’å½’éå†ä¹¦ç­¾æ ‘
   - IndexedDB æ‰¹é‡æ“ä½œåˆ†æ‰¹æ‰§è¡Œ

3. **å®‰å…¨è€ƒè™‘**
   - æ‰€æœ‰å¤–éƒ¨è¾“å…¥å¿…é¡» Zod æ ¡éªŒ
   - ä½¿ç”¨ CSPï¼ˆContent Security Policyï¼‰
   - é¿å… XSSï¼ˆä¸ä½¿ç”¨ `v-html` é™¤éå¿…è¦ï¼‰

4. **ç¦»çº¿èƒ½åŠ›**
   - æ ¸å¿ƒåŠŸèƒ½å¿…é¡»ç¦»çº¿å¯ç”¨
   - IndexedDB ä½œä¸ºæœ¬åœ°ç¼“å­˜
   - ç½‘ç»œè¯·æ±‚éœ€è¦é™çº§æ–¹æ¡ˆ

---

## ğŸš€ æ€»ç»“ï¼šæ ¸å¿ƒè¦ç‚¹

**è®°ä½è¿™ä¸‰ç‚¹ï¼Œé¿å… 90% çš„é”™è¯¯ï¼š**

1. **å•å‘æ•°æ®æµ**ï¼šChrome API â†’ Background â†’ IndexedDB â†’ UI
2. **IndexedDB å”¯ä¸€æ•°æ®æº**ï¼šæ‰€æœ‰ UI ä» IndexedDB è¯»å–
3. **ç¦æ­¢å‰ç«¯ç›´æ¥è®¿é—® Chrome API**ï¼šå¿…é¡»é€šè¿‡ Background Script

**éµå¾ªè¿™äº›è§„èŒƒï¼Œç¡®ä¿ï¼š**
- âœ… ä»£ç æ¶æ„æ¸…æ™°
- âœ… æ•°æ®æµå‘ä¸€è‡´
- âœ… æ€§èƒ½æ»¡è¶³è¦æ±‚
- âœ… ç±»å‹å®‰å…¨å¯é 
- âœ… æ–‡æ¡£ä¸ä»£ç åŒæ­¥

---

_æœ€åæ›´æ–°ï¼š2025-10-26_
