# 🎨 组件与页面规范化重构方案

> **目标**: 建立清晰的组件分类体系和页面组织结构  
> **原则**: 职责单一、可复用、文档完善  
> **版本**: v1.0  
> **日期**: 2025-10-14

---

## 📋 目录

1. [新目录结构](#新目录结构)
2. [页面规范](#页面规范)
3. [组件分类体系](#组件分类体系)
4. [组件规范](#组件规范)
5. [迁移计划](#迁移计划)
6. [组件模板](#组件模板)

---

## 🏗️ 新目录结构

### 完整结构预览

```
frontend/src/
├── pages/                          # 📄 页面目录（新）
│   ├── popup/                      # 弹出窗口页面
│   │   ├── index.html
│   │   ├── main.ts
│   │   ├── Popup.vue
│   │   ├── components/             # 页面专用组件
│   │   └── README.md
│   ├── side-panel/                 # 侧边栏页面
│   │   ├── SidePanel.vue
│   │   ├── components/
│   │   └── README.md
│   ├── management/                 # 管理页面
│   │   ├── Management.vue
│   │   ├── components/
│   │   └── README.md
│   ├── auth/                       # 认证页面
│   │   ├── Login.vue
│   │   ├── components/
│   │   └── README.md
│   └── settings/                   # 设置页面
│       ├── Settings.vue
│       ├── components/
│       └── README.md
│
├── components/                     # 🧩 组件库（重构）
│   ├── base/                       # 基础 UI 组件（纯展示，无业务）
│   │   ├── Button/
│   │   │   ├── Button.vue
│   │   │   ├── Button.types.ts
│   │   │   ├── Button.test.ts
│   │   │   └── README.md
│   │   ├── Input/
│   │   ├── Checkbox/
│   │   ├── Icon/
│   │   ├── Card/
│   │   ├── Dialog/
│   │   ├── Tooltip/
│   │   └── ... (27个基础组件)
│   │
│   ├── composite/                  # 复合组件（业务相关）
│   │   ├── BookmarkTree/
│   │   │   ├── BookmarkTree.vue
│   │   │   ├── BookmarkTree.types.ts
│   │   │   ├── BookmarkTree.test.ts
│   │   │   ├── README.md
│   │   │   └── components/         # 子组件
│   │   │       ├── TreeNode/
│   │   │       └── TreeToolbar/
│   │   ├── SearchPanel/
│   │   │   ├── SearchPanel.vue
│   │   │   ├── SearchPanel.types.ts
│   │   │   ├── SearchPanel.test.ts
│   │   │   └── README.md
│   │   ├── BookmarkRecommendations/
│   │   └── InlineSearch/
│   │
│   └── index.ts                    # 统一导出
│
├── design-system/                  # 🎨 设计系统
├── core/                           # 🎯 核心业务层
├── infrastructure/                 # 🔧 基础设施层
├── application/                    # 🎬 应用服务层
└── ... (其他目录保持不变)
```

---

## 📄 页面规范

### 页面目录结构

每个页面遵循统一的结构：

```
pages/[页面名]/
├── [PageName].vue              # 主页面组件
├── main.ts                     # 入口文件（如果是独立页面）
├── index.html                  # HTML模板（如果是独立页面）
├── components/                 # 页面专用组件
│   ├── [ComponentName]/
│   │   ├── [ComponentName].vue
│   │   ├── [ComponentName].types.ts
│   │   └── README.md
├── composables/                # 页面专用 Composables
│   └── use[Feature].ts
├── types.ts                    # 页面类型定义
└── README.md                   # 页面文档
```

### 页面 README 模板

```markdown
# [页面名称]

## 📋 功能描述

[简要描述页面的主要功能]

## 🎯 使用场景

- 场景 1
- 场景 2

## 🔌 路由

- **路径**: `/[path]`
- **入口文件**: `main.ts`

## 📦 依赖组件

- `components/base/Button` - 按钮操作
- `components/composite/SearchPanel` - 搜索功能

## 🔄 数据流

1. 从 `indexedDBManager.getAllBookmarks()` 获取数据
2. 通过 `bookmarkAppService` 处理业务逻辑
3. 更新本地状态并渲染

## 🎨 状态管理

- **Store**: `useManagementStore`
- **关键状态**:
  - `isLoading` - 加载状态
  - `bookmarks` - 书签数据

## 🔧 配置项

无 / [列出配置项]

## 📝 注意事项

- [重要说明 1]
- [重要说明 2]
```

---

## 🧩 组件分类体系

### 基础 UI 组件 (Base Components)

**定位**: 纯展示组件，与业务逻辑完全解耦

**特征**:

- ✅ 无业务逻辑
- ✅ 通过 props 接收所有数据
- ✅ 通过 emits 发送所有事件
- ✅ 可在任何项目中复用
- ✅ 完全受控（Controlled Component）

**示例**:

```
base/
├── Button/              - 按钮
├── Input/               - 输入框
├── Checkbox/            - 复选框
├── Radio/               - 单选框
├── Select/              - 下拉选择
├── Switch/              - 开关
├── Icon/                - 图标
├── Badge/               - 徽章
├── Chip/                - 标签
├── Avatar/              - 头像
├── Card/                - 卡片
├── Dialog/              - 对话框
├── Tooltip/             - 工具提示
├── Dropdown/            - 下拉菜单
├── Tabs/                - 标签页
├── List/                - 列表
├── Grid/                - 网格
├── Divider/             - 分割线
├── Spinner/             - 加载指示器
├── ProgressBar/         - 进度条
├── Toast/               - 消息提示
├── Overlay/             - 遮罩层
├── Spacer/              - 间距
├── AppBar/              - 应用栏
├── Main/                - 主容器
├── SvgIcon/             - SVG图标
├── EmojiIcon/           - Emoji图标
├── UrlInput/            - URL输入框
└── ConfirmableDialog/   - 确认对话框
```

### 复合组件 (Composite Components)

**定位**: 业务相关组件，组合多个基础组件，包含业务逻辑

**特征**:

- ✅ 组合多个基础 UI 组件
- ✅ 包含自身的交互逻辑
- ✅ 可访问业务数据（通过 props 或 inject）
- ✅ 可调用 Application 层服务
- ❌ 不直接访问 Chrome API 或 IndexedDB

**示例**:

```
composite/
├── BookmarkTree/           - 书签树组件
│   ├── BookmarkTree.vue
│   ├── components/
│   │   ├── TreeNode/       - 树节点（子组件）
│   │   └── TreeToolbar/    - 树工具栏（子组件）
│   └── README.md
│
├── SearchPanel/            - 搜索面板
│   ├── SearchPanel.vue
│   ├── components/
│   │   ├── SearchInput/
│   │   ├── SearchResults/
│   │   └── SearchFilters/
│   └── README.md
│
├── BookmarkRecommendations/ - 智能推荐
│   ├── BookmarkRecommendations.vue
│   ├── components/
│   │   └── RecommendationItem/
│   └── README.md
│
└── InlineSearch/           - 内联搜索
    ├── InlineSearch.vue
    └── README.md
```

---

## 📐 组件规范

### 组件目录结构

**基础组件示例**:

```
components/base/Button/
├── Button.vue              # 组件实现
├── Button.types.ts         # TypeScript 类型定义
├── Button.test.ts          # 单元测试（可选）
└── README.md               # 组件文档
```

**复合组件示例**:

```
components/composite/BookmarkTree/
├── BookmarkTree.vue        # 主组件
├── BookmarkTree.types.ts   # 类型定义
├── BookmarkTree.test.ts    # 测试文件
├── README.md               # 组件文档
└── components/             # 子组件
    ├── TreeNode/
    │   ├── TreeNode.vue
    │   ├── TreeNode.types.ts
    │   └── README.md
    └── TreeToolbar/
        ├── TreeToolbar.vue
        ├── TreeToolbar.types.ts
        └── README.md
```

---

### 组件文件规范

#### 1. 组件实现 (`[Component].vue`)

```vue
<!--
  📦 [组件名称]
  
  功能：[简要描述]
  分类：基础组件 / 复合组件
  依赖：[列出依赖的其他组件]
-->

<script setup lang="ts">
import type { [Component]Props, [Component]Emits } from './[Component].types'

// Props 定义
const props = withDefaults(defineProps<[Component]Props>(), {
  // 默认值
})

// Emits 定义
const emit = defineEmits<[Component]Emits>()

// 组件逻辑
</script>

<template>
  <!-- 组件模板 -->
</template>

<style scoped>
/* 组件样式 */
</style>
```

#### 2. 类型定义 (`[Component].types.ts`)

```typescript
/**
 * 📦 [组件名称] - 类型定义
 */

/**
 * 组件 Props
 */
export interface [Component]Props {
  /**
   * [属性描述]
   * @default [默认值]
   */
  propName: string

  /**
   * [可选属性描述]
   */
  optionalProp?: number
}

/**
 * 组件 Emits
 */
export interface [Component]Emits {
  /**
   * [事件描述]
   * @param value - [参数描述]
   */
  (event: 'eventName', value: string): void
}

/**
 * 组件暴露的方法（通过 defineExpose）
 */
export interface [Component]Expose {
  /**
   * [方法描述]
   */
  methodName: () => void
}

/**
 * 内部状态类型（如果需要导出）
 */
export interface [Component]State {
  // ...
}
```

#### 3. 组件文档 (`README.md`)

```markdown
# [组件名称]

## 📋 概述

[组件的功能描述]

## 📦 分类

- [x] 基础 UI 组件
- [ ] 复合组件

## 🎯 使用场景

- 场景 1：[描述]
- 场景 2：[描述]

## 📖 API

### Props

| 属性名         | 类型     | 默认值 | 必填 | 描述   |
| -------------- | -------- | ------ | ---- | ------ |
| `propName`     | `string` | `''`   | 是   | [描述] |
| `optionalProp` | `number` | `0`    | 否   | [描述] |

### Emits

| 事件名      | 参数              | 描述   |
| ----------- | ----------------- | ------ |
| `eventName` | `(value: string)` | [描述] |

### Slots

| 插槽名    | Props           | 描述     |
| --------- | --------------- | -------- |
| `default` | -               | 默认插槽 |
| `footer`  | `{ data: any }` | 底部插槽 |

### Expose

| 方法名       | 参数 | 返回值 | 描述   |
| ------------ | ---- | ------ | ------ |
| `methodName` | `()` | `void` | [描述] |

## 💡 使用示例

### 基础使用

\`\`\`vue
<template>
<[Component]
prop-name="value"
@event-name="handleEvent"
/>
</template>

<script setup lang="ts">
const handleEvent = (value: string) => {
  console.log(value)
}
</script>

\`\`\`

### 高级用法

\`\`\`vue
<template>
<[Component] v-bind="config">
<template #footer="{ data }">
{{ data }}
</template>
</[Component]>
</template>
\`\`\`

## 🎨 样式定制

### CSS 变量

| 变量名              | 默认值 | 描述     |
| ------------------- | ------ | -------- |
| `--component-bg`    | `#fff` | 背景色   |
| `--component-color` | `#000` | 文字颜色 |

### 示例

\`\`\`css
.custom-component {
--component-bg: #f0f0f0;
--component-color: #333;
}
\`\`\`

## 📦 依赖组件

- `components/base/Icon` - 图标显示
- `components/base/Button` - 按钮操作

## ⚠️ 注意事项

- 注意事项 1
- 注意事项 2

## 🔄 更新日志

### v1.0.0 (2025-10-14)

- 初始版本
```

---

## 🚀 迁移计划

### Phase 1: 创建新目录结构 (1天)

#### Step 1.1: 创建 pages 目录

```bash
cd /Users/cqw/Documents/github/acuityBookmarks/frontend/src

# 创建 pages 目录
mkdir -p pages/{popup,side-panel,management,auth,settings}

# 为每个页面创建 components 目录
mkdir -p pages/popup/components
mkdir -p pages/side-panel/components
mkdir -p pages/management/components
mkdir -p pages/auth/components
mkdir -p pages/settings/components
```

#### Step 1.2: 创建新的 components 结构

```bash
# 创建基础组件目录
mkdir -p components/base
mkdir -p components/composite

# 移动现有 ui 组件到 base（保留原有 ui 目录作为过渡）
# （暂时不删除，等迁移完成后再清理）
```

---

### Phase 2: 迁移页面文件 (2-3天)

#### Step 2.1: 迁移 popup 页面

```bash
# 移动文件
mv popup/Popup.vue pages/popup/
mv popup/main.ts pages/popup/
mv popup/popup.html pages/popup/index.html

# 创建 README
touch pages/popup/README.md
```

**更新导入路径**:

```typescript
// 旧路径
import Component from '@/components/...'

// 新路径
import Component from '@/components/base/...'
```

#### Step 2.2: 迁移其他页面

按照同样的方式迁移：

- `side-panel/` → `pages/side-panel/`
- `management/` → `pages/management/`
- `auth/` → `pages/auth/`
- `settings/` → `pages/settings/`

#### Step 2.3: 更新 Vite 配置

```typescript
// frontend/vite.config.ts
export default defineConfig({
  build: {
    rollupOptions: {
      input: {
        popup: resolve(__dirname, 'src/pages/popup/index.html'),
        sidePanel: resolve(__dirname, 'src/pages/side-panel/index.html'),
        management: resolve(__dirname, 'src/pages/management/index.html')
        // ...
      }
    }
  }
})
```

---

### Phase 3: 重构组件库 (1周)

#### Step 3.1: 迁移基础 UI 组件

**组件清单** (27个):

从 `components/ui/` 迁移到 `components/base/`:

```bash
# 批量创建目录
cd components/base
for component in Button Input Checkbox Icon Card Dialog Tooltip \
                Switch Chip Badge Avatar Dropdown Tabs List Grid \
                Divider Spinner ProgressBar Toast Overlay Spacer \
                AppBar Main SvgIcon EmojiIcon UrlInput ConfirmableDialog; do
  mkdir -p $component
done
```

**为每个组件**:

1. 移动 `.vue` 文件到新目录
2. 创建 `.types.ts` 文件
3. 创建 `README.md` 文件
4. 更新导入路径

**示例：Button 组件**

```bash
# 1. 移动文件
cp components/ui/Button.vue components/base/Button/Button.vue

# 2. 创建类型文件
cat > components/base/Button/Button.types.ts << 'EOF'
/**
 * 📦 Button - 按钮组件类型定义
 */

export interface ButtonProps {
  /**
   * 按钮类型
   * @default 'primary'
   */
  variant?: 'primary' | 'secondary' | 'text' | 'outlined'

  /**
   * 按钮尺寸
   * @default 'md'
   */
  size?: 'sm' | 'md' | 'lg'

  /**
   * 是否禁用
   * @default false
   */
  disabled?: boolean

  /**
   * 是否加载中
   * @default false
   */
  loading?: boolean

  /**
   * 图标名称（左侧）
   */
  icon?: string

  /**
   * 图标名称（右侧）
   */
  iconRight?: string
}

export interface ButtonEmits {
  /**
   * 点击事件
   */
  (event: 'click', e: MouseEvent): void
}
EOF

# 3. 创建 README
# （使用上面的模板）
```

#### Step 3.2: 重构复合组件

**当前复合组件识别**:

```
现有组件 → 新位置
├── SimpleBookmarkTree.vue → composite/BookmarkTree/BookmarkTree.vue
├── SimpleTreeNode.vue → composite/BookmarkTree/components/TreeNode/TreeNode.vue
├── SmartBookmarkRecommendations.vue → composite/BookmarkRecommendations/BookmarkRecommendations.vue
└── PanelInlineSearch.vue → composite/InlineSearch/InlineSearch.vue
```

**迁移步骤**:

1. **BookmarkTree 组件**

```bash
# 创建目录
mkdir -p components/composite/BookmarkTree/components/{TreeNode,TreeToolbar}

# 迁移文件
mv components/SimpleBookmarkTree.vue \
   components/composite/BookmarkTree/BookmarkTree.vue

mv components/SimpleTreeNode.vue \
   components/composite/BookmarkTree/components/TreeNode/TreeNode.vue

# 创建类型文件
touch components/composite/BookmarkTree/BookmarkTree.types.ts
touch components/composite/BookmarkTree/components/TreeNode/TreeNode.types.ts

# 创建文档
touch components/composite/BookmarkTree/README.md
touch components/composite/BookmarkTree/components/TreeNode/README.md
```

2. **其他复合组件按同样方式处理**

---

### Phase 4: 创建统一导出 (1天)

#### 创建 `components/index.ts`

```typescript
/**
 * 🧩 组件库统一导出
 */

// ===== 基础 UI 组件 =====
export { default as Button } from './base/Button/Button.vue'
export { default as Input } from './base/Input/Input.vue'
export { default as Checkbox } from './base/Checkbox/Checkbox.vue'
export { default as Icon } from './base/Icon/Icon.vue'
export { default as Card } from './base/Card/Card.vue'
export { default as Dialog } from './base/Dialog/Dialog.vue'
export { default as Tooltip } from './base/Tooltip/Tooltip.vue'
// ... 其他基础组件

// ===== 复合组件 =====
export { default as BookmarkTree } from './composite/BookmarkTree/BookmarkTree.vue'
export { default as SearchPanel } from './composite/SearchPanel/SearchPanel.vue'
export { default as BookmarkRecommendations } from './composite/BookmarkRecommendations/BookmarkRecommendations.vue'
export { default as InlineSearch } from './composite/InlineSearch/InlineSearch.vue'

// ===== 类型导出 =====
export type * from './base/Button/Button.types'
export type * from './base/Input/Input.types'
// ... 其他类型
```

#### 使用示例

```vue
<script setup lang="ts">
// 统一导入
import { Button, Input, Icon } from '@/components'
import type { ButtonProps } from '@/components'
</script>
```

---

### Phase 5: 更新全局引用 (2天)

#### Step 5.1: 更新 tsconfig.json 路径别名

```json
{
  "compilerOptions": {
    "paths": {
      "@/*": ["./src/*"],
      "@/components": ["./src/components/index.ts"],
      "@/components/*": ["./src/components/*"],
      "@/pages/*": ["./src/pages/*"]
    }
  }
}
```

#### Step 5.2: 批量更新导入路径

使用脚本批量替换：

```bash
# 查找所有需要更新的文件
find src -type f \( -name "*.vue" -o -name "*.ts" \) -exec grep -l "components/ui/" {} \;

# 批量替换
find src -type f \( -name "*.vue" -o -name "*.ts" \) -exec sed -i '' 's|@/components/ui/|@/components/base/|g' {} \;
```

---

### Phase 6: 清理旧目录 (1天)

```bash
# 确认所有引用已更新后
rm -rf popup/
rm -rf side-panel/
rm -rf management/
rm -rf auth/
rm -rf settings/
rm -rf components/ui/
```

---

## 📝 组件文档模板

### 基础组件模板

创建脚手架脚本 `scripts/create-base-component.sh`:

```bash
#!/bin/bash

COMPONENT_NAME=$1

if [ -z "$COMPONENT_NAME" ]; then
  echo "Usage: ./create-base-component.sh <ComponentName>"
  exit 1
fi

DIR="frontend/src/components/base/$COMPONENT_NAME"
mkdir -p "$DIR"

# 创建 .vue 文件
cat > "$DIR/$COMPONENT_NAME.vue" << EOF
<!--
  📦 $COMPONENT_NAME

  功能：[描述]
  分类：基础 UI 组件
-->

<script setup lang="ts">
import type { ${COMPONENT_NAME}Props, ${COMPONENT_NAME}Emits } from './${COMPONENT_NAME}.types'

const props = withDefaults(defineProps<${COMPONENT_NAME}Props>(), {
  // 默认值
})

const emit = defineEmits<${COMPONENT_NAME}Emits>()
</script>

<template>
  <div class="${COMPONENT_NAME,,}">
    <!-- 组件内容 -->
  </div>
</template>

<style scoped>
.${COMPONENT_NAME,,} {
  /* 组件样式 */
}
</style>
EOF

# 创建 .types.ts 文件
cat > "$DIR/$COMPONENT_NAME.types.ts" << EOF
/**
 * 📦 $COMPONENT_NAME - 类型定义
 */

export interface ${COMPONENT_NAME}Props {
  // Props 定义
}

export interface ${COMPONENT_NAME}Emits {
  // Emits 定义
}
EOF

# 创建 README.md
cat > "$DIR/README.md" << EOF
# $COMPONENT_NAME

## 📋 概述

[组件描述]

## 📦 分类

- [x] 基础 UI 组件

## 🎯 使用场景

- 场景 1

## 📖 API

### Props

| 属性名 | 类型 | 默认值 | 必填 | 描述 |
|--------|------|--------|------|------|
| - | - | - | - | - |

### Emits

| 事件名 | 参数 | 描述 |
|--------|------|------|
| - | - | - |

## 💡 使用示例

\`\`\`vue
<template>
  <$COMPONENT_NAME />
</template>
\`\`\`
EOF

echo "✅ 基础组件 $COMPONENT_NAME 创建成功！"
echo "📁 位置: $DIR"
```

### 复合组件模板

创建脚手架脚本 `scripts/create-composite-component.sh`:

```bash
#!/bin/bash

COMPONENT_NAME=$1

if [ -z "$COMPONENT_NAME" ]; then
  echo "Usage: ./create-composite-component.sh <ComponentName>"
  exit 1
fi

DIR="frontend/src/components/composite/$COMPONENT_NAME"
mkdir -p "$DIR/components"

# 类似基础组件，但增加 components 目录

echo "✅ 复合组件 $COMPONENT_NAME 创建成功！"
```

---

## ✅ 验证清单

### 迁移完成后检查

- [ ] 所有页面文件已移动到 `src/pages/`
- [ ] 所有基础组件已移动到 `src/components/base/`
- [ ] 所有复合组件已移动到 `src/components/composite/`
- [ ] 每个组件都有 `.types.ts` 文件
- [ ] 每个组件都有 `README.md` 文件
- [ ] `components/index.ts` 导出所有组件
- [ ] 旧目录已删除
- [ ] 所有导入路径已更新
- [ ] TypeScript 编译通过
- [ ] ESLint 检查通过
- [ ] 应用正常运行
- [ ] 所有页面功能正常

---

## 🎯 预期成果

### 目录对比

**优化前**:

```
src/
├── popup/              (混乱)
├── side-panel/         (混乱)
├── management/         (混乱)
├── components/
│   ├── ui/             (无文档)
│   └── 业务组件.vue     (无分类)
```

**优化后**:

```
src/
├── pages/              (清晰)
│   ├── popup/          (有文档)
│   ├── side-panel/     (有文档)
│   └── management/     (有文档)
└── components/
    ├── base/           (27个基础组件，每个有文档)
    └── composite/      (4个复合组件，每个有文档)
```

### 组件使用体验

**优化前**:

```vue
<!-- 不清楚组件 API -->
<Button />
<!-- 不知道有哪些 props -->
```

**优化后**:

```vue
<!-- 完整的类型提示和文档 -->
<Button
  variant="primary"    <!-- 自动提示可选值 -->
  size="md"            <!-- 自动提示可选值 -->
  :loading="isLoading" <!-- 类型检查 -->
  @click="handleClick" <!-- 事件类型检查 -->
/>
```

---

## 📅 时间估算

| 阶段     | 任务           | 预计时间  |
| -------- | -------------- | --------- |
| Phase 1  | 创建新目录结构 | 1天       |
| Phase 2  | 迁移页面文件   | 2-3天     |
| Phase 3  | 重构组件库     | 1周       |
| Phase 4  | 创建统一导出   | 1天       |
| Phase 5  | 更新全局引用   | 2天       |
| Phase 6  | 清理旧目录     | 1天       |
| **总计** |                | **2-3周** |

---

**下一步**: 开始执行 Phase 1 - 创建新目录结构
