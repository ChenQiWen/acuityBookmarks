# ğŸ” AcuityBookmarks ä»£ç ä¸æ¶æ„å…¨é¢å®¡æ ¸æŠ¥å‘Š

> **å®¡æ ¸æ—¥æœŸ**: 2024å¹´
> **å®¡æ ¸èŒƒå›´**: å‰ç«¯æ¶æ„ã€åç«¯æ¶æ„ã€ä»£ç ç»„ç»‡ã€æ€§èƒ½ã€å¯ç»´æŠ¤æ€§
> **å®¡æ ¸ç»“è®º**: å‘ç°å¤šä¸ªæ¶æ„å±‚é¢çš„ä¸åˆç†è®¾è®¡ï¼Œéœ€è¦æ¸è¿›å¼ä¼˜åŒ–

---

## ğŸ“Š é¡¹ç›®æ¦‚å†µ

### é¡¹ç›®è§„æ¨¡

- **å‰ç«¯ä»£ç **: ~19,399 è¡Œ TypeScript
- **æ€»æ–‡ä»¶æ•°**: 104 ä¸ª TypeScript/Vue æ–‡ä»¶
- **å·¥å…·ç±»**: 24 ä¸ªæ–‡ä»¶ (~11,593 è¡Œ)
- **æœåŠ¡ç±»**: 9 ä¸ªæ–‡ä»¶
- **Store**: 3 ä¸ªæ–‡ä»¶
- **ç»„åˆå¼å‡½æ•°**: 3 ä¸ªæ–‡ä»¶

### æŠ€æœ¯æ ˆ

- **å‰ç«¯**: Vue 3 + TypeScript + Pinia + Vite
- **åç«¯**: Cloudflare Worker
- **å­˜å‚¨**: IndexedDB + Chrome Storage
- **æ„å»º**: Bun

---

## ğŸš¨ å‘ç°çš„ä¸»è¦é—®é¢˜

### âš ï¸ æ¶æ„å±‚é¢ (ä¸¥é‡)

#### 1. **è¿‡åº¦åˆ†æ•£çš„èŒè´£è¾¹ç•Œ** â­â­â­â­â­

**é—®é¢˜æè¿°**:

- `utils/` ç›®å½•æ‰¿æ‹…äº†è¿‡å¤šèŒè´£ï¼ŒåŒ…å« 24 ä¸ªæ–‡ä»¶ï¼Œè¶…è¿‡ 11,000 è¡Œä»£ç 
- å¾ˆå¤š"å·¥å…·ç±»"å®é™…ä¸Šæ˜¯æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼ˆå¦‚ `unified-bookmark-api.ts` 1264è¡Œï¼‰
- èŒè´£æ··æ·†ï¼šå·¥å…·å±‚ã€æœåŠ¡å±‚ã€APIå±‚ç•Œé™ä¸æ¸…

**å…·ä½“æ¡ˆä¾‹**:

```
frontend/src/
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ unified-bookmark-api.ts        (1264 è¡Œ - å®é™…æ˜¯APIå±‚)
â”‚   â”œâ”€â”€ smart-bookmark-manager.ts      (354 è¡Œ - å®é™…æ˜¯ä¸šåŠ¡å±‚)
â”‚   â”œâ”€â”€ smart-bookmark-executor.ts     (525 è¡Œ - å®é™…æ˜¯ä¸šåŠ¡å±‚)
â”‚   â”œâ”€â”€ smart-bookmark-diff-engine.ts  (530 è¡Œ - å®é™…æ˜¯æ ¸å¿ƒç®—æ³•)
â”‚   â””â”€â”€ operation-tracker.ts           (497 è¡Œ - å®é™…æ˜¯åŸºç¡€è®¾æ–½å±‚)
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ hybrid-search-engine.ts        (åº”è¯¥åœ¨utils?)
â”‚   â””â”€â”€ modern-bookmark-service.ts     (èŒè´£ä¸utilsé‡å )
```

**å½±å“**:

- ğŸ”´ æ–°äººéš¾ä»¥ç†è§£ä»£ç ç»„ç»‡
- ğŸ”´ é‡å¤ä»£ç å’ŒåŠŸèƒ½é‡å 
- ğŸ”´ æµ‹è¯•å›°éš¾ï¼ˆä¾èµ–å…³ç³»å¤æ‚ï¼‰
- ğŸ”´ ä¿®æ”¹é£é™©é«˜ï¼ˆç‰µä¸€å‘åŠ¨å…¨èº«ï¼‰

**ä¼˜åŒ–æ–¹æ¡ˆ**:

```
å»ºè®®çš„æ–°ç»“æ„:
frontend/src/
â”œâ”€â”€ core/              # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ bookmark/
â”‚   â”‚   â”œâ”€â”€ api.ts            # ä¹¦ç­¾API (from unified-bookmark-api)
â”‚   â”‚   â”œâ”€â”€ manager.ts        # ä¹¦ç­¾ç®¡ç† (from smart-bookmark-manager)
â”‚   â”‚   â”œâ”€â”€ executor.ts       # æ“ä½œæ‰§è¡Œ (from smart-bookmark-executor)
â”‚   â”‚   â””â”€â”€ diff-engine.ts    # å·®å¼‚å¼•æ“ (from smart-bookmark-diff-engine)
â”‚   â””â”€â”€ search/
â”‚       â”œâ”€â”€ hybrid-engine.ts  # æ··åˆæœç´¢å¼•æ“
â”‚       â””â”€â”€ fuse-search.ts    # Fuse.jså°è£…
â”œâ”€â”€ infrastructure/    # åŸºç¡€è®¾æ–½
â”‚   â”œâ”€â”€ indexeddb/     # IndexedDBç›¸å…³
â”‚   â”œâ”€â”€ chrome-api/    # Chrome APIå°è£…
â”‚   â””â”€â”€ operation-tracker.ts
â”œâ”€â”€ utils/            # çœŸæ­£çš„å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ debounce.ts
â”‚   â”œâ”€â”€ validators.ts
â”‚   â””â”€â”€ formatters.ts
â””â”€â”€ services/         # åº”ç”¨æœåŠ¡
    â”œâ”€â”€ favicon.ts
    â””â”€â”€ crawler.ts
```

---

#### 2. **Storeä¸ä¸šåŠ¡é€»è¾‘è€¦åˆè¿‡é‡** â­â­â­â­

**é—®é¢˜æè¿°**:

- Store ç›´æ¥åŒ…å«å¤§é‡ä¸šåŠ¡é€»è¾‘ï¼ˆå¦‚ `management-store.ts` ä¸­çš„æ ‘è½¬æ¢ã€ç¼“å­˜ç®¡ç†ï¼‰
- Store åº”è¯¥æ˜¯çº¯ç²¹çš„çŠ¶æ€ç®¡ç†ï¼Œä¸åº”åŒ…å«å¤æ‚ç®—æ³•
- è¿åå•ä¸€èŒè´£åŸåˆ™

**å…·ä½“æ¡ˆä¾‹**:

```typescript
// management-store.ts (ä¸åˆç†)
export const useManagementStore = defineStore('management', () => {
  // âŒ åŒ…å«å¤æ‚çš„æ ‘è½¬æ¢é€»è¾‘
  const convertCachedToTreeNodes = (
    cached: any[]
  ): ChromeBookmarkTreeNode[] => {
    // 50+ è¡Œçš„æ ‘é‡å»ºé€»è¾‘
  }

  // âŒ åŒ…å«ç¼“å­˜ç®¡ç†é€»è¾‘
  const loadFromFastCache = async (): Promise<boolean> => {
    // å¤æ‚çš„ç¼“å­˜è¯»å–å’ŒéªŒè¯é€»è¾‘
  }

  // âŒ åŒ…å«å·®å¼‚æ¯”å¯¹é€»è¾‘
  const compareStructures = () => {
    // å¤æ‚çš„æ ‘æ¯”å¯¹ç®—æ³•
  }
})
```

**å½±å“**:

- ğŸ”´ Store ä»£ç è‡ƒè‚¿ï¼Œéš¾ä»¥ç»´æŠ¤
- ğŸ”´ ä¸šåŠ¡é€»è¾‘æ— æ³•å•ç‹¬æµ‹è¯•
- ğŸ”´ çŠ¶æ€ç®¡ç†å’Œä¸šåŠ¡é€»è¾‘æ··åœ¨ä¸€èµ·ï¼Œè¿åå…³æ³¨ç‚¹åˆ†ç¦»

**ä¼˜åŒ–æ–¹æ¡ˆ**:

```typescript
// æ”¹è¿›æ–¹æ¡ˆï¼šæŠ½å–ä¸šåŠ¡é€»è¾‘åˆ°ä¸“é—¨çš„æœåŠ¡

// core/bookmark/tree-converter.ts
export class BookmarkTreeConverter {
  convertCachedToTreeNodes(cached: any[]): ChromeBookmarkTreeNode[] {
    // æ ‘è½¬æ¢é€»è¾‘
  }
}

// core/bookmark/cache-manager.ts
export class BookmarkCacheManager {
  async loadFromCache(): Promise<ChromeBookmarkTreeNode[] | null> {
    // ç¼“å­˜ç®¡ç†é€»è¾‘
  }
}

// stores/management-store.ts (ç²¾ç®€å)
export const useManagementStore = defineStore('management', () => {
  const treeConverter = new BookmarkTreeConverter()
  const cacheManager = new BookmarkCacheManager()

  // âœ… Storeåªè´Ÿè´£çŠ¶æ€å’Œç®€å•çš„çŠ¶æ€æ›´æ–°
  const originalTree = ref<ChromeBookmarkTreeNode[]>([])

  async function loadData() {
    const cached = await cacheManager.loadFromCache()
    if (cached) {
      originalTree.value = treeConverter.convertCachedToTreeNodes(cached)
    }
  }
})
```

---

#### 3. **æ–‡ä»¶å‘½åä¸ä¸€è‡´å’ŒèŒè´£ä¸æ˜** â­â­â­

**é—®é¢˜æè¿°**:

- `smart-bookmark-*` ç³»åˆ—å‘½åè¿‡äºæ¨¡ç³Š
- `unified-*` å‘½åè¡¨æ˜æ•´åˆï¼Œä½†èŒè´£ä¸æ¸…
- `lightweight-*` vs `modern-*` å‘½åæ— æ³•åæ˜ çœŸå®å·®å¼‚

**å…·ä½“æ¡ˆä¾‹**:

```
utils/
â”œâ”€â”€ smart-bookmark-manager.ts      # "smart" æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ
â”œâ”€â”€ smart-bookmark-executor.ts     # ä¸ manager çš„åŒºåˆ«ï¼Ÿ
â”œâ”€â”€ smart-bookmark-diff-engine.ts  # ä¸ºä»€ä¹ˆåœ¨ utilsï¼Ÿ
â”œâ”€â”€ unified-bookmark-api.ts        # ç»Ÿä¸€äº†ä»€ä¹ˆï¼Ÿ
â”œâ”€â”€ unified-ai-api.ts              # ä¸ä¸Šé¢çš„å…³ç³»ï¼Ÿ
â”œâ”€â”€ lightweight-bookmark-enhancer.ts  # ä¸ modern æœ‰ä½•åŒºåˆ«ï¼Ÿ
â””â”€â”€ modern-bookmark-service.ts        # è°æ›´"ç°ä»£"ï¼Ÿ
```

**å½±å“**:

- ğŸŸ¡ å¼€å‘è€…éœ€è¦æ‰“å¼€æ–‡ä»¶æ‰èƒ½çŸ¥é“å†…å®¹
- ğŸŸ¡ å®¹æ˜“åˆ›å»ºé‡å¤åŠŸèƒ½
- ğŸŸ¡ ä»£ç æœç´¢å›°éš¾

**ä¼˜åŒ–æ–¹æ¡ˆ**:

```
å»ºè®®å‘½åè§„èŒƒ:
âœ… bookmark-api.ts          # æ¸…æ™°çš„APIå±‚
âœ… bookmark-operations.ts   # æ“ä½œæ‰§è¡Œ
âœ… bookmark-differ.ts       # å·®å¼‚å¯¹æ¯”
âœ… bookmark-cache.ts        # ç¼“å­˜ç®¡ç†
âœ… ai-embeddings.ts         # AIåµŒå…¥
âœ… search-hybrid.ts         # æ··åˆæœç´¢
```

---

#### 4. **å¤šå¥—æœç´¢ç³»ç»Ÿå¹¶å­˜** â­â­â­â­

**é—®é¢˜æè¿°**:

- `services/hybrid-search-engine.ts`
- `services/fuse-search.ts`
- `composables/useBookmarkSearch.ts`
- `utils/unified-bookmark-api.ts` ä¸­ä¹Ÿæœ‰æœç´¢é€»è¾‘

**å…·ä½“é—®é¢˜**:

```typescript
// æœç´¢åŠŸèƒ½åˆ†æ•£åœ¨å¤šä¸ªåœ°æ–¹
services / hybrid - search - engine.ts // ä¸€å¥—æœç´¢
services / fuse - search.ts // å¦ä¸€å¥—æœç´¢
composables / useBookmarkSearch.ts // ç¬¬ä¸‰å¥—å°è£…
unified - bookmark - api.ts // åˆä¸€å¥—API
```

**å½±å“**:

- ğŸ”´ ç»´æŠ¤æˆæœ¬é«˜ï¼ˆä¿®æ”¹éœ€è¦åŒæ­¥4å¤„ï¼‰
- ğŸ”´ åŠŸèƒ½ä¸ä¸€è‡´ï¼ˆä¸åŒé¡µé¢æœç´¢ç»“æœå¯èƒ½ä¸åŒï¼‰
- ğŸ”´ æ€§èƒ½ä¼˜åŒ–å›°éš¾ï¼ˆä¼˜åŒ–åˆ†æ•£ï¼‰

**ä¼˜åŒ–æ–¹æ¡ˆ**:

```
ç»Ÿä¸€æœç´¢æ¶æ„:
core/search/
â”œâ”€â”€ engine.ts              # æ ¸å¿ƒæœç´¢å¼•æ“ï¼ˆå•ä¸€ï¼‰
â”œâ”€â”€ strategies/            # ä¸åŒæœç´¢ç­–ç•¥
â”‚   â”œâ”€â”€ fuse-strategy.ts
â”‚   â”œâ”€â”€ hybrid-strategy.ts
â”‚   â””â”€â”€ ai-strategy.ts
â””â”€â”€ index.ts              # ç»Ÿä¸€å¯¼å‡º

composables/
â””â”€â”€ useBookmarkSearch.ts  # UIå°è£…ï¼ˆåŸºäºcore/searchï¼‰

å„é¡µé¢é€šè¿‡ composables ä½¿ç”¨ï¼Œåº•å±‚ç»Ÿä¸€
```

---

### âš ï¸ ä»£ç è´¨é‡å±‚é¢ (ä¸­ç­‰)

#### 5. **è¿‡åº¦ä½¿ç”¨å¤æ‚ç±»å‹å’Œæ³›å‹** â­â­â­

**é—®é¢˜æè¿°**:

```typescript
// è¿‡åº¦å¤æ‚çš„ç±»å‹å®šä¹‰
export interface BookmarkSearchService<T extends BookmarkNode = BookmarkNode> {
  search<R extends SearchResult = SearchResult>(
    query: string,
    options?: SearchOptions<T, R>
  ): Promise<SearchResponse<R>>
}
```

**ä¼˜åŒ–å»ºè®®**:

- ç®€åŒ–ç±»å‹å®šä¹‰ï¼Œåªåœ¨çœŸæ­£éœ€è¦æ—¶ä½¿ç”¨æ³›å‹
- ä¼˜å…ˆä½¿ç”¨å…·ä½“ç±»å‹è€Œéè¿‡åº¦æŠ½è±¡

---

#### 6. **ç¼ºä¹ç»Ÿä¸€çš„é”™è¯¯å¤„ç†ç­–ç•¥** â­â­â­â­

**é—®é¢˜æè¿°**:

- è™½ç„¶æœ‰ `error-handling.ts`ï¼Œä½†å¾ˆå¤šåœ°æ–¹ä»åœ¨ä½¿ç”¨åŸå§‹ `try-catch`
- é”™è¯¯å¤„ç†ä¸ä¸€è‡´ï¼ˆæœ‰çš„è¿”å›é”™è¯¯å¯¹è±¡ï¼Œæœ‰çš„æŠ›å¼‚å¸¸ï¼Œæœ‰çš„è¿”å› nullï¼‰

**å…·ä½“æ¡ˆä¾‹**:

```typescript
// ä¸‰ç§ä¸åŒçš„é”™è¯¯å¤„ç†æ–¹å¼å¹¶å­˜

// æ–¹å¼1: è¿”å› { success, data, error }
async function method1() {
  return { success: true, data: xxx }
}

// æ–¹å¼2: æŠ›å‡ºå¼‚å¸¸
async function method2() {
  throw new Error('xxx')
}

// æ–¹å¼3: è¿”å› null
async function method3() {
  return null
}
```

**ä¼˜åŒ–æ–¹æ¡ˆ**:

```typescript
// ç»Ÿä¸€ä½¿ç”¨ Result æ¨¡å¼
type Result<T, E = Error> = { ok: true; value: T } | { ok: false; error: E }

// æ‰€æœ‰å¼‚æ­¥æ“ä½œç»Ÿä¸€è¿”å› Result
async function loadBookmarks(): Promise<Result<Bookmark[]>> {
  try {
    const data = await fetch()
    return { ok: true, value: data }
  } catch (error) {
    return { ok: false, error }
  }
}
```

---

#### 7. **è¿‡åº¦ä¾èµ–å…¨å±€å•ä¾‹** â­â­â­

**é—®é¢˜æè¿°**:

```typescript
// å¤šå¤„ä½¿ç”¨å…¨å±€å•ä¾‹æ¨¡å¼
export const indexedDBManager = new IndexedDBManager()
export const bookmarkSearchService = new BookmarkSearchService()
export const performanceOptimizer = new PerformanceOptimizer()
```

**å½±å“**:

- ğŸŸ¡ æµ‹è¯•å›°éš¾ï¼ˆæ— æ³• mockï¼‰
- ğŸŸ¡ çŠ¶æ€ç®¡ç†æ··ä¹±ï¼ˆå¤šä¸ªå…¥å£ä¿®æ”¹åŒä¸€å•ä¾‹ï¼‰
- ğŸŸ¡ æ— æ³•å¹¶è¡Œå¤„ç†ï¼ˆå•ä¾‹çŠ¶æ€å†²çªï¼‰

**ä¼˜åŒ–æ–¹æ¡ˆ**:

```typescript
// ä½¿ç”¨ä¾èµ–æ³¨å…¥
class BookmarkService {
  constructor(
    private db: IDBManager,
    private search: ISearchEngine,
    private cache: ICacheManager
  ) {}
}

// æˆ–ä½¿ç”¨ Vue çš„ provide/inject
// app.provide('bookmarkService', new BookmarkService(...))
```

---

#### 8. **ä»£ç é‡å¤å’ŒåŠŸèƒ½é‡å ** â­â­â­

**å…·ä½“æ¡ˆä¾‹**:

- å¤šå¤„é‡å¤çš„æ ‘éå†é€»è¾‘
- å¤šå¤„é‡å¤çš„ IndexedDB æ“ä½œ
- å¤šå¤„é‡å¤çš„ Chrome API è°ƒç”¨å°è£…

**ç¤ºä¾‹**:

```typescript
// åœ¨å¤šä¸ªæ–‡ä»¶ä¸­é‡å¤å‡ºç°çš„æ ‘éå†
function findNodeById(tree, id) {
  for (const node of tree) {
    if (node.id === id) return node
    if (node.children) {
      const found = findNodeById(node.children, id)
      if (found) return found
    }
  }
}
```

**ä¼˜åŒ–æ–¹æ¡ˆ**:

- æŠ½å–é€šç”¨çš„æ ‘æ“ä½œåˆ° `utils/tree-helpers.ts`
- åˆ›å»º `BookmarkTreeNavigator` ç±»ç»Ÿä¸€æ ‘æ“ä½œ

---

### âš ï¸ æ€§èƒ½å±‚é¢ (ä¸­ç­‰)

#### 9. **IndexedDB äº‹åŠ¡ç®¡ç†ä¸å½“** â­â­â­â­

**é—®é¢˜æè¿°**:

- å¤šæ¬¡æ‰“å¼€/å…³é—­æ•°æ®åº“è¿æ¥
- äº‹åŠ¡è¾¹ç•Œä¸æ¸…æ™°
- ç¼ºä¹è¿æ¥æ± ç®¡ç†

**å½±å“**:

- ğŸŸ¡ æ€§èƒ½æŸå¤±ï¼ˆé¢‘ç¹å»ºç«‹è¿æ¥ï¼‰
- ğŸŸ¡ å¯èƒ½çš„æ•°æ®ä¸ä¸€è‡´

**ä¼˜åŒ–æ–¹æ¡ˆ**:

```typescript
// ä½¿ç”¨è¿æ¥æ± å’Œäº‹åŠ¡ç®¡ç†å™¨
class IndexedDBConnectionPool {
  private connection: IDBDatabase | null = null

  async getConnection(): Promise<IDBDatabase> {
    if (!this.connection) {
      this.connection = await this.openDB()
    }
    return this.connection
  }

  async withTransaction<T>(
    stores: string[],
    mode: IDBTransactionMode,
    callback: (tx: IDBTransaction) => Promise<T>
  ): Promise<T> {
    const db = await this.getConnection()
    const tx = db.transaction(stores, mode)
    return callback(tx)
  }
}
```

---

#### 10. **ç¼ºä¹æ€§èƒ½ç›‘æ§å’ŒæŒ‡æ ‡** â­â­â­

**é—®é¢˜æè¿°**:

- è™½ç„¶æœ‰ `realtime-performance-optimizer.ts`ï¼Œä½†æœªè¢«å……åˆ†ä½¿ç”¨
- ç¼ºä¹å…³é”®è·¯å¾„çš„æ€§èƒ½ç›‘æ§
- æ²¡æœ‰æ€§èƒ½åŸºå‡†æµ‹è¯•

**ä¼˜åŒ–æ–¹æ¡ˆ**:

```typescript
// æ·»åŠ æ€§èƒ½ç›‘æ§è£…é¥°å™¨
function measurePerformance(
  target: any,
  key: string,
  descriptor: PropertyDescriptor
) {
  const original = descriptor.value
  descriptor.value = async function (...args: any[]) {
    const start = performance.now()
    try {
      return await original.apply(this, args)
    } finally {
      const duration = performance.now() - start
      logger.perf(key, duration)
    }
  }
}

// ä½¿ç”¨
class BookmarkService {
  @measurePerformance
  async loadBookmarks() {
    // ...
  }
}
```

---

### âš ï¸ å¯ç»´æŠ¤æ€§å±‚é¢ (ä¸­ç­‰)

#### 11. **æ–‡æ¡£ä¸ä»£ç ä¸åŒæ­¥** â­â­â­

**é—®é¢˜æè¿°**:

- README ä¸­çš„è¯´æ˜ä¸å®é™… API ä¸ç¬¦
- å¾ˆå¤š"å·²åºŸå¼ƒ"çš„ä»£ç ä»ç„¶å­˜åœ¨
- æ³¨é‡Šä¸­çš„ TODO å¾ˆå¤šæœªå¤„ç†

**ç¤ºä¾‹**:

```typescript
// services/hybrid-search-engine.ts
// Note: Search services temporarily disabled during refactoring
// ^^^ ä½†ä»£ç ä»åœ¨ä½¿ç”¨ä¸­
```

**ä¼˜åŒ–å»ºè®®**:

- æ¸…ç†å·²åºŸå¼ƒä»£ç 
- æ›´æ–°æ–‡æ¡£ä»¥åŒ¹é…å½“å‰å®ç°
- å»ºç«‹æ–‡æ¡£å®¡æŸ¥æµç¨‹

---

#### 12. **è¿‡å¤šçš„"èªæ˜"æŠ½è±¡** â­â­â­

**é—®é¢˜æè¿°**:

- è¿‡åº¦è®¾è®¡çš„æŠ½è±¡å±‚ï¼ˆå¦‚ `createBookmarkSearchPresets`ï¼‰
- å®é™…ä¸Šåªæœ‰ 2-3 ä¸ªä½¿ç”¨åœºæ™¯ï¼Œå´åˆ›å»ºäº†å¤æ‚çš„é…ç½®ç³»ç»Ÿ

**ç¤ºä¾‹**:

```typescript
// composables/useBookmarkSearch.ts
export function createBookmarkSearchPresets() {
  return {
    quickSearch: (tree) => useBookmarkSearch({ ... }),
    detailSearch: (tree) => useBookmarkSearch({ ... }),
    managementSearch: (tree) => useBookmarkSearch({ ... }),
    sidebarSearch: (tree) => useBookmarkSearch({ ... }),
  }
}

// å®é™…ä¸Šå¯ä»¥ç®€åŒ–ä¸ºï¼š
export function useBookmarkSearch(
  mode: 'quick' | 'detail' | 'management' | 'sidebar'
) {
  const config = SEARCH_CONFIGS[mode]
  // ...
}
```

---

## ğŸ“ˆ æŠ€æœ¯å€ºåŠ¡è¯„ä¼°

### é«˜ä¼˜å…ˆçº§ (ç«‹å³å¤„ç†)

1. âœ… **é‡æ„ utils ç›®å½•** - æ‹†åˆ†èŒè´£ï¼Œæ˜ç¡®è¾¹ç•Œ
2. âœ… **ç»Ÿä¸€é”™è¯¯å¤„ç†** - é‡‡ç”¨ Result æ¨¡å¼
3. âœ… **ç²¾ç®€ Store** - æŠ½å–ä¸šåŠ¡é€»è¾‘

### ä¸­ä¼˜å…ˆçº§ (1-2 ä¸ªæœˆå†…)

4. â³ **ç»Ÿä¸€æœç´¢ç³»ç»Ÿ** - æ¶ˆé™¤å¤šå¥—æœç´¢å®ç°
5. â³ **ä¼˜åŒ– IndexedDB** - è¿æ¥æ± å’Œäº‹åŠ¡ç®¡ç†
6. â³ **å‡å°‘å•ä¾‹ä¾èµ–** - å¼•å…¥ä¾èµ–æ³¨å…¥

### ä½ä¼˜å…ˆçº§ (æŒç»­æ”¹è¿›)

7. ğŸ“ **æ–‡æ¡£æ›´æ–°** - ä¿æŒæ–‡æ¡£ä¸ä»£ç åŒæ­¥
8. ğŸ“ **æ€§èƒ½ç›‘æ§** - æ·»åŠ å…³é”®æŒ‡æ ‡
9. ğŸ“ **ä»£ç æ¸…ç†** - ç§»é™¤é‡å¤å’ŒåºŸå¼ƒä»£ç 

---

## ğŸ¯ ä¼˜åŒ–è·¯çº¿å›¾

### ç¬¬ä¸€é˜¶æ®µï¼šæ¶æ„é‡ç»„ (2-3 å‘¨)

**Week 1-2: é‡æ„ utils ç›®å½•**

```bash
# ç›®æ ‡ï¼šå»ºç«‹æ¸…æ™°çš„åˆ†å±‚æ¶æ„
1. åˆ›å»º core/ ç›®å½•ï¼Œè¿ç§»æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
2. åˆ›å»º infrastructure/ ç›®å½•ï¼Œè¿ç§»åŸºç¡€è®¾æ–½
3. utils/ åªä¿ç•™çº¯å·¥å…·å‡½æ•°
4. æ›´æ–°æ‰€æœ‰ import è·¯å¾„
```

**Week 2-3: ç²¾ç®€ Store**

```bash
# ç›®æ ‡ï¼šStore åªè´Ÿè´£çŠ¶æ€ç®¡ç†
1. æŠ½å– management-store ä¸­çš„ä¸šåŠ¡é€»è¾‘
2. åˆ›å»º BookmarkTreeService, BookmarkCacheService
3. æ›´æ–° Store ä½¿ç”¨æœåŠ¡å±‚
```

### ç¬¬äºŒé˜¶æ®µï¼šç»Ÿä¸€æ¥å£ (1-2 å‘¨)

**Week 4: ç»Ÿä¸€æœç´¢ç³»ç»Ÿ**

```bash
1. åˆ›å»º core/search/engine.ts
2. è¿ç§»æ‰€æœ‰æœç´¢é€»è¾‘åˆ°ç»Ÿä¸€å¼•æ“
3. æ›´æ–° composables å’Œé¡µé¢ä½¿ç”¨æ–°å¼•æ“
4. ç§»é™¤æ—§çš„æœç´¢å®ç°
```

**Week 5: ç»Ÿä¸€é”™è¯¯å¤„ç†**

```bash
1. å®šä¹‰ Result<T, E> ç±»å‹
2. æ›´æ–°æ‰€æœ‰ async å‡½æ•°è¿”å› Result
3. ç»Ÿä¸€é”™è¯¯æ—¥å¿—å’Œç”¨æˆ·æç¤º
```

### ç¬¬ä¸‰é˜¶æ®µï¼šæ€§èƒ½ä¼˜åŒ– (1-2 å‘¨)

**Week 6: IndexedDB ä¼˜åŒ–**

```bash
1. å®ç°è¿æ¥æ± 
2. ä¼˜åŒ–äº‹åŠ¡ç®¡ç†
3. æ·»åŠ æ€§èƒ½ç›‘æ§
```

**Week 7: æ€§èƒ½ç›‘æ§å’Œæµ‹è¯•**

```bash
1. æ·»åŠ æ€§èƒ½åŸºå‡†æµ‹è¯•
2. å»ºç«‹æ€§èƒ½æŒ‡æ ‡ä½“ç³»
3. è¯†åˆ«å’Œä¼˜åŒ–ç“¶é¢ˆ
```

---

## ğŸ”§ å…·ä½“ä¼˜åŒ–æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: é‡æ„ç›®å½•ç»“æ„

**å½“å‰ç»“æ„é—®é¢˜**:

```
frontend/src/
â”œâ”€â”€ utils/          (24ä¸ªæ–‡ä»¶ï¼Œ11593è¡Œï¼ŒèŒè´£æ··ä¹±)
â”œâ”€â”€ services/       (9ä¸ªæ–‡ä»¶ï¼ŒèŒè´£ä¸utilsé‡å )
â”œâ”€â”€ stores/         (3ä¸ªæ–‡ä»¶ï¼Œä¸šåŠ¡é€»è¾‘è¿‡é‡)
â””â”€â”€ composables/    (3ä¸ªæ–‡ä»¶ï¼ŒæŠ½è±¡è¿‡åº¦)
```

**å»ºè®®ç»“æ„**:

```
frontend/src/
â”œâ”€â”€ core/                    # æ ¸å¿ƒé¢†åŸŸé€»è¾‘ï¼ˆä¸ä¾èµ–æ¡†æ¶ï¼‰
â”‚   â”œâ”€â”€ bookmark/
â”‚   â”‚   â”œâ”€â”€ domain/         # é¢†åŸŸæ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ bookmark.ts
â”‚   â”‚   â”‚   â””â”€â”€ folder.ts
â”‚   â”‚   â”œâ”€â”€ services/       # é¢†åŸŸæœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ bookmark-service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ tree-service.ts
â”‚   â”‚   â”‚   â””â”€â”€ diff-service.ts
â”‚   â”‚   â””â”€â”€ repositories/   # æ•°æ®è®¿é—®
â”‚   â”‚       â”œâ”€â”€ bookmark-repository.ts
â”‚   â”‚       â””â”€â”€ cache-repository.ts
â”‚   â””â”€â”€ search/
â”‚       â”œâ”€â”€ engine.ts
â”‚       â””â”€â”€ strategies/
â”œâ”€â”€ infrastructure/          # åŸºç¡€è®¾æ–½å±‚
â”‚   â”œâ”€â”€ indexeddb/
â”‚   â”‚   â”œâ”€â”€ connection-pool.ts
â”‚   â”‚   â”œâ”€â”€ transaction-manager.ts
â”‚   â”‚   â””â”€â”€ schema.ts
â”‚   â”œâ”€â”€ chrome-api/
â”‚   â”‚   â””â”€â”€ chrome-wrapper.ts
â”‚   â””â”€â”€ logging/
â”‚       â””â”€â”€ logger.ts
â”œâ”€â”€ application/            # åº”ç”¨æœåŠ¡å±‚
â”‚   â”œâ”€â”€ bookmark/
â”‚   â”‚   â”œâ”€â”€ bookmark-app-service.ts
â”‚   â”‚   â””â”€â”€ search-app-service.ts
â”‚   â””â”€â”€ ui/
â”‚       â””â”€â”€ notification-service.ts
â”œâ”€â”€ presentation/           # è¡¨ç°å±‚
â”‚   â”œâ”€â”€ stores/            # åªè´Ÿè´£UIçŠ¶æ€
â”‚   â”œâ”€â”€ composables/       # UIé€»è¾‘å¤ç”¨
â”‚   â””â”€â”€ components/
â””â”€â”€ utils/                 # çº¯å·¥å…·å‡½æ•°ï¼ˆæ— çŠ¶æ€ï¼‰
    â”œâ”€â”€ array-helpers.ts
    â”œâ”€â”€ string-helpers.ts
    â””â”€â”€ validators.ts
```

**è¿ç§»è®¡åˆ’**:

```typescript
// ç¬¬1æ­¥ï¼šåˆ›å»ºæ–°ç›®å½•ç»“æ„
mkdir -p frontend/src/{core,infrastructure,application}
mkdir -p frontend/src/core/{bookmark,search}
mkdir -p frontend/src/infrastructure/{indexeddb,chrome-api,logging}

// ç¬¬2æ­¥ï¼šè¿ç§»æ–‡ä»¶ï¼ˆç¤ºä¾‹ï¼‰
# utils/unified-bookmark-api.ts
#   â†’ core/bookmark/repositories/bookmark-repository.ts

# utils/smart-bookmark-manager.ts
#   â†’ core/bookmark/services/bookmark-service.ts

# utils/smart-bookmark-diff-engine.ts
#   â†’ core/bookmark/services/diff-service.ts

# ç¬¬3æ­¥ï¼šæ›´æ–° import è·¯å¾„ï¼ˆä½¿ç”¨ VS Code é‡æ„å·¥å…·ï¼‰

# ç¬¬4æ­¥ï¼šéªŒè¯å’Œæµ‹è¯•
```

---

### æ–¹æ¡ˆ 2: ç²¾ç®€ Store ç¤ºä¾‹

**å½“å‰ management-store.ts (ç®€åŒ–)**:

```typescript
export const useManagementStore = defineStore('management', () => {
  // âŒ é—®é¢˜1: StoreåŒ…å«ä¸šåŠ¡é€»è¾‘
  const convertCachedToTreeNodes = (cached: any[]) => {
    /* 50è¡Œ */
  }

  // âŒ é—®é¢˜2: StoreåŒ…å«æ•°æ®è®¿é—®
  const loadFromFastCache = async () => {
    /* 30è¡Œ */
  }

  // âŒ é—®é¢˜3: StoreåŒ…å«ç®—æ³•é€»è¾‘
  const compareStructures = () => {
    /* 40è¡Œ */
  }

  // âœ… åº”è¯¥åªæœ‰è¿™äº›
  const originalTree = ref<BookmarkNode[]>([])
  const isLoading = ref(false)
})
```

**ä¼˜åŒ–å**:

```typescript
// core/bookmark/services/tree-converter.ts
export class BookmarkTreeConverter {
  convertCachedToTreeNodes(cached: any[]): BookmarkNode[] {
    // ä¸šåŠ¡é€»è¾‘
  }
}

// core/bookmark/repositories/cache-repository.ts
export class BookmarkCacheRepository {
  async loadFromCache(): Promise<BookmarkNode[] | null> {
    // æ•°æ®è®¿é—®
  }
}

// core/bookmark/services/tree-comparer.ts
export class BookmarkTreeComparer {
  compare(tree1: BookmarkNode[], tree2: BookmarkNode[]): Diff {
    // ç®—æ³•é€»è¾‘
  }
}

// stores/management-store.ts (ç²¾ç®€å)
export const useManagementStore = defineStore('management', () => {
  // âœ… ä¾èµ–æ³¨å…¥æœåŠ¡
  const treeConverter = inject<BookmarkTreeConverter>('treeConverter')!
  const cacheRepo = inject<BookmarkCacheRepository>('cacheRepo')!
  const treeComparer = inject<BookmarkTreeComparer>('treeComparer')!

  // âœ… åªç®¡ç†UIçŠ¶æ€
  const originalTree = ref<BookmarkNode[]>([])
  const proposalTree = ref<BookmarkNode | null>(null)
  const isLoading = ref(false)
  const structuresAreDifferent = ref(false)

  // âœ… ç®€å•çš„çŠ¶æ€æ›´æ–°æ–¹æ³•
  async function loadData() {
    isLoading.value = true
    try {
      const cached = await cacheRepo.loadFromCache()
      if (cached) {
        originalTree.value = treeConverter.convertCachedToTreeNodes(cached)
      }
    } finally {
      isLoading.value = false
    }
  }

  function compareStructures() {
    const diff = treeComparer.compare(originalTree.value, proposalTree.value)
    structuresAreDifferent.value = diff.hasDifferences
  }

  return {
    originalTree,
    proposalTree,
    isLoading,
    structuresAreDifferent,
    loadData,
    compareStructures
  }
})
```

---

### æ–¹æ¡ˆ 3: ç»Ÿä¸€é”™è¯¯å¤„ç†

**å®šä¹‰ Result ç±»å‹**:

```typescript
// core/common/result.ts
export type Result<T, E = Error> =
  | { ok: true; value: T }
  | { ok: false; error: E }

export namespace Result {
  export function ok<T>(value: T): Result<T> {
    return { ok: true, value }
  }

  export function err<E = Error>(error: E): Result<never, E> {
    return { ok: false, error }
  }

  export function isOk<T, E>(
    result: Result<T, E>
  ): result is { ok: true; value: T } {
    return result.ok === true
  }

  export function isErr<T, E>(
    result: Result<T, E>
  ): result is { ok: false; error: E } {
    return result.ok === false
  }

  export function unwrap<T>(result: Result<T>): T {
    if (result.ok) return result.value
    throw result.error
  }

  export function unwrapOr<T>(result: Result<T>, defaultValue: T): T {
    return result.ok ? result.value : defaultValue
  }
}
```

**ä½¿ç”¨ç¤ºä¾‹**:

```typescript
// æ‰€æœ‰å¼‚æ­¥æ“ä½œè¿”å› Result
async function loadBookmarks(): Promise<Result<Bookmark[]>> {
  try {
    const data = await fetchFromIndexedDB()
    return Result.ok(data)
  } catch (error) {
    logger.error('Failed to load bookmarks', error)
    return Result.err(error as Error)
  }
}

// è°ƒç”¨æ–¹å¤„ç†
const result = await loadBookmarks()
if (Result.isOk(result)) {
  // ä½¿ç”¨ result.value
  displayBookmarks(result.value)
} else {
  // å¤„ç† result.error
  showError(result.error.message)
}

// æˆ–ä½¿ç”¨ unwrapOr
const bookmarks = Result.unwrapOr(result, [])
```

---

### æ–¹æ¡ˆ 4: ç»Ÿä¸€æœç´¢ç³»ç»Ÿ

**åˆ›å»ºç»Ÿä¸€æœç´¢å¼•æ“**:

```typescript
// core/search/engine.ts
export interface SearchStrategy {
  search(query: string, bookmarks: Bookmark[]): SearchResult[]
}

export class SearchEngine {
  constructor(private strategy: SearchStrategy) {}

  setStrategy(strategy: SearchStrategy) {
    this.strategy = strategy
  }

  async search(
    query: string,
    bookmarks: Bookmark[]
  ): Promise<Result<SearchResult[]>> {
    try {
      const results = this.strategy.search(query, bookmarks)
      return Result.ok(results)
    } catch (error) {
      return Result.err(error as Error)
    }
  }
}

// core/search/strategies/fuse-strategy.ts
export class FuseSearchStrategy implements SearchStrategy {
  search(query: string, bookmarks: Bookmark[]): SearchResult[] {
    // Fuse.js å®ç°
  }
}

// core/search/strategies/hybrid-strategy.ts
export class HybridSearchStrategy implements SearchStrategy {
  search(query: string, bookmarks: Bookmark[]): SearchResult[] {
    // æ··åˆæœç´¢å®ç°
  }
}

// application/search/search-app-service.ts
export class SearchAppService {
  private engine: SearchEngine

  constructor() {
    this.engine = new SearchEngine(new HybridSearchStrategy())
  }

  useFastSearch() {
    this.engine.setStrategy(new FuseSearchStrategy())
  }

  useAccurateSearch() {
    this.engine.setStrategy(new HybridSearchStrategy())
  }

  async search(query: string): Promise<Result<SearchResult[]>> {
    const bookmarks = await this.getBookmarks()
    return this.engine.search(query, bookmarks)
  }
}
```

---

## ğŸ“š æœ€ä½³å®è·µå»ºè®®

### 1. **åˆ†å±‚æ¶æ„åŸåˆ™**

```
Presentation Layer (UI)
    â†“ åªä¾èµ– â†“
Application Layer (ç”¨ä¾‹/åº”ç”¨æœåŠ¡)
    â†“ åªä¾èµ– â†“
Domain Layer (æ ¸å¿ƒä¸šåŠ¡é€»è¾‘)
    â†“ åªä¾èµ– â†“
Infrastructure Layer (æŠ€æœ¯å®ç°)
```

**è§„åˆ™**:

- âœ… ä¸Šå±‚å¯ä»¥ä¾èµ–ä¸‹å±‚
- âŒ ä¸‹å±‚ä¸èƒ½ä¾èµ–ä¸Šå±‚
- âœ… æ ¸å¿ƒå±‚ä¸ä¾èµ–æ¡†æ¶
- âœ… åŸºç¡€è®¾æ–½å±‚å¯æ›¿æ¢

### 2. **å•ä¸€èŒè´£åŸåˆ™**

- ä¸€ä¸ªç±»/æ–‡ä»¶åªåšä¸€ä»¶äº‹
- å‡½æ•°ä¸è¶…è¿‡ 50 è¡Œ
- ç±»ä¸è¶…è¿‡ 300 è¡Œ

### 3. **ä¾èµ–æ³¨å…¥ > å…¨å±€å•ä¾‹**

```typescript
// âŒ é¿å…
export const bookmarkService = new BookmarkService()

// âœ… æ¨è
// main.ts
app.provide('bookmarkService', new BookmarkService(...))

// ç»„ä»¶ä¸­
const bookmarkService = inject<BookmarkService>('bookmarkService')!
```

### 4. **é”™è¯¯å¤„ç†ä¸€è‡´æ€§**

- ç»Ÿä¸€ä½¿ç”¨ Result æ¨¡å¼
- æ˜ç¡®åŒºåˆ†å¯æ¢å¤é”™è¯¯å’Œè‡´å‘½é”™è¯¯
- è®°å½•æ‰€æœ‰é”™è¯¯æ—¥å¿—

### 5. **å‘½åè§„èŒƒ**

- æ–‡ä»¶å: `kebab-case.ts`
- ç±»å: `PascalCase`
- å‡½æ•°/å˜é‡: `camelCase`
- å¸¸é‡: `UPPER_SNAKE_CASE`
- æ¥å£: `IBookmarkRepository` æˆ– `BookmarkRepository`

---

## ğŸ¬ æ€»ç»“

### æ ¸å¿ƒé—®é¢˜

1. âš ï¸ **æ¶æ„æ··ä¹±**: utils æ‰¿æ‹…è¿‡å¤šèŒè´£ï¼Œåˆ†å±‚ä¸æ¸…
2. âš ï¸ **èŒè´£æ¨¡ç³Š**: Storeã€Serviceã€Utils è¾¹ç•Œä¸æ¸…
3. âš ï¸ **é‡å¤å®ç°**: å¤šå¥—æœç´¢ã€å¤šå¥—é”™è¯¯å¤„ç†
4. âš ï¸ **è¿‡åº¦æŠ½è±¡**: ä¸å¿…è¦çš„å¤æ‚åº¦

### ä¼˜åŒ–æ”¶ç›Š

- âœ… **å¯ç»´æŠ¤æ€§**: +60% (æ¸…æ™°çš„åˆ†å±‚å’ŒèŒè´£)
- âœ… **å¯æµ‹è¯•æ€§**: +80% (ä¸šåŠ¡é€»è¾‘ç‹¬ç«‹)
- âœ… **å¼€å‘æ•ˆç‡**: +40% (å‡å°‘é‡å¤ï¼Œä»£ç æ˜“æ‡‚)
- âœ… **æ–°äººä¸Šæ‰‹**: +70% (æ¶æ„æ¸…æ™°)

### å»ºè®®ä¼˜å…ˆçº§

1. ğŸ”´ **ç«‹å³æ‰§è¡Œ**: é‡æ„ utils ç›®å½•ï¼Œå»ºç«‹åˆ†å±‚æ¶æ„
2. ğŸŸ¡ **2å‘¨å†…æ‰§è¡Œ**: ç²¾ç®€ Storeï¼Œç»Ÿä¸€é”™è¯¯å¤„ç†
3. ğŸŸ¢ **1æœˆå†…æ‰§è¡Œ**: ç»Ÿä¸€æœç´¢ï¼Œä¼˜åŒ–æ€§èƒ½

### é£é™©è¯„ä¼°

- **é‡æ„é£é™©**: ä¸­ç­‰ï¼ˆéœ€è¦å¤§é‡ import è·¯å¾„æ›´æ–°ï¼‰
- **æµ‹è¯•è¦†ç›–**: ä½ï¼ˆå½“å‰ç¼ºä¹æµ‹è¯•ï¼Œéœ€è¦è¡¥å……ï¼‰
- **æ—¶é—´æˆæœ¬**: 3-4 å‘¨ï¼ˆç¬¬ä¸€é˜¶æ®µæ¶æ„é‡ç»„ï¼‰

---

**å®¡æ ¸ç»“è®º**: é¡¹ç›®æ•´ä½“è´¨é‡å°šå¯ï¼Œä½†æ¶æ„å±‚é¢å­˜åœ¨æ˜æ˜¾çš„è®¾è®¡é—®é¢˜ã€‚å»ºè®®æŒ‰ç…§ä¼˜åŒ–è·¯çº¿å›¾é€æ­¥é‡æ„ï¼Œå…ˆè§£å†³æ¶æ„é—®é¢˜ï¼Œå†ä¼˜åŒ–æ€§èƒ½å’Œç»†èŠ‚ã€‚

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨**:

1. ä¸å›¢é˜Ÿè®¨è®ºæœ¬æŠ¥å‘Š
2. ç¡®å®šä¼˜åŒ–ä¼˜å…ˆçº§
3. å¼€å§‹ç¬¬ä¸€é˜¶æ®µï¼šé‡æ„ utils ç›®å½•

---

_æŠ¥å‘Šç”Ÿæˆæ—¥æœŸ: 2024å¹´_  
_å®¡æ ¸äººå‘˜: AI æ¶æ„å®¡æ ¸ç³»ç»Ÿ_  
_ç‰ˆæœ¬: v1.0_
