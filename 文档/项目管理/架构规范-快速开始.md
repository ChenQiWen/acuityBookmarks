# 🚀 架构规范 - 快速开始指南

> 5分钟快速了解新的架构规范和组件体系

---

## 📋 核心改进

### 1️⃣ 页面统一整合到 `src/pages/`

**之前**:

```
src/
├── popup/
├── side-panel/
├── management/
├── auth/
└── settings/
```

**现在（规划中）**:

```
src/
└── pages/
    ├── popup/
    ├── side-panel/
    ├── management/
    ├── auth/
    └── settings/
```

---

### 2️⃣ 组件分类管理

**基础 UI 组件** (`components/base/`)

- 纯展示组件，无业务逻辑
- 例如：Button, Input, Checkbox

**复合组件** (`components/composite/`)

- 包含业务逻辑的组件
- 例如：BookmarkTree, SearchPanel

---

### 3️⃣ 完善的组件规范

每个组件必须包含：

```
Component/
├── Component.vue       # ✅ 组件实现
├── Component.types.ts  # ✅ TypeScript 类型
└── README.md           # ✅ 使用文档
```

---

## 🛠️ 快速使用

### 创建基础组件

```bash
# 1. 运行脚本
cd /Users/cqw/Documents/github/acuityBookmarks
./frontend/scripts/create-base-component.sh MyButton

# 2. 实现组件
# 编辑 frontend/src/components/base/MyButton/MyButton.vue

# 3. 导出组件
# 在 components/index.ts 中添加导出

# 4. 使用组件
import { MyButton } from '@/components'
```

---

### 创建复合组件

```bash
# 1. 运行脚本
./frontend/scripts/create-composite-component.sh SearchPanel

# 2. 实现组件逻辑
# 编辑 frontend/src/components/composite/SearchPanel/SearchPanel.vue

# 3. 使用组件
import { SearchPanel } from '@/components'
```

---

### 创建页面

```bash
# 1. 运行脚本
./frontend/scripts/create-page.sh my-feature

# 2. 更新 vite.config.ts
# 添加页面入口配置

# 3. 实现页面
# 编辑 frontend/src/pages/my-feature/MyFeature.vue
```

---

## 📐 架构原则

### 四层架构

```
┌─────────────────────────┐
│  Presentation (表现层)   │  ← stores/, components/, pages/
│  只管理 UI 状态           │
└───────────┬─────────────┘
            ↓ 依赖
┌─────────────────────────┐
│  Application (应用层)    │  ← application/
│  用例编排                │
└───────────┬─────────────┘
            ↓ 依赖
┌─────────────────────────┐
│  Core (核心业务层)       │  ← core/
│  框架无关的业务逻辑       │
└───────────┬─────────────┘
            ↓ 依赖
┌─────────────────────────┐
│  Infrastructure (基础)  │  ← infrastructure/
│  技术实现（可替换）       │
└─────────────────────────┘
```

---

### 单向数据流

```
Chrome API → Background → IndexedDB → UI
```

**关键规则**:

- ✅ UI 只从 IndexedDB 读取
- ✅ UI 只写入 Chrome API
- ❌ UI 不直接读 Chrome API
- ❌ UI 不直接写 IndexedDB

---

## 🎯 组件开发规范

### 基础组件示例

```vue
<!-- components/base/Button/Button.vue -->
<script setup lang="ts">
import type { ButtonProps, ButtonEmits } from './Button.types'

const props = withDefaults(defineProps<ButtonProps>(), {
  variant: 'primary',
  size: 'md'
})

const emit = defineEmits<ButtonEmits>()
</script>

<template>
  <button
    class="button"
    :class="[`button--${variant}`, `button--${size}`]"
    @click="emit('click', $event)"
  >
    <slot />
  </button>
</template>
```

**类型定义**:

```typescript
// components/base/Button/Button.types.ts
export interface ButtonProps {
  variant?: 'primary' | 'secondary'
  size?: 'sm' | 'md' | 'lg'
}

export interface ButtonEmits {
  (event: 'click', e: MouseEvent): void
}
```

---

### 复合组件示例

```vue
<!-- components/composite/SearchPanel/SearchPanel.vue -->
<script setup lang="ts">
import { inject } from 'vue'
import { Button, Input } from '@/components'
import type { SearchAppService } from '@/application/search/search-app-service'

// ✅ 通过 inject 获取服务
const searchApp = inject<SearchAppService>('searchApp')

const handleSearch = async (query: string) => {
  // ✅ 通过应用服务处理业务逻辑
  const result = await searchApp?.search(query)
  // ...
}
</script>

<template>
  <div class="search-panel">
    <Input v-model="query" placeholder="搜索..." />
    <Button @click="handleSearch(query)">搜索</Button>
  </div>
</template>
```

---

## 📂 目录定位速查

| 目录                    | 用途                     | 示例                      |
| ----------------------- | ------------------------ | ------------------------- |
| `core/`                 | 核心业务逻辑（框架无关） | 书签树转换、差异比对      |
| `infrastructure/`       | 技术实现（可替换）       | IndexedDB、Chrome API     |
| `application/`          | 用例编排                 | 书签应用服务、搜索服务    |
| `stores/`               | UI 状态管理              | 加载状态、选中项          |
| `components/base/`      | 基础 UI 组件             | Button, Input, Icon       |
| `components/composite/` | 复合组件                 | BookmarkTree, SearchPanel |
| `pages/`                | 页面入口                 | popup, management         |
| `composables/`          | 可复用逻辑               | useLazyFavicon            |
| `services/`             | 特殊服务（Legacy）       | bookmark-sync-service     |
| `utils-legacy/`         | 遗留代码                 | IndexedDB 相关            |

---

## ⚠️ 常见错误

### ❌ 错误做法

```vue
<script setup lang="ts">
// ❌ UI 直接读 Chrome API
const tree = await chrome.bookmarks.getTree()

// ❌ UI 直接写 IndexedDB
await indexedDBManager.updateBookmark(...)

// ❌ Store 包含复杂业务逻辑
const compareAndDiff = (tree1, tree2) => {
  // 200行的树比对算法
}

// ❌ 基础组件包含业务逻辑
const bookmarks = await loadBookmarks()
</script>
```

### ✅ 正确做法

```vue
<script setup lang="ts">
// ✅ 从 IndexedDB 读取
const bookmarks = await indexedDBManager.getAllBookmarks()

// ✅ 写入 Chrome API（Background 会自动同步）
await chrome.bookmarks.create({ title: 'New' })

// ✅ Store 只管理 UI 状态，委托业务逻辑给服务
const loadData = async () => {
  isLoading.value = true
  const result = await bookmarkApp.getBookmarkTree()
  if (result.ok) {
    tree.value = result.value
  }
  isLoading.value = false
}

// ✅ 基础组件纯展示，通过 props 接收数据
const props = defineProps<{ items: BookmarkNode[] }>()
</script>
```

---

## 📚 详细文档

- **架构总览**: [src目录架构说明.md](./src目录架构说明.md)
- **重构方案**: [组件与页面规范化方案.md](./组件与页面规范化方案.md)
- **脚本使用**: [frontend/scripts/README.md](../../frontend/scripts/README.md)
- **数据流**: [单向数据流架构说明.md](../../单向数据流架构说明.md)

---

## 🎓 新人上手路径

1. **第一步**: 阅读本文档（5分钟）
2. **第二步**: 查看 [src目录架构说明.md](./src目录架构说明.md)（15分钟）
3. **第三步**: 尝试创建一个基础组件（30分钟）
   ```bash
   ./frontend/scripts/create-base-component.sh TestButton
   ```
4. **第四步**: 查看现有代码示例
   - 基础组件：`components/ui/Button.vue`
   - 复合组件：`components/SimpleBookmarkTree.vue`
   - 页面：`management/Management.vue`

---

## 🚀 开始行动

### 立即可以做的事

1. **创建你的第一个规范化组件**

   ```bash
   cd /Users/cqw/Documents/github/acuityBookmarks
   ./frontend/scripts/create-base-component.sh MyFirstComponent
   ```

2. **查看生成的文件**

   ```bash
   ls -la frontend/src/components/base/MyFirstComponent/
   ```

3. **开始实现组件**
   - 编辑 `MyFirstComponent.vue`
   - 完善 `MyFirstComponent.types.ts`
   - 更新 `README.md`

---

## ❓ 常见问题

**Q: 现有组件需要立即迁移吗？**
A: 不需要。可以逐步迁移，新旧代码可以并存。

**Q: 基础组件和复合组件如何区分？**
A: 基础组件无业务逻辑，可在任何项目复用；复合组件包含业务逻辑。

**Q: 页面何时迁移到 pages 目录？**
A: 按照迁移计划逐步进行，预计 2-3 周完成。

**Q: 如何确保遵循单向数据流？**
A: 记住：Chrome API → IndexedDB → UI，永远不逆向！

---

## 🎉 总结

### 核心要点

1. ✅ 页面统一放在 `pages/` 目录
2. ✅ 组件分为 `base/`（纯UI）和 `composite/`（业务）
3. ✅ 每个组件都有类型文件和文档
4. ✅ 使用脚本快速创建规范化组件
5. ✅ 遵循单向数据流原则

### 立即行动

```bash
# 创建你的第一个规范化组件
./frontend/scripts/create-base-component.sh MyComponent

# 开始编码！
```

---

**有问题？** 查看详细文档或提交 Issue  
**开始吧！** 🚀
