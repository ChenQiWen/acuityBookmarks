# ğŸ—ï¸ AcuityBookmarks å•å‘æ•°æ®æµæ¶æ„

## æ ¸å¿ƒåŸåˆ™

> **æ•°æ®æµæ°¸è¿œæ˜¯å•å‘çš„ï¼šChrome API â†’ IndexedDB â†’ UI**
>
> ä¸å…è®¸ä»»ä½•é€†å‘æ•°æ®æµï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§å’Œå¯é¢„æµ‹æ€§ã€‚

---

## ğŸ“Š å®Œæ•´æ•°æ®æµå›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Chrome Bookmarks API                        â”‚
â”‚                    (å”¯ä¸€çš„çœŸå®æ•°æ®æº)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ chrome.bookmarks.onCreated
                   â”‚ chrome.bookmarks.onChanged
                   â”‚ chrome.bookmarks.onMoved
                   â”‚ chrome.bookmarks.onRemoved
                   â”‚
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             Background/Service Worker (ä¸­å¿ƒåŒ–ç›‘å¬)               â”‚
â”‚  â€¢ background.js                                                â”‚
â”‚  â€¢ setupBookmarkChangeListeners()                               â”‚
â”‚  â€¢ syncAndBroadcast(eventType, id)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ (1) å®Œæ•´åŒæ­¥
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    IndexedDB (ä¸­å¿ƒåŒ–å­˜å‚¨)                         â”‚
â”‚  â€¢ bookmarkSyncService.syncAllBookmarks()                       â”‚
â”‚  â€¢ flattenBookmarkTree() â†’ ç”Ÿæˆ pathIds                         â”‚
â”‚  â€¢ convertChromeNodeToRecord() â†’ å®Œæ•´å…ƒæ•°æ®                      â”‚
â”‚  â€¢ indexedDBManager.updateBookmark()                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ (2) å¹¿æ’­æ›´æ–°æ¶ˆæ¯
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  chrome.runtime.sendMessage({                   â”‚
â”‚                    type: 'BOOKMARKS_DB_SYNCED',                 â”‚
â”‚                    eventType: 'created|changed|moved|removed',  â”‚
â”‚                    bookmarkId: id,                              â”‚
â”‚                    timestamp: Date.now()                        â”‚
â”‚                  })                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ (3) æ‰€æœ‰é¡µé¢æ¥æ”¶
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     åº”ç”¨é¡µé¢ (UI å±‚)                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ Management   â”‚  Side Panel  â”‚   Popup      â”‚                â”‚
â”‚  â”‚  é¡µé¢        â”‚    é¡µé¢      â”‚    é¡µé¢      â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                 â”‚
â”‚  â€¢ modern-bookmark-service.ts ç›‘å¬æ¶ˆæ¯                           â”‚
â”‚  â€¢ dispatchCoalescedEvent(AB_EVENTS.BOOKMARKS_DB_SYNCED)       â”‚
â”‚  â€¢ Management.vue: handleDbSynced() â†’ refreshCache()           â”‚
â”‚  â€¢ ä» IndexedDB è¯»å–æœ€æ–°æ•°æ®                                     â”‚
â”‚  â€¢ æ›´æ–° UI                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”‘ å…³é”®å®ç°

### 1. Background ä¸­å¿ƒåŒ–ç›‘å¬ï¼ˆ`background.js`ï¼‰

```javascript
/**
 * ğŸ”„ è®¾ç½®ä¹¦ç­¾å˜åŒ–ç›‘å¬å™¨
 * æ¶æ„åŸåˆ™ï¼šå•å‘æ•°æ®æµ
 * Chrome API â†’ IndexedDB â†’ å¹¿æ’­æ¶ˆæ¯ â†’ UI æ›´æ–°
 */
function setupBookmarkChangeListeners() {
  // ç›‘å¬ä¹¦ç­¾åˆ›å»º
  chrome.bookmarks.onCreated.addListener(async (id, bookmark) => {
    console.log('ğŸ“ [Background] ä¹¦ç­¾å·²åˆ›å»º:', bookmark.title)
    await syncAndBroadcast('created', id)
  })

  // ç›‘å¬å…¶ä»–äº‹ä»¶...
  chrome.bookmarks.onChanged.addListener(...)
  chrome.bookmarks.onMoved.addListener(...)
  chrome.bookmarks.onRemoved.addListener(...)
}

/**
 * ğŸ”„ åŒæ­¥åˆ° IndexedDB å¹¶å¹¿æ’­æ›´æ–°æ¶ˆæ¯
 */
async function syncAndBroadcast(eventType, id) {
  // 1. å®Œæ•´åŒæ­¥åˆ° IndexedDBï¼ˆç¡®ä¿ pathIds ç­‰å­—æ®µæ­£ç¡®ï¼‰
  await bookmarkSyncService.syncAllBookmarks()

  // 2. å¹¿æ’­æ¶ˆæ¯åˆ°æ‰€æœ‰é¡µé¢
  chrome.runtime.sendMessage({
    type: 'BOOKMARKS_DB_SYNCED',
    eventType: eventType,
    bookmarkId: id,
    timestamp: Date.now()
  })
}
```

### 2. å‰ç«¯é¡µé¢ç›‘å¬å¹¿æ’­ï¼ˆ`modern-bookmark-service.ts`ï¼‰

```javascript
chrome.runtime.onMessage.addListener(message => {
  if (message.type === 'BOOKMARKS_DB_SYNCED') {
    // åˆå¹¶ä¸èŠ‚æµï¼š150ms å†…ä»…æ´¾å‘ä¸€æ¬¡
    dispatchCoalescedEvent(
      AB_EVENTS.BOOKMARKS_DB_SYNCED,
      { timestamp: message.timestamp || Date.now() },
      150
    )
  }
})
```

### 3. Management é¡µé¢å“åº”ï¼ˆ`Management.vue`ï¼‰

```javascript
// ç›‘å¬ IndexedDB åŒæ­¥å®Œæˆäº‹ä»¶
const handleDbSynced = async () => {
  console.log('[Management] ğŸ“¡ æ”¶åˆ° IndexedDB åŒæ­¥å®Œæˆäº‹ä»¶')

  // ä» IndexedDB åˆ·æ–°æ•°æ®
  await refreshCache()

  // æ›´æ–° UI
  isPageLoading.value = false
}

// æ³¨å†Œç›‘å¬å™¨
window.addEventListener(AB_EVENTS.BOOKMARKS_DB_SYNCED, handleDbSynced)
```

---

## ğŸ¯ å…¸å‹åœºæ™¯

### åœºæ™¯ 1ï¼šç”¨æˆ·åœ¨ Management é¡µé¢ç”Ÿæˆä¹¦ç­¾

```
æ­¥éª¤ 1: Management é¡µé¢
  â†“ chrome.bookmarks.create({ ... })

æ­¥éª¤ 2: Chrome API
  â†“ è§¦å‘ chrome.bookmarks.onCreated äº‹ä»¶

æ­¥éª¤ 3: Background/Service Worker
  â†“ ç›‘å¬åˆ°äº‹ä»¶
  â†“ await bookmarkSyncService.syncAllBookmarks()
  â†“ (å®Œæ•´åŒæ­¥ï¼Œç”Ÿæˆ pathIds)

æ­¥éª¤ 4: IndexedDB
  â†“ æ•°æ®å·²æ›´æ–°

æ­¥éª¤ 5: Background
  â†“ chrome.runtime.sendMessage({ type: 'BOOKMARKS_DB_SYNCED' })

æ­¥éª¤ 6: Management é¡µé¢
  â†“ æ¥æ”¶åˆ°æ¶ˆæ¯
  â†“ handleDbSynced()
  â†“ refreshCache() - ä» IndexedDB è¯»å–
  â†“ æ›´æ–° UI
```

### åœºæ™¯ 2ï¼šå¤–éƒ¨æ›´æ”¹ä¹¦ç­¾ï¼ˆæµè§ˆå™¨ä¹¦ç­¾ç®¡ç†å™¨ï¼‰

```
æ­¥éª¤ 1: æµè§ˆå™¨ä¹¦ç­¾ç®¡ç†å™¨
  â†“ ç”¨æˆ·ä¿®æ”¹/åˆ é™¤ä¹¦ç­¾

æ­¥éª¤ 2: Chrome API
  â†“ è§¦å‘ chrome.bookmarks.onChanged äº‹ä»¶

æ­¥éª¤ 3-6: åŒåœºæ™¯ 1
  â†“ Background ç›‘å¬ â†’ åŒæ­¥ IndexedDB â†’ å¹¿æ’­ â†’ UI æ›´æ–°
```

### åœºæ™¯ 3ï¼šManagement é¡µé¢ç¼–è¾‘ä¹¦ç­¾

```
æ­¥éª¤ 1: Management é¡µé¢
  â†“ chrome.bookmarks.update(id, { title: 'æ–°æ ‡é¢˜' })

æ­¥éª¤ 2: Chrome API
  â†“ è§¦å‘ chrome.bookmarks.onChanged äº‹ä»¶

æ­¥éª¤ 3-6: åŒåœºæ™¯ 1
  â†“ Background ç›‘å¬ â†’ åŒæ­¥ IndexedDB â†’ å¹¿æ’­ â†’ UI æ›´æ–°
```

---

## âœ… æ¶æ„ä¼˜åŠ¿

### 1. æ•°æ®ä¸€è‡´æ€§

- **å•ä¸€æ•°æ®æº**ï¼šIndexedDB æ˜¯æ‰€æœ‰é¡µé¢çš„æ•°æ®æº
- **è‡ªåŠ¨åŒæ­¥**ï¼šä»»ä½•ä¹¦ç­¾å˜åŒ–éƒ½ä¼šè‡ªåŠ¨åŒæ­¥åˆ° IndexedDB
- **æ— å†²çª**ï¼šä¸å­˜åœ¨æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µ

### 2. å¯é¢„æµ‹æ€§

- **å•å‘æµåŠ¨**ï¼šæ•°æ®æµå‘æ¸…æ™°ï¼Œæ˜“äºç†è§£å’Œè°ƒè¯•
- **äº‹ä»¶é©±åŠ¨**ï¼šé€šè¿‡äº‹ä»¶æœºåˆ¶è§£è€¦ï¼Œå„æ¨¡å—èŒè´£æ˜ç¡®

### 3. å¯ç»´æŠ¤æ€§

- **ä¸­å¿ƒåŒ–ç®¡ç†**ï¼šBackground ç»Ÿä¸€å¤„ç†åŒæ­¥é€»è¾‘
- **æ˜“äºæ‰©å±•**ï¼šæ–°å¢é¡µé¢åªéœ€ç›‘å¬ `BOOKMARKS_DB_SYNCED` äº‹ä»¶
- **è°ƒè¯•å‹å¥½**ï¼šå®Œæ•´çš„æ—¥å¿—è®°å½•ï¼Œä¾¿äºè¿½è¸ªæ•°æ®æµ

### 4. æ€§èƒ½ä¼˜åŒ–

- **æ‰¹é‡åŒæ­¥**ï¼šBackground æ§åˆ¶åŒæ­¥é¢‘ç‡ï¼Œé¿å…é‡å¤
- **èŠ‚æµåˆå¹¶**ï¼š150ms å†…çš„å¤šæ¬¡å˜åŒ–åˆå¹¶ä¸ºä¸€æ¬¡æ›´æ–°
- **æŒ‰éœ€åˆ·æ–°**ï¼šé¡µé¢åªåœ¨éœ€è¦æ—¶ä» IndexedDB è¯»å–

---

## ğŸš« ç¦æ­¢çš„åæ¨¡å¼

### âŒ åæ¨¡å¼ 1ï¼šå‰ç«¯ç›´æ¥åŒæ­¥ IndexedDB

```javascript
// âŒ é”™è¯¯ï¼šå‰ç«¯é¡µé¢ç›´æ¥è°ƒç”¨åŒæ­¥
async function onBookmarkCreate() {
  await chrome.bookmarks.create({ ... })
  await bookmarkSyncService.syncAllBookmarks()  // âŒ ä¸è¦è¿™æ ·åšï¼
  refreshUI()
}
```

**ä¸ºä»€ä¹ˆé”™è¯¯**ï¼š

- è¿åå•å‘æ•°æ®æµåŸåˆ™
- å¯èƒ½å¯¼è‡´å¤šä¸ªé¡µé¢é‡å¤åŒæ­¥
- æ— æ³•ä¿è¯å…¶ä»–é¡µé¢æ”¶åˆ°æ›´æ–°

### âŒ åæ¨¡å¼ 2ï¼šUI ç›´æ¥è¯»å– Chrome API

```javascript
// âŒ é”™è¯¯ï¼šUI ç›´æ¥è¯»å– Chrome API
async function loadBookmarks() {
  const tree = await chrome.bookmarks.getTree() // âŒ ä¸è¦è¿™æ ·åšï¼
  displayTree(tree)
}
```

**ä¸ºä»€ä¹ˆé”™è¯¯**ï¼š

- ç»•è¿‡ IndexedDBï¼Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´
- ç¼ºå°‘ pathIds ç­‰é¢„å¤„ç†å­—æ®µ
- æ— æ³•åˆ©ç”¨ IndexedDB çš„ç¼“å­˜å’Œç´¢å¼•

### âŒ åæ¨¡å¼ 3ï¼šé¡µé¢ä¹‹é—´ç›´æ¥é€šä¿¡

```javascript
// âŒ é”™è¯¯ï¼šé¡µé¢ä¹‹é—´ç›´æ¥ä¼ é€’æ•°æ®
chrome.runtime.sendMessage({
  type: 'UPDATE_OTHER_PAGE',
  data: bookmarks // âŒ ä¸è¦è¿™æ ·åšï¼
})
```

**ä¸ºä»€ä¹ˆé”™è¯¯**ï¼š

- è¿åå•ä¸€æ•°æ®æºåŸåˆ™
- å¯èƒ½å¯¼è‡´æ•°æ®ç‰ˆæœ¬å†²çª
- éš¾ä»¥ç»´æŠ¤å’Œè°ƒè¯•

---

## âœ… æ­£ç¡®çš„åšæ³•

### âœ… æ­£ç¡® 1ï¼šé€šè¿‡ Background åŒæ­¥

```javascript
// âœ… æ­£ç¡®ï¼šè®© Background ç›‘å¬äº‹ä»¶å¹¶åŒæ­¥
async function createBookmark(data) {
  // 1. è°ƒç”¨ Chrome API
  await chrome.bookmarks.create(data)

  // 2. Background ä¼šè‡ªåŠ¨ï¼š
  //    - ç›‘å¬ onCreated äº‹ä»¶
  //    - åŒæ­¥åˆ° IndexedDB
  //    - å¹¿æ’­ BOOKMARKS_DB_SYNCED

  // 3. å½“å‰é¡µé¢ä¼šè‡ªåŠ¨ï¼š
  //    - æ¥æ”¶å¹¿æ’­æ¶ˆæ¯
  //    - ä» IndexedDB åˆ·æ–°æ•°æ®
  //    - æ›´æ–° UI
}
```

### âœ… æ­£ç¡® 2ï¼šä» IndexedDB è¯»å–

```javascript
// âœ… æ­£ç¡®ï¼šå§‹ç»ˆä» IndexedDB è¯»å–
async function loadBookmarks() {
  const bookmarks = await indexedDBManager.getAllBookmarks()
  // bookmarks åŒ…å«å®Œæ•´çš„ pathIdsã€depth ç­‰å­—æ®µ
  displayTree(buildTreeFromFlat(bookmarks))
}
```

### âœ… æ­£ç¡® 3ï¼šç›‘å¬ç»Ÿä¸€äº‹ä»¶

```javascript
// âœ… æ­£ç¡®ï¼šç›‘å¬ Background çš„å¹¿æ’­äº‹ä»¶
window.addEventListener(AB_EVENTS.BOOKMARKS_DB_SYNCED, async () => {
  // IndexedDB å·²æ›´æ–°ï¼Œåˆ·æ–° UI
  await refreshFromIndexedDB()
})
```

---

## ğŸ“ å…³é”®æ–‡ä»¶æ¸…å•

### Background å±‚ï¼ˆä¸­å¿ƒåŒ–åŒæ­¥ï¼‰

- **`frontend/background.js`**
  - `setupBookmarkChangeListeners()` - ç›‘å¬ Chrome ä¹¦ç­¾äº‹ä»¶
  - `syncAndBroadcast()` - åŒæ­¥åˆ° IndexedDB å¹¶å¹¿æ’­

### æœåŠ¡å±‚ï¼ˆæ•°æ®å¤„ç†ï¼‰

- **`frontend/src/services/bookmark-sync-service.ts`**
  - `syncAllBookmarks()` - å®Œæ•´åŒæ­¥
  - `flattenBookmarkTree()` - æ‰å¹³åŒ–æ ‘
  - `convertChromeNodeToRecord()` - ç”Ÿæˆ pathIds ç­‰å­—æ®µ

### IndexedDB å±‚ï¼ˆæŒä¹…åŒ–å­˜å‚¨ï¼‰

- **`frontend/src/infrastructure/indexeddb/manager.ts`**
  - `updateBookmark()` - æ›´æ–°å•ä¸ªä¹¦ç­¾
  - `getAllBookmarks()` - è·å–æ‰€æœ‰ä¹¦ç­¾
  - `getChildrenByParentId()` - è·å–å­ä¹¦ç­¾

### å‰ç«¯é¡µé¢å±‚ï¼ˆUI æ›´æ–°ï¼‰

- **`frontend/src/services/modern-bookmark-service.ts`**
  - ç›‘å¬ `chrome.runtime.onMessage`
  - æ´¾å‘ `AB_EVENTS.BOOKMARKS_DB_SYNCED` äº‹ä»¶

- **`frontend/src/management/Management.vue`**
  - ç›‘å¬ `AB_EVENTS.BOOKMARKS_DB_SYNCED`
  - `handleDbSynced()` - å“åº”åŒæ­¥å®Œæˆ
  - `refreshCache()` - ä» IndexedDB åˆ·æ–°

---

## ğŸ”§ è°ƒè¯•æŒ‡å—

### æŸ¥çœ‹æ•°æ®æµæ—¥å¿—

1. **Background æ—¥å¿—**ï¼ˆService Worker æ§åˆ¶å°ï¼‰

   ```
   ğŸ“ [Background] ä¹¦ç­¾å·²åˆ›å»º: Sample 1 Â· Bravo
   ğŸ”„ [Background] åŒæ­¥åˆ° IndexedDB: created 123
   âœ… [Background] åŒæ­¥å®Œæˆå¹¶å·²å¹¿æ’­: created
   ```

2. **IndexedDB åŒæ­¥æ—¥å¿—**

   ```
   BookmarkSync ğŸš€ å¼€å§‹åŒæ­¥ä¹¦ç­¾...
   BookmarkSync ğŸ“š è·å–åˆ°ä¹¦ç­¾æ ‘ï¼Œæ ¹èŠ‚ç‚¹æ•°: 1
   BookmarkSync ğŸ“Š æ‰å¹³åŒ–åå…± 46745 æ¡è®°å½•
   BookmarkSync âœ… åŒæ­¥å®Œæˆï¼å…±å†™å…¥ 46745 æ¡ä¹¦ç­¾
   ```

3. **å‰ç«¯é¡µé¢æ—¥å¿—**ï¼ˆManagement é¡µé¢æ§åˆ¶å°ï¼‰
   ```
   ğŸ“¡ [å‰ç«¯] å·²åˆå¹¶æ´¾å‘ BOOKMARKS_DB_SYNCED äº‹ä»¶
   [Management] ğŸ“¡ æ”¶åˆ° IndexedDB åŒæ­¥å®Œæˆäº‹ä»¶
   [Management] ğŸ”„ å¼€å§‹åˆ·æ–°ç¼“å­˜...
   ```

### å¸¸è§é—®é¢˜æ’æŸ¥

**é—®é¢˜ 1ï¼šç”Ÿæˆä¹¦ç­¾å UI ä¸æ›´æ–°**

æ£€æŸ¥ï¼š

1. Background æ˜¯å¦ç›‘å¬åˆ°äº‹ä»¶ï¼Ÿâ†’ æŸ¥çœ‹ Service Worker æ§åˆ¶å°
2. IndexedDB æ˜¯å¦å·²åŒæ­¥ï¼Ÿâ†’ æŸ¥çœ‹ `BookmarkSync` æ—¥å¿—
3. é¡µé¢æ˜¯å¦æ”¶åˆ°å¹¿æ’­ï¼Ÿâ†’ æŸ¥çœ‹ `BOOKMARKS_DB_SYNCED` æ—¥å¿—

**é—®é¢˜ 2ï¼šHover é«˜äº®ä¸å·¥ä½œ**

æ£€æŸ¥ï¼š

1. ä¹¦ç­¾æ˜¯å¦æœ‰ `pathIds` å­—æ®µï¼Ÿâ†’ æ‰“å° `node.pathIds`
2. IndexedDB æ˜¯å¦å®Œæ•´åŒæ­¥ï¼Ÿâ†’ ç¡®è®¤èµ°äº† `syncAllBookmarks()`
3. æ˜¯å¦é€šè¿‡ Background åŒæ­¥ï¼Ÿâ†’ ä¸è¦å‰ç«¯ç›´æ¥è°ƒç”¨

**é—®é¢˜ 3ï¼šæ•°æ®ä¸ä¸€è‡´**

æ£€æŸ¥ï¼š

1. æ˜¯å¦ç»•è¿‡ IndexedDBï¼Ÿâ†’ ç¡®ä¿ä¸ç›´æ¥è¯» Chrome API
2. æ˜¯å¦æœ‰é€†å‘æ•°æ®æµï¼Ÿâ†’ ç¡®ä¿åªæœ‰ Background å†™ IndexedDB
3. æ˜¯å¦æœ‰é‡å¤åŒæ­¥ï¼Ÿâ†’ æ£€æŸ¥æ˜¯å¦å¤šå¤„è°ƒç”¨ `syncAllBookmarks()`

---

## ğŸ¯ æ€»ç»“

### æ ¸å¿ƒåŸåˆ™ï¼ˆå†æ¬¡å¼ºè°ƒï¼‰

1. **Chrome API æ˜¯å”¯ä¸€çš„çœŸå®æ•°æ®æº**
2. **Background æ˜¯å”¯ä¸€çš„åŒæ­¥å…¥å£**
3. **IndexedDB æ˜¯å”¯ä¸€çš„æ•°æ®æº**
4. **æ‰€æœ‰é¡µé¢åªä» IndexedDB è¯»å–**
5. **é€šè¿‡äº‹ä»¶å¹¿æ’­æ›´æ–° UI**

### æ•°æ®æµå…¬å¼

```
Chrome API â†’ Background â†’ IndexedDB â†’ å¹¿æ’­ â†’ UI
```

**æ°¸è¿œä¸è¦é€†å‘ï¼**

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-10-14  
**ç»´æŠ¤è€…**: AcuityBookmarks Team
