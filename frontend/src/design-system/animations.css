/**
 * 动画系统 (Animation System)
 * 
 * 设计原则：
 * 1. 性能优先 - 只使用 transform 和 opacity（GPU 加速）
 * 2. 按需动画 - 通过状态类触发，避免滚动时触发
 * 3. 可控制 - 支持用户关闭动画（prefers-reduced-motion）
 * 4. 语义化 - 动画名称表达意图，不表达实现
 */

/* ========================================
 * 动画变量 (Animation Tokens)
 * ======================================== */

:root {
  /* === 时长 (Duration) === */

  /* 微交互：按钮点击、hover */
  --anim-duration-instant: 100ms;

  /* 快速反馈：状态变化、小元素 */
  --anim-duration-fast: 150ms;

  /* 标准：大多数 UI 动画 */
  --anim-duration-normal: 200ms;

  /* 强调：需要用户注意的变化 */
  --anim-duration-slow: 300ms;

  /* 戏剧性：页面级过渡 */
  --anim-duration-slower: 400ms;

  /* === 缓动函数 (Easing) === */

  /* 标准：大多数动画 */
  --anim-ease-standard: cubic-bezier(0.2, 0, 0, 1);

  /* 减速：元素进入 */
  --anim-ease-decelerate: cubic-bezier(0, 0, 0, 1);

  /* 加速：元素离开 */
  --anim-ease-accelerate: cubic-bezier(0.3, 0, 1, 1);

  /* 弹性：强调效果 */
  --anim-ease-bounce: cubic-bezier(0.34, 1.56, 0.64, 1);

  /* 线性：进度条、加载 */
  --anim-ease-linear: linear;

  /* === 组合预设 (Presets) === */
  --anim-enter: var(--anim-duration-normal) var(--anim-ease-decelerate);
  --anim-leave: var(--anim-duration-fast) var(--anim-ease-accelerate);
  --anim-move: var(--anim-duration-normal) var(--anim-ease-standard);
  --anim-feedback: var(--anim-duration-instant) var(--anim-ease-standard);
}

/* ========================================
 * 关键帧 (Keyframes)
 * 只使用 transform 和 opacity
 * ======================================== */

/* --- 淡入淡出 --- */
@keyframes fade-in {
  from {
    opacity: 0;
  }

  to {
    opacity: 1;
  }
}

@keyframes fade-out {
  from {
    opacity: 1;
  }

  to {
    opacity: 0;
  }
}

/* --- 滑入滑出 --- */
@keyframes slide-in-up {
  from {
    opacity: 0;
    transform: translateY(8px);
  }

  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes slide-in-down {
  from {
    opacity: 0;
    transform: translateY(-8px);
  }

  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes slide-in-left {
  from {
    opacity: 0;
    transform: translateX(8px);
  }

  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes slide-in-right {
  from {
    opacity: 0;
    transform: translateX(-8px);
  }

  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes slide-out-left {
  from {
    opacity: 1;
    transform: translateX(0);
  }

  to {
    opacity: 0;
    transform: translateX(-8px);
  }
}

@keyframes slide-out-right {
  from {
    opacity: 1;
    transform: translateX(0);
  }

  to {
    opacity: 0;
    transform: translateX(8px);
  }
}

/* --- 缩放 --- */
@keyframes scale-in {
  from {
    opacity: 0;
    transform: scale(0.95);
  }

  to {
    opacity: 1;
    transform: scale(1);
  }
}

@keyframes scale-out {
  from {
    opacity: 1;
    transform: scale(1);
  }

  to {
    opacity: 0;
    transform: scale(0.95);
  }
}

/* --- 弹跳（成功反馈） --- */
@keyframes pop {
  0% {
    transform: scale(1);
  }

  50% {
    transform: scale(1.05);
  }

  100% {
    transform: scale(1);
  }
}

/* --- 摇晃（错误反馈） --- */
@keyframes shake {
  0%,
  100% {
    transform: translateX(0);
  }

  20%,
  60% {
    transform: translateX(-4px);
  }

  40%,
  80% {
    transform: translateX(4px);
  }
}

/* --- 脉冲（加载/同步） --- */
@keyframes pulse {
  0%,
  100% {
    opacity: 1;
  }

  50% {
    opacity: 0.5;
  }
}

/* --- 旋转（加载） --- */
@keyframes spin {
  from {
    transform: rotate(0deg);
  }

  to {
    transform: rotate(360deg);
  }
}

/* --- 高亮闪烁（操作完成） --- */
@keyframes highlight-flash {
  0% {
    opacity: 1;
    transform: scale(1);
  }

  50% {
    opacity: 0.7;
    transform: scale(1.02);
  }

  100% {
    opacity: 1;
    transform: scale(1);
  }
}

/* ========================================
 * 工具类 (Utility Classes)
 * 按需应用，不自动触发
 * ======================================== */

@layer utilities {
  /* === 动画触发类 === */

  /* 使用方式：添加类名触发动画，动画结束后移除 */

  .anim-fade-in {
    animation: fade-in var(--anim-enter) forwards;
  }

  .anim-fade-out {
    animation: fade-out var(--anim-leave) forwards;
  }

  .anim-slide-in-up {
    animation: slide-in-up var(--anim-enter) forwards;
  }

  .anim-slide-in-down {
    animation: slide-in-down var(--anim-enter) forwards;
  }

  .anim-slide-in-left {
    animation: slide-in-left var(--anim-enter) forwards;
  }

  .anim-slide-in-right {
    animation: slide-in-right var(--anim-enter) forwards;
  }

  .anim-slide-out-left {
    animation: slide-out-left var(--anim-leave) forwards;
  }

  .anim-slide-out-right {
    animation: slide-out-right var(--anim-leave) forwards;
  }

  .anim-scale-in {
    animation: scale-in var(--anim-enter) forwards;
  }

  .anim-scale-out {
    animation: scale-out var(--anim-leave) forwards;
  }

  .anim-pop {
    animation: pop var(--anim-duration-normal) var(--anim-ease-bounce);
  }

  .anim-shake {
    animation: shake var(--anim-duration-slow) var(--anim-ease-standard);
  }

  .anim-pulse {
    animation: pulse 2s var(--anim-ease-linear) infinite;
  }

  .anim-spin {
    animation: spin 1s var(--anim-ease-linear) infinite;
  }

  .anim-highlight {
    animation: highlight-flash var(--anim-duration-slow)
      var(--anim-ease-standard);
  }

  /* === 过渡预设类 === */

  /* 用于 hover/focus 等状态变化 */

  .transition-colors {
    transition:
      color var(--anim-feedback),
      background-color var(--anim-feedback),
      border-color var(--anim-feedback);
  }

  .transition-opacity {
    transition: opacity var(--anim-feedback);
  }

  .transition-transform {
    transition: transform var(--anim-feedback);
  }

  .transition-all {
    transition:
      transform var(--anim-move),
      opacity var(--anim-move);
  }

  /* === GPU 加速提示 === */

  /* 对频繁动画的元素使用 */

  .gpu-accelerated {
    transform: translateZ(0);
    will-change: transform, opacity;
  }

  /* 动画完成后清除 will-change（节省内存） */
  .gpu-accelerated-off {
    will-change: auto;
  }
}

/* ========================================
 * 无障碍：尊重用户动画偏好
 * ======================================== */

@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    transition-duration: 0.01ms !important;
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
  }
}

/* ========================================
 * Vue Transition 组件适配
 * 用于 <Transition> 和 <TransitionGroup>
 * ======================================== */

/* --- 淡入淡出 --- */
.v-fade-enter-active {
  animation: fade-in var(--anim-enter);
}

.v-fade-leave-active {
  animation: fade-out var(--anim-leave);
}

/* --- 滑动 --- */
.v-slide-enter-active {
  animation: slide-in-up var(--anim-enter);
}

.v-slide-leave-active {
  animation: slide-out-left var(--anim-leave);
}

/* --- 缩放 --- */
.v-scale-enter-active {
  animation: scale-in var(--anim-enter);
}

.v-scale-leave-active {
  animation: scale-out var(--anim-leave);
}

/* --- 列表动画（TransitionGroup 专用） --- */
.v-list-move {
  transition: transform var(--anim-move);
}

.v-list-enter-active {
  animation: slide-in-up var(--anim-enter);
}

.v-list-leave-active {
  /* 离开时绝对定位，让其他元素可以平滑移动 */
  position: absolute;
  animation: fade-out var(--anim-leave);
}

/* ========================================
 * View Transitions API - 主题切换动画
 * 圆形扩散效果（类似 Ant Design）
 * ======================================== */

/* 禁用默认的 View Transition 动画，避免交叉淡入淡出 */
::view-transition-old(root),
::view-transition-new(root) {
  /* 确保视图完全可见 */
  opacity: 1;

  /* 强制 GPU 合成层 */
  transform: translateZ(0);

  /* 禁用默认动画 */
  animation: none;

  /* 确保颜色正确混合 */
  mix-blend-mode: normal;

  /* 防止闪烁：默认覆盖整个视口 */
  clip-path: none;

  /* 性能优化：提示浏览器优化 clip-path 动画 */
  will-change: clip-path;
}

/* 
 * 切换到暗黑模式：
 * - 新视图（暗黑）在上层
 * - 从点击位置向外扩散
 */
html.theme-dark::view-transition-old(root) {
  z-index: 1;
}

html.theme-dark::view-transition-new(root) {
  z-index: 9999;
}

/* 
 * 切换到明亮模式：
 * - 旧视图（暗黑）在上层
 * - 从边缘向点击位置收缩
 * - 新视图（明亮）在底层完全可见，等待暗黑收缩露出
 */
html.theme-light::view-transition-old(root) {
  z-index: 9999;
}

html.theme-light::view-transition-new(root) {
  z-index: 1;
}
