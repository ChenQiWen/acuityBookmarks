# ğŸ§ª æµ‹è¯•è¿è¡ŒæŒ‡å—

**æ›´æ–°æ—¶é—´**: 2025-01-22  
**Puppeteer çŠ¶æ€**: âœ… å·²å®‰è£…

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼ˆæ¨èï¼‰

```bash
# ä¸€é”®è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼ˆå•å…ƒæµ‹è¯• + E2E æµ‹è¯•ï¼‰
cd frontend
bun run test:all:complete
```

è¿™ä¸ªå‘½ä»¤ä¼šï¼š

1. âœ… è¿è¡Œæ‰€æœ‰å•å…ƒæµ‹è¯•ï¼ˆ55 ä¸ªï¼‰
2. âœ… æ„å»ºæ‰©å±•ï¼ˆç”Ÿæˆ dist/ ç›®å½•ï¼‰
3. âœ… è¿è¡Œ Service Worker E2E æµ‹è¯•ï¼ˆ11 ä¸ªï¼‰
4. âœ… æ˜¾ç¤ºå®Œæ•´çš„æµ‹è¯•æŠ¥å‘Š

**é¢„è®¡æ—¶é—´**: ~1-2 åˆ†é’Ÿ

---

## ğŸ“Š æµ‹è¯•åˆ†ç±»

### 1. å•å…ƒæµ‹è¯•ï¼ˆ55 ä¸ªï¼‰âš¡ å¿«é€Ÿ

```bash
# è¿è¡Œæ‰€æœ‰å•å…ƒæµ‹è¯•
bun run test:run

# æŒ‰ç±»å‹è¿è¡Œ
bun run test:unit              # å•å…ƒæµ‹è¯•ï¼ˆ9 ä¸ªï¼‰
bun run test:integration       # é›†æˆæµ‹è¯•ï¼ˆ5 ä¸ªï¼‰
bun run test:chrome            # Chrome API æµ‹è¯•ï¼ˆ16 ä¸ªï¼‰
bun run test:service-worker    # Service Worker å•å…ƒæµ‹è¯•ï¼ˆ17 ä¸ªï¼‰
bun run test:performance       # æ€§èƒ½æµ‹è¯•ï¼ˆ4 ä¸ªï¼‰
bun run test:contract          # å¥‘çº¦æµ‹è¯•ï¼ˆ4 ä¸ªï¼‰
```

**ç‰¹ç‚¹**ï¼š

- âš¡ é€Ÿåº¦å¿«ï¼ˆ< 1 ç§’ï¼‰
- âœ… ä¸éœ€è¦æ„å»º
- âœ… ä½¿ç”¨ Mock æ¨¡æ‹Ÿ Chrome API
- âœ… è¦†ç›– 95% çš„ä¸šåŠ¡é€»è¾‘

---

### 2. E2E æµ‹è¯•ï¼ˆ11 ä¸ªï¼‰ğŸ¢ è¾ƒæ…¢

```bash
# ç¬¬ä¸€æ­¥ï¼šæ„å»ºæ‰©å±•
bun run build

# ç¬¬äºŒæ­¥ï¼šè¿è¡Œ E2E æµ‹è¯•
bun run test:service-worker:e2e
```

**ç‰¹ç‚¹**ï¼š

- ğŸ¢ é€Ÿåº¦è¾ƒæ…¢ï¼ˆ~30-60 ç§’ï¼‰
- âœ… éœ€è¦å…ˆæ„å»ºæ‰©å±•
- âœ… ä½¿ç”¨çœŸå®çš„ Chrome æµè§ˆå™¨
- âœ… æµ‹è¯• Service Worker ç»ˆæ­¢å’Œé‡å¯
- âœ… ç¬¦åˆ Chrome å®˜æ–¹æ¨è

**æµ‹è¯•å†…å®¹**ï¼š

- Service Worker ç»ˆæ­¢åçš„çŠ¶æ€æ¢å¤
- IndexedDB æ•°æ®æŒä¹…åŒ–
- Alarm è§¦å‘å’Œé‡å¯
- æ¶ˆæ¯ä¼ é€’å¯é æ€§
- æ¶ˆæ¯ä¸¢å¤±åœºæ™¯å¤„ç†

---

## ğŸ¯ å¸¸ç”¨æµ‹è¯•åœºæ™¯

### åœºæ™¯ 1ï¼šæ—¥å¸¸å¼€å‘ï¼ˆå¿«é€Ÿåé¦ˆï¼‰

```bash
# åªè¿è¡Œå•å…ƒæµ‹è¯•
bun run test:run
```

**é€‚ç”¨äº**ï¼š

- ä¿®æ”¹ä¸šåŠ¡é€»è¾‘åå¿«é€ŸéªŒè¯
- TDD å¼€å‘æ¨¡å¼
- CI/CD å¿«é€Ÿæ£€æŸ¥

---

### åœºæ™¯ 2ï¼šæäº¤å‰æ£€æŸ¥ï¼ˆå®Œæ•´éªŒè¯ï¼‰

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
bun run test:all:complete
```

**é€‚ç”¨äº**ï¼š

- æäº¤ä»£ç å‰çš„å®Œæ•´æ£€æŸ¥
- å‘å¸ƒå‰çš„æœ€ç»ˆéªŒè¯
- ç¡®ä¿æ‰€æœ‰åŠŸèƒ½æ­£å¸¸

---

### åœºæ™¯ 3ï¼šè°ƒè¯•æµ‹è¯•ï¼ˆå¯è§†åŒ–ï¼‰

```bash
# å¯åŠ¨æµ‹è¯• UI
bun run test:ui

# æµè§ˆå™¨æ‰“å¼€ http://localhost:51204/__vitest__/
```

**é€‚ç”¨äº**ï¼š

- è°ƒè¯•å¤±è´¥çš„æµ‹è¯•
- æŸ¥çœ‹æµ‹è¯•è¦†ç›–ç‡
- åˆ†ææµ‹è¯•æ€§èƒ½

---

### åœºæ™¯ 4ï¼šåªæµ‹è¯•ç‰¹å®šæ–‡ä»¶

```bash
# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
bun run test src/tests/unit/bookmark-tree.test.ts

# ä½¿ç”¨ .only åªè¿è¡Œç‰¹å®šæµ‹è¯•
it.only('è¿™ä¸ªæµ‹è¯•ä¼šè¿è¡Œ', () => {
  // ...
})
```

---

## ğŸ“ˆ æµ‹è¯•ç»Ÿè®¡

### æµ‹è¯•æ•°é‡

| ç±»å‹                    | æ•°é‡   | å·¥å…·           | é€Ÿåº¦          |
| ----------------------- | ------ | -------------- | ------------- |
| å•å…ƒæµ‹è¯•                | 9      | Vitest         | âš¡ ~100ms     |
| é›†æˆæµ‹è¯•                | 5      | Vue Test Utils | âš¡ ~200ms     |
| Chrome API æµ‹è¯•         | 16     | Vitest + Mock  | âš¡ ~300ms     |
| Service Worker å•å…ƒæµ‹è¯• | 17     | Vitest + Mock  | âš¡ ~700ms     |
| Service Worker E2E æµ‹è¯• | 11     | Puppeteer      | ğŸ¢ ~30-60s    |
| æ€§èƒ½æµ‹è¯•                | 4      | Vitest         | âš¡ ~50ms      |
| å¥‘çº¦æµ‹è¯•                | 4      | Vitest + Zod   | âš¡ ~50ms      |
| **æ€»è®¡**                | **66** | -              | **~1-2 åˆ†é’Ÿ** |

---

## ğŸ” æµ‹è¯•è¯¦æƒ…

### Service Worker å•å…ƒæµ‹è¯•ï¼ˆ17 ä¸ªï¼‰

**æ–‡ä»¶**: `src/tests/service-worker/lifecycle.test.ts`

**æµ‹è¯•å†…å®¹**ï¼š

- âœ… åˆå§‹åŒ–é€»è¾‘ï¼ˆ2 ä¸ªï¼‰
- âœ… çŠ¶æ€æŒä¹…åŒ–ç­–ç•¥ï¼ˆ3 ä¸ªï¼‰
- âœ… æ¶ˆæ¯å¤„ç†å™¨æ³¨å†Œï¼ˆ7 ä¸ªï¼‰
  - åŒ…å« 5 ä¸ªè¾¹ç•Œæµ‹è¯•ï¼ˆé”™è¯¯ä½¿ç”¨åœºæ™¯ï¼‰
- âœ… Alarm ç®¡ç†ï¼ˆ2 ä¸ªï¼‰
- âœ… æœ€ä½³å®è·µéªŒè¯ï¼ˆ3 ä¸ªï¼‰

**è¿è¡Œ**ï¼š

```bash
bun run test:service-worker
```

---

### Service Worker E2E æµ‹è¯•ï¼ˆ11 ä¸ªï¼‰

**æ–‡ä»¶**: `src/tests/service-worker/termination.test.ts`

**æµ‹è¯•å†…å®¹**ï¼š

- âœ… çŠ¶æ€æ¢å¤æµ‹è¯•ï¼ˆ3 ä¸ªï¼‰
  - chrome.storage çŠ¶æ€æ¢å¤
  - IndexedDB æ•°æ®æ¢å¤
- âœ… Alarm è§¦å‘æµ‹è¯•ï¼ˆ1 ä¸ªï¼‰
  - Alarm è§¦å‘å Service Worker é‡å¯
- âœ… æ¶ˆæ¯ä¼ é€’å¯é æ€§æµ‹è¯•ï¼ˆ3 ä¸ªï¼‰
  - ç»ˆæ­¢åä»èƒ½æ¥æ”¶æ¶ˆæ¯
  - é•¿æ—¶é—´è¿è¡Œçš„æ¶ˆæ¯å¤„ç†å™¨
- âœ… æ¶ˆæ¯ä¸¢å¤±åœºæ™¯æµ‹è¯•ï¼ˆ4 ä¸ªï¼‰
  - Service Worker å¤„ç†æ¶ˆæ¯æ—¶è¢«ç»ˆæ­¢
  - æ¶ˆæ¯é‡è¯•æœºåˆ¶ï¼ˆå¹‚ç­‰æ€§ï¼‰
  - æŒä¹…åŒ–æ¶ˆæ¯é˜Ÿåˆ—
  - æ¶ˆæ¯ä¼ é€’å¤±è´¥æ£€æµ‹

**è¿è¡Œ**ï¼š

```bash
bun run build
bun run test:service-worker:e2e
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### E2E æµ‹è¯•è¦æ±‚

1. **å¿…é¡»å…ˆæ„å»ºæ‰©å±•**

   ```bash
   bun run build
   ```

   E2E æµ‹è¯•éœ€è¦åŠ è½½ `dist/` ç›®å½•ä¸­çš„æ‰©å±•

2. **éœ€è¦å¯è§æµè§ˆå™¨**
   - E2E æµ‹è¯•ä¼šå¯åŠ¨çœŸå®çš„ Chrome æµè§ˆå™¨
   - æµè§ˆå™¨çª—å£ä¼šå¯è§ï¼ˆheadless: falseï¼‰
   - è¿™æ˜¯ Service Worker æµ‹è¯•çš„è¦æ±‚

3. **æµ‹è¯•æ—¶é—´è¾ƒé•¿**
   - E2E æµ‹è¯•éœ€è¦ 30-60 ç§’
   - åŒ…å«ç­‰å¾… Service Worker ç»ˆæ­¢çš„æ—¶é—´
   - è¿™æ˜¯æ­£å¸¸çš„

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: E2E æµ‹è¯•å¤±è´¥ï¼Œæç¤ºæ‰¾ä¸åˆ°æ‰©å±•

**åŸå› **: æ²¡æœ‰æ„å»ºæ‰©å±•

**è§£å†³**:

```bash
bun run build
bun run test:service-worker:e2e
```

---

### Q2: æµ‹è¯•è¿è¡Œå¾ˆæ…¢

**åŸå› **: å¯èƒ½åœ¨è¿è¡Œ E2E æµ‹è¯•

**è§£å†³**: æ—¥å¸¸å¼€å‘åªè¿è¡Œå•å…ƒæµ‹è¯•

```bash
bun run test:run  # åªè¿è¡Œå•å…ƒæµ‹è¯•ï¼ˆå¿«é€Ÿï¼‰
```

---

### Q3: å¦‚ä½•åªè¿è¡Œå¤±è´¥çš„æµ‹è¯•ï¼Ÿ

**è§£å†³**:

```bash
# Vitest ä¼šè‡ªåŠ¨è®°ä½å¤±è´¥çš„æµ‹è¯•
bun run test --reporter=verbose
```

---

### Q4: å¦‚ä½•æŸ¥çœ‹æµ‹è¯•è¦†ç›–ç‡ï¼Ÿ

**è§£å†³**:

```bash
# å®‰è£…è¦†ç›–ç‡å·¥å…·
bun add -d @vitest/coverage-v8

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
bun run test:coverage

# æŸ¥çœ‹æŠ¥å‘Š
open coverage/index.html
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æµ‹è¯•çŠ¶æ€æŠ¥å‘Š](./TEST-STATUS.md) - æµ‹è¯•æ¡†æ¶çŠ¶æ€å’Œç»Ÿè®¡
- [å®Œæ•´æµ‹è¯•æŒ‡å—](./TESTING.md) - æµ‹è¯•ç­–ç•¥å’Œæœ€ä½³å®è·µ
- [Service Worker æµ‹è¯•è¯´æ˜](./src/tests/service-worker/README.md) - Service Worker æµ‹è¯•è¯¦æƒ…
- [æ¶ˆæ¯ä¼ é€’è¾¹ç•Œæµ‹è¯•](./docs/message-boundary-testing.md) - è¾¹ç•Œæµ‹è¯•æ–‡æ¡£

---

## ğŸ‰ å¼€å§‹æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼ˆæ¨èï¼‰
cd frontend
bun run test:all:complete
```

**é¢„æœŸç»“æœ**ï¼š

- âœ… 55 ä¸ªå•å…ƒæµ‹è¯•é€šè¿‡
- âœ… 11 ä¸ª E2E æµ‹è¯•é€šè¿‡
- âœ… æ€»è®¡ 66 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

**ç¥æµ‹è¯•é¡ºåˆ©ï¼** ğŸš€
